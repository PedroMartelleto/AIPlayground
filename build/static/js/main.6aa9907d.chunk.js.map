{"version":3,"sources":["draw/dynamicColor.ts","draw/color.ts","draw/colorAnimator.ts","draw/index.ts","draw/log.ts","rl/scalar.ts","rl/stringParam.ts","rl/agents/agentModel.ts","rl/agents/neat/genome/alleleGenesData.ts","rl/agents/individual.ts","rl/agents/neat/genome/linkGene.ts","rl/agents/neat/neuralNetworks/neuronData.ts","rl/agents/neat/neuralNetworks/stringNeuronData.ts","rl/agents/neat/neuralNetworks/stringNeuralNetwork.ts","rl/agents/neat/neuralNetworks/index.ts","rl/agents/neat/genome/neuronGene.ts","rl/agents/neat/utils/helper.ts","rl/agents/neat/genome/neuronGeneMutationRecord.ts","rl/agents/neat/genome/genomeMutator.ts","rl/agents/neat/genome/index.ts","rl/agents/neat/genome/innovation.ts","rl/agents/neat/utils/probabilityArray.ts","rl/agents/neat/community.ts","rl/agents/neat/params.ts","rl/agents/neat/species/speciationAlgorithm.ts","rl/agents/neat/species/index.ts","rl/agents/neat/species/uncannyValleySpeciationAlgorithm.ts","rl/agents/neat/index.ts","rl/agents/randomAgent/index.ts","rl/envs/environmentModel.ts","rl/envs/cartPole/obs.ts","rl/envs/cartPole/params.ts","rl/envs/cartPole/index.ts","rl/envs/birdGame/obs.ts","rl/envs/birdGame/params.ts","rl/envs/birdGame/pipe.ts","rl/envs/birdGame/point.ts","rl/envs/birdGame/polygon.ts","rl/envs/birdGame/index.ts","rl/envs/nes/params.ts","rl/envs/nes/ramGetter.ts","rl/envs/nes/ramSetter.ts","rl/envs/nes/emuManager.ts","rl/envs/nes/index.ts","rl/agents/genomeVisualizer/params.ts","rl/agents/genomeVisualizer/index.ts","routes/modelFactory.ts","components/infoCard.tsx","components/cardBrowser.tsx","routes/browserRoute.tsx","components/swipeableTabs.tsx","components/scalarSlider.tsx","components/scalarParam.tsx","components/stringParamComponent.tsx","components/paramsFamily.tsx","components/core.tsx","routes/splitCoreAndBrowserRoute.tsx","routes/splitTwoCoresRoute.tsx","routes/appRoutes.tsx","App.tsx","serviceWorker.ts","index.tsx","svg/neat.svg","rl/envs/birdGame/assets/pipe-up.png","rl/envs/birdGame/assets/pipe-down.png","rl/envs/birdGame/assets/background.png","rl/envs/birdGame/assets/bird1.png","rl/envs/birdGame/assets/bird2.png","rl/envs/birdGame/assets/bird3.png","rl/envs/birdGame/assets/floor.png","svg/pole-balancing.svg","png/birdGame.png","svg/dice.svg","png/NES.png"],"names":["DynamicColor","zero","positive","negative","this","value","Math","abs","Color","r","g","b","t","other","bezier","to","ColorAnimator","transitionID","color","fromColors","undefined","tMap","equals","transitionTo","Draw","x","sizeX","context","canvas","width","normX","y","sizeY","height","normY","image","scale","angle","naturalWidth","naturalHeight","coordX","coordY","pivotX","pivotY","translate","rotate","drawImage","setTransform","clearRect","clientWidth","clientHeight","fillStyle","fillRect","genome","fontColor","normWidth","normHeight","lineWidth","xOffset","linkGenes","linkGene","isEnabled","rectFill","text","innovation","n","inNeuron","id","outNeuron","rectStroke","neuronGenes","neuronGene","type","strokeStyle","strokeRect","radius","startAngle","endAngle","PI","arcPath","fill","stroke","fromX","fromY","toX","toY","asString","transition","fX","fY","tX","tY","beginPath","moveTo","lineTo","closePath","headLength","atan2","cos","sin","font","textAlign","fillText","dashLength","dashSpacing","setLineDash","cap","lineCap","neurons","links","phenotype","link","from","inIndex","outIndex","linkValue","neuronData","output","splitY","splitX","max","linkLineWidth","outputNeuronLine","pick","hiddenNeuronLine","inputNeuronLine","shadowBlur","line","neuron","neuronX","neuronY","neuronValue","inputNeuron","inputNeuronShadowBlur","shadowColor","arcFill","inputNeuronRadius","hiddenNeuron","blur","hiddenNeuronShadowBlur","hiddenNeuronRadius","outputNeuron","outputNeuronShadowBlur","outputNeuronRadius","tx","ty","size","arc","linkColor","linkShadowBlur","DrawLog","displayTime","latestLogs","push","printToConsole","console","log","warn","error","startTime","performance","now","logs","i","length","splice","setTranslation","Scalar","familyName","name","formulaName","isWhole","min","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","obj","key","hasOwnProperty","prop","forValue","isInteger","StringParam","values","fileNames","AgentModel","modelName","env","paramsArray","stringParamsArray","index","hasDoneFirstEval","newParamsArray","newParam","param","resetState","delta","individuals","act","step","fitness","prepareForIndividual","prepareForNewIndividual","prepareForEpoch","epoch","addScalarsFromObjectToArray","addStringParamsFromObjectToArray","scalar","AlleleGenesData","matchingGenesA","matchingGenesB","disjointGenesA","disjointGenesB","excessGenesA","excessGenesB","Individual","LinkGene","weight","clonedInNeuron","clonedOutNeuron","NeuronData","input","StringNeuronData","StringNeuralNetwork","floatDigitsPrecision","precisionMul","pow","bias","numberToStr","getNeuronIndexByID","prefix","weightString","startsWith","appendToStr","loopedLink","dst","strToAppend","maximumStringLength","String","round","NeuralNetwork","rnnMemory","hasActivated","inputsAsFormulaNames","digitsPrecision","nn","finalOutputs","iterate","outLinks","_","feedForward","activateNeuron","getNeuronDataByID","map","element","replace","inputs","inputCount","prepareForActivation","outputs","network","exp","NeuronGene","clonedNeuron","Helper","floor","random","array","j","temp","integerPart","fraction","NeuronGeneMutationRecord","GenomeMutator","params","adjustedFitness","outputCount","maxNumberOfHiddenNeurons","addHiddenNeuronMutation","hiddenNeuronMutationRate","addLinkMutation","linkMutationRate","linkMutationChanceOfConsideringLoopedRecurrency","weightsMutation","weightMutationRateForEachLink","weightMutationProbNewVal","weightMutationMaxPertubation","weightMutationNewValRange","biasesMutation","biasMutationRateForEachLink","biasMutationProbNewVal","biasMutationMaxPertubation","biasMutationNewValRange","mutationRate","chanceOfConsideringLoopedRecurrency","possibleLinks","shuffle","src","isDuplicateLink","isLinkPotentialLoop","community","addLinkToGenome","validLinks","chosenLink","randomInt","sqrt","neuronID","findNeuronIDForMutationAtLink","shouldCreateNewInnovation","hasNeuronWithID","maxNeuronID","neuronGenesRecords","newNeuron","mutationRateForEachLink","probNewWeightMutation","maxPertubation","newWeightRange","probNewBiasMutation","newBiasRange","Genome","species","inputNeuronGenes","maxGenomeID","newGenome","json","parsed","JSON","parse","stringify","blob","Blob","toJSON","saveAs","sort","a","recA","alignAlleleGenes","N","W","excessGenesCoefficient","disjointGenesCoefficient","weightsCoefficient","inputSplitXOffset","outputSplitXOffset","probOfMakingLinkInInitialGenome","inNeuronID","outNeuronID","warning","gene","onInputNeuron","onHiddenNeuron","onOutputNeuron","allLinks","inputOutLinks","getNonLoopedLinksWithSource","Array","prototype","apply","whileLoop","newAllLinks","hiddenOutLinks","recordedNeuronsID","foundLoop","outLink","indexOf","hasLoop","pop","srcNeuronsIDs","destsIDs","srcID","linksWithSrc","offspring","clone","mutate","fromCommunity","copyLinkAndNeuronsToGenome","maybeDisable","disableChance","copyNeuronToGenome","getNeuronByID","newLoopedLink","Innovation","ProbabilityArray","probs","indexes","normalize","assert","threshold","acc","total","p","factor","Community","speciationAlgorithm","populationSize","genomes","maxSpeciesID","linkGenesRecords","innovationNumber","generationCounter","bestSpeciesIndex","bestGenome","bestFitnesses","meanFitnesses","initialGenomeCount","isFinite","minimalGenome","initMinimalGenome","init","initialSpeciesCount","result","assertForNoEmptySpecies","mom","dad","fittest","baby","copyLinkAndNeuronsToGenomeAndMaybeDisable","offspringLinkDisableRate","sortEachSpecies","updateBestGenome","updateStats","totalOffspringCount","computeSpeciesStats","createOffspring","emptySpeciesFlag","trimSpeciesBackToElite","updateGenomesArray","respeciateAll","integrateNewGenomes","record","newLink","determineInnovationForLink","A","B","sortGenes","c","maxInnovationNumberA","maxInnovationNumberB","maxInnovationNumber","voidedGenesA","voidedGenesB","geneA","geneB","voidGeneA","voidGeneB","foundNoEmptySpecies","meanFitness","totalMeanFitness","totalSpawnCount","computeAdjustedFitnesses","meanAdjustedFitness","computeSpawnCount","spawnCount","deltaSpawnCount","probabilities","spawnCountReal","probArray","speciesIndex","randomlySelect","removeAt","shuffledSpecies","slice","eliteSize","eliteSizeReal","speciesEliteProportion","stochasticRound","offspringCount","computeOffspringStats","offspringAsexualProportion","fittestParentsCutoffProportion","totalAsexual","totalSexual","totalElite","asexualReproductionCount","sexualReproductionCount","nonZeroFitness","fittestParentsCutoff","parentsProbs","parentsProbsArray","parent1Index","parent2Index","child","crossover","foundEmptySpecies","foundBestGenomeNextGen","sortGenomes","NEATParams","showLog","wholeNumber","ranged","shThreshold","interspeciesMatingRate","minSpeciesCompatibilityDistance","maxStagnationAllowed","SpeciationAlgorithm","Species","firstGenome","gensStagnated","leader","offspringAsexualCountReal","fittestParentsCutoffReal","compatibilityDistance","mean","sharing","UncannyValleySpeciationAlgorithm","speciesCount","assignedGenomesCount","updateLeaders","newSpeciesPool","minCompatDistance","closestSpecies","compatDistance","newLeader","newLeaderCompat","unspeciatedCount","compat","NEATAgent","currentGenome","shouldStop","savedGenomeCount","latexFormula","popDrawIndex","popDrawData","addParamsFromObject","obsCount","actionsCount","populationData","individual","saveRequestedName","saveWithName","hasReachedGoal","goalReached","createPhenotype","activate","obsValues","actions","s","val","clear","render","generationCount","bestFitness","neuralNetwork","nnData","RandomAgent","environment","EnvironmentModel","obsArray","withFileName","e","CartPoleObs","cartPosition","cartVelocity","poleAngle","poleVelocity","CartPoleParams","trackLength","gravity","cartMass","cartForceLength","poleLength","poleMaxAngle","poleMass","cartWidth","cartHeight","wheelRadius","EnvCartPole","angularAcc","cartAcc","numberOfSteps","obs","actionMoveDirection","addObsFromObject","addAction","moveDir","Mp","Mc","F","l","t2","cartX","setLineCap","forceDir","arrow","poleX","poleY","arcStroke","BirdGameObs","deltaX","deltaY","BirdGameParams","gameScale","birdHorizontalSpeed","birdFlappingSpeed","manualInputMode","Pipe","opening","Point","Polygon","points","w","h","x0","y0","cw","sh","ch","sw","minA","maxA","projected","minB","maxB","polygons","pointsFirst","pointsSecond","polygon","i1","i2","p1","p2","normal","point1","point2","EnvBirdGame","score","pipeDown","Image","pipeUp","bird1","bird2","bird3","background","birdAnimation","tickCounter","birdVerticalSpeed","birdLastJumpTime","birdAngle","actualBirdAngle","birdVHeight","floorX","birdY","isCollidingWithPipe","pipe1","pipe2","scoreHitbox","shape","fromRectangle","hasBeenTriggered","shouldJumpManual","actionShouldJump","pipeDownImageSrc","pipeUpImageSrc","bird1ImageSrc","bird2ImageSrc","bird3ImageSrc","floorImageSrc","backgroundImageSrc","window","onkeydown","onkeyup","randomizePipe","pipeDistance","calculateObs","maxFloorX","birdDistToGround","imageSmoothingEnabled","backgroundWidth","backgroundHeight","imageScaled","drawPipe","imageScaledRotated","rectClear","birdX","birdPolygon","isIntersecting","checkCollisionWithPipe","pipe","pipeDownPolygon","pipeUpPolygon","pipeHeight","backgroundOffsetX","backgroundOffsetY","NESParams","screenScale","disableGraphics","fitnessXWeight","fitnessSpeedWeight","maxFramesStuck","repeatStageCount","visionBoxRight","visionBoxLeft","visionBoxTop","visionBoxBottom","normalJumpTicks","longJumpTicks","BUSY_STATES","ENEMY_TYPE_ADDRESSES","STAGE_OVER_ENEMIES","RAMGetter","nes","cpu","mem","yViewport","yPixel","playerState","lifes","includes","address","isWorldOver","isStageOver","RAMSetter","memGet","buttonUp","button","resetButtons","buttonDown","frame","world","level","changeAreaTimer","isBusy","runoutPrelevelTimer","frameAdvance","stage","writeStage","JsNES","BUTTON_START","time","lastTime","previousTime","EmuManager","memSet","hasReachedFlag","isDone","isDying","killMario","skipEndOfWorld","skipChangeArea","skipOccupiedStates","isDead","EnvNES","marioX","previousMarioX","numberOfFramesStuck","marioY","tiles","sprites","maxTime","stageIndex","repeatCount","maxMarioX","baseFitness","trainingStages","jumpCounter","longJumpCounter","emuManager","buf","buf8","buf32","imageData","hasInitGraphics","hasDownloadedROM","isFreshROM","shouldStartEvaluation","actionJump","actionJumpLong","actionRight","actionRun","actionLeft","setBuffer","buffer","k","visionBoxArea","onFrame","audioEmulation","request","XMLHttpRequest","open","overrideMimeType","onload","loadROM","response","resetEmu","send","keyCode","BUTTON_RIGHT","reloadROM","skipStartScreen","selectedStage","updateStage","action","xPosition","BUTTON_A","processAction","BUTTON_B","BUTTON_LEFT","flag","fileName","requestSave","data","set","putImageData","initNESGraphics","getInputs","avgSpeed","f","getSprites","dy","dx","tile","getTile","sprite","distx","disty","drawOffsetX","tileSize","rowWidth","visionBoxWidth","visionBoxHeight","slot","ex","ey","page","subx","suby","addr","getImageData","ArrayBuffer","Uint8ClampedArray","Uint32Array","GenomeVisualizerParams","fileInput","GenomeVisualizerAgent","genomeNames","generateFormula","obsFormulaNames","baseX","fromJSON","createEnv","InfoCard","CardLink","props","envName","info","Card","CardActionArea","component","CardMedia","style","objectFit","imgSrc","CardContent","Typography","gutterBottom","variant","title","description","CardActions","Button","React","CardBrowser","state","cards","isTransitioning","fetchDBData","cardInfo","sReactKey","Grid","item","xs","sm","md","lg","mappedCards","mapCards","container","spacing","serverGetRoute","PoleBalancingSVG","BirdGamePNG","NESPNG","NeatSVG","DiceSVG","ModelFactory","CardBrowserStyle","margin","BrowserRoute","SwipeableTabs","handleChange","event","setState","handleChangeIndex","styleDiv","AppBar","position","Tabs","onChange","indicatorColor","textColor","Tab","label","tab1Name","tab2Name","onChangeIndex","tab1","tab2","ScalarSlider","handleChangeComittedSlider","onChangeCommitted","handleBlurTextField","target","rounded","handleChangeTextField","stringToFloatInRange","handleChangeSlider","isArray","floatToString","str","ceil","align","TextField","onBlur","inputProps","styleTextField","multiline","Slider","fontSize","paddingBottom","ScalarParam","getNumberPicker","Checkbox","checked","onScalarChange","StringParamComponent","onFilePickerChange","stringParam","files","file","reader","FileReader","readAsText","getPicker","multiple","accept","ParamsFamily","newValue","updateStateForScalar","familyIndex","scalarIndex","families","scalars","update","$merge","mapScalarToComponent","sTint","mapStringParamToComponent","mapFamiliesToCards","family","cardParams","tint","styleTypography","Divider","styleDivider","mapStringParamsToCards","stringParams","onRefreshAction","agent","reset","fam","stringFamilies","mappedScalarCards","mappedStringCards","Paper","stylePaper","onMouseDown","paddingTop","marginLeft","marginRight","marginTop","marginBottom","Core","canvasContext","timeScale","unprocessedTime","frameCounter","frames","totalTime","fetchInfo","start","addEventListener","resize","bind","removeEventListener","styleCanvas","ref","loop","timeStamp","draw","toFixed","setInterval","run","needToRender","currentTime","passedTime","requestAnimationFrame","ctx","getContext","offsetWidth","offsetHeight","emptyCardInfo","gridStyle","SplitCoreAndBrowserRoute","routeProps","match","SplitTwoCoresRoute","agentName","routeStyle","AppRoutes","path","App","styleAppRoutes","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","ReactDOM","document","getElementById","URL","process","href","origin","fetch","headers","contentType","get","status","ready","unregister","reload","checkValidServiceWorker","module","exports"],"mappings":"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","file":"static/js/main.6aa9907d.chunk.js","sourcesContent":["import Color from \"./color\";\r\n\r\nexport default class DynamicColor {\r\n    public zero: Color;\r\n    public positive: Color;\r\n    public negative: Color;\r\n\r\n    constructor(zero: Color, positive: Color, negative: Color) {\r\n        this.zero = zero;\r\n        this.positive = positive;\r\n        this.negative = negative;\r\n    }\r\n\r\n    public pick(value: number): Color {\r\n\t\tif (Math.abs(value) < 0.001) {\r\n\t\t\treturn this.zero;\r\n\t\t} else if (value > 0) {\r\n\t\t\treturn this.positive;\r\n\t\t} else {\r\n\t\t\treturn this.negative;\r\n\t\t}\r\n\t}\r\n}","export default class Color {\r\n    private static bezier(t: number): number {\r\n        return t*t*(3-2*t);\r\n    }\r\n \r\n    public r: number;\r\n    public g: number;\r\n    public b: number;\r\n\r\n    constructor(r: number, g: number, b: number) {\r\n        this.r = r;\r\n        this.g = g;\r\n        this.b = b;\r\n    }\r\n\r\n    public transitionTo(other: Color, t: number): Color {\r\n        const b = Color.bezier(t);\r\n\r\n        return new Color((other.r - this.r) * b + this.r,\r\n                         (other.g - this.g) * b + this.g,\r\n                         (other.b - this.b) * b + this.b);\r\n    }\r\n\r\n    public equals(to: Color): boolean {\r\n        return this.r === to.r && this.g === to.g && this.b === to.b;\r\n    }\r\n\r\n    public asString(): string {\r\n        return \"rgb(\" + this.r + \",\" + this.g + \",\" + this.b + \")\";\r\n    }\r\n}","import Color from \"./color\";\r\n\r\nexport default class ColorAnimator {\r\n    private static fromColors: { [transitionID: string]: Color } = {};\r\n\tprivate static tMap: { [transitionID: string]: number } = {};\r\n\r\n    public static transition(transitionID: string, color: Color): Color {\r\n        if (!ColorAnimator.fromColors[transitionID]) {\r\n            ColorAnimator.fromColors[transitionID] = color;\r\n        }\r\n\r\n        if (ColorAnimator.tMap[transitionID] === undefined) {\r\n            ColorAnimator.tMap[transitionID] = 0;\r\n        }\r\n\r\n        if (!ColorAnimator.fromColors[transitionID].equals(color)) {\r\n            ColorAnimator.tMap[transitionID] += 0.064;\r\n\r\n            if (ColorAnimator.tMap[transitionID] > 1) {\r\n                ColorAnimator.tMap[transitionID] = 1;\r\n            }\r\n\r\n            return ColorAnimator.fromColors[transitionID].transitionTo(color, ColorAnimator.tMap[transitionID]);\r\n        } else {\r\n            ColorAnimator.tMap[transitionID] = 0;\r\n            ColorAnimator.fromColors[transitionID] = color;\r\n            return color;\r\n        }\r\n    }\r\n}","import Genome from '../rl/agents/neat/genome';\r\nimport NeuralNetwork from 'src/rl/agents/neat/neuralNetworks';\r\nimport DynamicColor from './dynamicColor';\r\nimport Color from './color';\r\nimport ColorAnimator from './colorAnimator';\r\n\r\nexport interface INeuronDrawData {\r\n\tsplitX: number;\r\n\tsplitY: number;\r\n\ttype: 'hidden' | 'input' | 'output';\r\n\tid: number;\r\n}\r\n\r\nexport interface ILinkDrawData {\r\n\tinIndex: number;\r\n\toutIndex: number;\r\n\tisEnabled: boolean;\r\n}\r\n\r\n/**\r\n * A helper class that implements common functionality for drawing on a canvas rendering context.\r\n * Origin at the canvas center. Y positive is up and Y negative is down. X positive is right and X negative is left.\r\n * May be made useful as an abstract rendering layer.\r\n */\r\nexport default class Draw {\r\n\tpublic static context?: CanvasRenderingContext2D;\r\n\t\r\n\t/**\r\n\t * Whether or not the x coordinates passed at draw methods are normalized.\r\n\t */\r\n\tpublic static normX = false;\r\n\r\n\t/**\r\n\t * Whether or not the y coordinates passed at draw methods are normalized.\r\n\t */\r\n\tpublic static normY = false;\r\n\r\n\t/**\r\n\t * Whether or not the widths passed at draw methods are normalized.\r\n\t */\r\n\tpublic static normWidth = false;\r\n\r\n\t/**\r\n\t * Whether or not the heights passed at draw methods are normalized.\r\n\t */\r\n\tpublic static normHeight = false;\r\n\r\n\t/**\r\n\t * Neural network drawing settings\r\n\t *\r\n\t * @static\r\n\t * @memberof Draw\r\n\t */\r\n\tpublic static inputNeuronLine = new DynamicColor(new Color(32,32,32), new Color(209,125,119), new Color(237,57,57));\r\n\tpublic static hiddenNeuronLine = new DynamicColor(new Color(32,32,32), new Color(115,150,255), new Color(237,57,57));\r\n\tpublic static outputNeuronLine = new DynamicColor(new Color(32,32,32), new Color(124,217,133), new Color(237,57,57));\r\n\r\n\tpublic static inputNeuron = new DynamicColor(new Color(32,32,32), new Color(209,209,209), new Color(237,57,57));\r\n\tpublic static hiddenNeuron = new DynamicColor(new Color(32,32,32), new Color(115,150,255), new Color(237,57,57));\r\n\tpublic static outputNeuron = new DynamicColor(new Color(32,32,32), new Color(76,237,118), new Color(32,32,32));\r\n\r\n\tpublic static linkLineWidth = 1.5;\r\n\tpublic static linkColor = '#454545';\r\n\r\n\tpublic static linkShadowBlur = 2;\r\n\r\n\tpublic static inputNeuronShadowBlur = 3;\r\n\tpublic static hiddenNeuronShadowBlur = 10;\r\n\tpublic static outputNeuronShadowBlur = 7;\r\n\r\n\tpublic static inputNeuronRadius = 0.01;\r\n\tpublic static hiddenNeuronRadius = 0.01;\r\n\tpublic static outputNeuronRadius = 0.01;\r\n\r\n\t/**\r\n\t * \"Denormalizes\" the given coordinate if normX is set to true.\r\n\t * If sizeX is not 0, also centers the coordinate.\r\n\t * @param y \r\n\t * @param sizeY \r\n\t */\r\n\tpublic static coordX(x: number, sizeX: number) {\r\n\t\treturn (Draw.context!.canvas.width - sizeX)/2 + (Draw.normX ? (Draw.context!.canvas.width * x / 2) : x);\r\n\t}\r\n\r\n\t/**\r\n\t * \"Denormalizes\" the given coordinate if normY is set to true.\r\n\t * If sizeY is not 0, also centers the coordinate.\r\n\t * @param y \r\n\t * @param sizeY \r\n\t */\r\n\tpublic static coordY(y: number, sizeY: number) {\r\n\t\treturn (Draw.context!.canvas.height - sizeY)/2 - ((Draw.normY ? (Draw.context!.canvas.height * y / 2) : y));\r\n\t}\r\n\t\r\n\tpublic static imageScaledRotated(image: HTMLImageElement, x: number, y: number, scale: number, angle: number) {\r\n\t\tconst sizeX = Draw.sizeX(image.naturalWidth * scale);\r\n\t\tconst sizeY = Draw.sizeY(image.naturalHeight * scale);\r\n\t\tconst coordX = Draw.coordX(x, sizeX);\r\n\t\tconst coordY = Draw.coordY(y, sizeY);\r\n\r\n\t\tconst pivotX = coordX + sizeX/2;\r\n\t\tconst pivotY = coordY + sizeY/2;\r\n\r\n\t\tDraw.context!.translate(pivotX, pivotY);\r\n\t\tDraw.context!.rotate(angle);\r\n\t\tDraw.context!.translate(-pivotX, -pivotY);\r\n\t\tDraw.context!.drawImage(image, coordX, coordY, sizeX, sizeY);\r\n\t\tDraw.context!.setTransform(1, 0, 0, 1, 0, 0);\r\n\t}\r\n\r\n\tpublic static imageScaled(image: HTMLImageElement, x: number, y: number, scale: number) {\r\n\t\tDraw.image(image, x, y, image.naturalWidth * scale, image.naturalHeight * scale);\r\n\t}\r\n\r\n\tpublic static image(image: HTMLImageElement, x: number, y: number, width: number, height: number) {\r\n\t\tconst sizeX = Draw.sizeX(width < 0 ? image.naturalWidth : width);\r\n\t\tconst sizeY = Draw.sizeY(height < 0 ? image.naturalHeight : height);\r\n\t\tconst coordX = Draw.coordX(x, sizeX);\r\n\t\tconst coordY = Draw.coordY(y, sizeY);\r\n\r\n\t\tDraw.context!.drawImage(image, coordX, coordY, sizeX, sizeY);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Clears the specified context with a clearRect call.\r\n\t */\r\n\tpublic static clear() {\r\n\t\tDraw.context!.clearRect(0, 0, Draw.context!.canvas.clientWidth, Draw.context!.canvas.clientHeight);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns context.canvas.clientWidth.\r\n\t */\r\n\tpublic static width() {\r\n\t\treturn Draw.context!.canvas.clientWidth;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns context.canvas.clientWidth.\r\n\t */\r\n\tpublic static height() {\r\n\t\treturn Draw.context!.canvas.clientHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Clears a rectangle at the canvas context with the given settings.\r\n\t * @param x \r\n\t * @param y \r\n\t * @param width \r\n\t * @param height \r\n\t * @param color \r\n\t */\r\n\tpublic static rectClear(x: number, y: number, width: number, height: number) {\r\n\t\tconst sizeX = Draw.sizeX(width);\r\n\t\tconst sizeY = Draw.sizeY(height);\r\n\t\tconst coordX = Draw.coordX(x, sizeX);\r\n\t\tconst coordY = Draw.coordY(y, sizeY);\r\n\r\n\t\tDraw.context!.clearRect(coordX, coordY, sizeX, sizeY);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Fills a rectangle at the canvas context with the given settings.\r\n\t * @param x \r\n\t * @param y \r\n\t * @param width \r\n\t * @param height \r\n\t * @param color \r\n\t */\r\n\tpublic static rectFill(x: number, y: number, width: number, height: number, color = 'red') {\r\n\t\tconst sizeX = Draw.sizeX(width);\r\n\t\tconst sizeY = Draw.sizeY(height);\r\n\t\tconst coordX = Draw.coordX(x, sizeX);\r\n\t\tconst coordY = Draw.coordY(y, sizeY);\r\n\r\n\t\tDraw.context!.fillStyle = color;\r\n\t\tDraw.context!.fillRect(coordX, coordY, sizeX, sizeY);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * X and Y must be denormalized.\r\n\t * Draws the given genome.\r\n\t * @param x\r\n\t * @param y\r\n\t * @param genome \r\n\t * @param fontColor\r\n\t */\r\n\tpublic static genome(x: number, y: number, genome: Genome, fontColor: string) {\r\n\t\tconst normX = Draw.normX;\r\n\t\tconst normY = Draw.normY;\r\n\t\tconst normWidth = Draw.normWidth;\r\n\t\tconst normHeight = Draw.normHeight;\r\n\r\n\t\tDraw.normX = Draw.normY = Draw.normWidth = Draw.normHeight = false;\r\n\t\tDraw.context!.lineWidth = 1;\r\n\r\n\t\tconst linkGenesHeight = 76;\r\n\t\tlet xOffset = 0;\r\n\r\n\t\tfor (const linkGene of genome.linkGenes) {\r\n\t\t\tif (!linkGene.isEnabled) {\r\n\t\t\t\tDraw.rectFill(x + xOffset, y - 16, 48, linkGenesHeight, '#e4e4e4');\r\n\t\t\t}\r\n\r\n\t\t\tDraw.text(x + xOffset, y, linkGene.innovation!.n + '', '400 14px sans-serif', fontColor);\r\n\t\t\tDraw.text(x + xOffset, y - 32, linkGene.inNeuron.id + \"->\" + linkGene.outNeuron.id, '400 14px sans-serif', fontColor);\r\n\r\n\t\t\tDraw.rectStroke(x + xOffset, y - 16, 48, linkGenesHeight, fontColor);\r\n\r\n\t\t\txOffset += 48;\r\n\t\t}\r\n\r\n\t\txOffset = 0;\r\n\t\t\r\n\t\tfor (const neuronGene of genome.neuronGenes) {\r\n\t\t\tDraw.text(x + xOffset, y - linkGenesHeight, neuronGene.id + '', '400 14px sans-serif', fontColor);\r\n\t\t\tDraw.text(x + xOffset, y - linkGenesHeight - 32, neuronGene.type, '400 14px sans-serif', fontColor);\r\n\t\t\tDraw.rectStroke(x + xOffset, y - linkGenesHeight - 16, 48, linkGenesHeight, fontColor);\r\n\t\t\txOffset += 48;\r\n\t\t}\r\n\r\n\t\tDraw.normX = normX;\r\n\t\tDraw.normY = normY;\r\n\t\tDraw.normWidth = normWidth;\r\n\t\tDraw.normHeight = normHeight;\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Strokes a rectangle at the canvas context with the given settings.\r\n\t * @param x \r\n\t * @param y \r\n\t * @param width \r\n\t * @param height \r\n\t * @param color \r\n\t */\r\n\tpublic static rectStroke(x: number, y: number, width: number, height: number, color = 'red') {\r\n\t\tconst sizeX = Draw.sizeX(width);\r\n\t\tconst sizeY = Draw.sizeY(height);\r\n\t\tconst coordX = Draw.coordX(x, sizeX);\r\n\t\tconst coordY = Draw.coordY(y, sizeY);\r\n\r\n\t\tDraw.context!.strokeStyle = color;\r\n\t\tDraw.context!.strokeRect(coordX, coordY, sizeX, sizeY);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Fills a circle at the specified location.\r\n\t * If normalized size is set to true, the radius percentage is relative to the canvas width.\r\n\t * @param x \r\n\t * @param y \r\n\t * @param radius \r\n\t * @param color \r\n\t * @param startAngle \r\n\t * @param endAngle \r\n\t */\r\n\tpublic static arcFill(x: number, y: number, radius: number, color: string, startAngle = 0, endAngle = Math.PI * 2) {\r\n\t\tDraw.arcPath(x, y, radius, startAngle, endAngle);\r\n\t\tDraw.context!.fillStyle = color;\r\n\t\tDraw.context!.fill();\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Fills a circle at the specified location.\r\n\t * If normalized size is set to true, the radius percentage is relative to the canvas width.\r\n\t * @param x \r\n\t * @param y \r\n\t * @param radius \r\n\t * @param color \r\n\t * @param startAngle \r\n\t * @param endAngle \r\n\t */\r\n\tpublic static arcStroke(x: number, y: number, radius: number, color = 'red', lineWidth = 5, startAngle = 0, endAngle = Math.PI * 2) {\r\n\t\tDraw.arcPath(x, y, radius, startAngle, endAngle);\r\n\t\tDraw.context!.strokeStyle = color;\r\n\t\tDraw.context!.lineWidth = lineWidth;\r\n\t\tDraw.context!.stroke();\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Draws a line at the specified context with the given arguments.\r\n\t * @param fromX \r\n\t * @param fromY \r\n\t * @param toX \r\n\t * @param toY \r\n\t * @param color \r\n\t * @param lineWidth\r\n\t * @param transitionID if greater than 0, transitions from the previous color to the next.\r\n\t */\r\n\tpublic static line(fromX: number, fromY: number, toX: number, toY: number, color: Color, lineWidth = 5, transitionID?: string) {\r\n\t\tlet strokeStyle = color.asString();\r\n\t\t\r\n\t\tif (!!transitionID) {\r\n\t\t\tstrokeStyle = ColorAnimator.transition(transitionID, color).asString();\r\n\t\t}\r\n\t\t\r\n\t\tDraw.context!.lineWidth = lineWidth;\r\n\t\tDraw.context!.strokeStyle = strokeStyle;\r\n\r\n\t\tconst fX = Draw.coordX(fromX, 0);\r\n\t\tconst fY = Draw.coordY(fromY, 0);\r\n\t\tconst tX = Draw.coordX(toX, 0);\r\n\t\tconst tY = Draw.coordY(toY, 0);\r\n\t\t\r\n\t\tDraw.context!.beginPath();\r\n\t\tDraw.context!.moveTo(fX, fY);\r\n\t\tDraw.context!.lineTo(tX, tY);\r\n\t\tDraw.context!.closePath();\r\n\r\n\t\tDraw.context!.stroke();\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Draws an arrow at the specified context with the given arguments.\r\n\t * @param fromX \r\n\t * @param fromY \r\n\t * @param toX \r\n\t * @param toY \r\n\t * @param color \r\n\t * @param lineWidth \r\n\t * @param headLength \r\n\t */\r\n\tpublic static arrow(fromX: number, fromY: number, toX: number, toY: number, color = 'red', lineWidth: number = 5, headLength: number = 10) {\t\t\r\n\t\tconst fX = Draw.coordX(fromX, 0);\r\n\t\tconst fY = Draw.coordY(fromY, 0);\r\n\t\tconst tX = Draw.coordX(toX, 0);\r\n\t\tconst tY = Draw.coordY(toY, 0);\r\n\r\n\t\tconst angle = Math.atan2(tY - fY, tX - fX);\r\n\r\n\t\tDraw.context!.lineWidth = lineWidth;\r\n\t\tDraw.context!.strokeStyle = color;\r\n\r\n\t\tDraw.context!.beginPath();\r\n\t\tDraw.context!.moveTo(fX, fY);\r\n\t\tDraw.context!.lineTo(tX, tY);\r\n\t\tDraw.context!.moveTo(tX, tY);\r\n\t\tDraw.context!.lineTo(tX - headLength * Math.cos(angle - Math.PI/6), tY - headLength * Math.sin(angle - Math.PI/6));\r\n\t\tDraw.context!.moveTo(tX, tY);\r\n\t\tDraw.context!.lineTo(tX - headLength * Math.cos(angle + Math.PI/6), tY - headLength * Math.sin(angle + Math.PI/6));\r\n\t\tDraw.context!.closePath();\r\n\r\n\t\tDraw.context!.stroke();\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Fills a text at the specified context with the given arguments\r\n\t * @param x \r\n\t * @param y \r\n\t * @param text \r\n\t * @param font \r\n\t * @param color \r\n\t */\r\n\tpublic static text(x: number, y: number, text: string, font: string, color = 'red', textAlign: 'center' | 'left' | 'right' = 'center') {\r\n\t\tconst coordX = Draw.coordX(x, 0);\r\n\t\tconst coordY = Draw.coordY(y, 0);\r\n\r\n\t\tDraw.context!.fillStyle = color;\r\n\t\tDraw.context!.font = font;\r\n\t\tDraw.context!.textAlign = textAlign;\r\n\t\tDraw.context!.fillText(text, coordX, coordY);\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Sets line dashing settings.\r\n\t * @param dashLength if lesser or equal to zero, no dashing will occur.\r\n\t * @param dashSpacing if lesser or equal to zero, no dashing will occur.\r\n\t */\r\n\tpublic static setLineDash(dashLength = 0, dashSpacing = 0) {\r\n\t\tif (dashLength > 0 && dashSpacing > 0) {\r\n\t\t\tDraw.context!.setLineDash([dashLength, dashSpacing]);\r\n\t\t} else {\r\n\t\t\tDraw.context!.setLineDash([]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Sets line cap settings.\r\n\t * @param cap \r\n\t */\r\n\tpublic static setLineCap(cap: 'round' | 'square' | 'butt') {\r\n\t\tDraw.context!.lineCap = cap;\r\n\t}\r\n\r\n\tpublic static neuralNetwork(x: number, y: number, width: number, height: number, neurons: INeuronDrawData[], links: ILinkDrawData[], phenotype: NeuralNetwork | undefined) {\r\n\t\tconst sizeX = Draw.sizeX(width);\r\n\t\tconst sizeY = Draw.sizeY(height);\r\n\t\tconst coordX = Draw.coordX(x + width*2, sizeX + Draw.context!.canvas.width);\r\n\t\tconst coordY = Draw.coordY(y, sizeY + Draw.context!.canvas.height);\r\n\r\n\t\tconst normX = Draw.normX;\r\n\t\tconst normY = Draw.normY;\r\n\t\tDraw.normX = Draw.normY = false;\r\n\r\n\t\tfor (const link of links) {\r\n\t\t\tconst from = neurons[link.inIndex];\r\n\t\t\tconst to = neurons[link.outIndex];\r\n\r\n\t\t\tlet linkValue = 0.5;\r\n\r\n\t\t\tif (!!phenotype) {\r\n\t\t\t\tfor (const neuronData of phenotype.neurons) {\r\n\t\t\t\t\tif (from.id === neuronData.id) {\t\t\t\t\r\n\t\t\t\t\t\tlinkValue = neuronData.output;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst fromX = coordX + sizeX * -from.splitY;\r\n\t\t\tconst fromY = coordY + sizeY * from.splitX;\r\n\t\t\t\r\n\t\t\tconst toX = coordX + sizeX * -to.splitY;\r\n\t\t\tconst toY = coordY + sizeY * to.splitX;\r\n\t\t\tconst lineWidth = Math.max(Draw.linkLineWidth * Math.abs(linkValue), 0.5);\r\n\r\n\t\t\tlet fill = new Color(0, 0, 0);\r\n\r\n\t\t\tif (to.type === \"output\") {\r\n\t\t\t\tfill = Draw.outputNeuronLine.pick(linkValue);\r\n\t\t\t} else if (to.type === \"hidden\") {\r\n\t\t\t\tfill = Draw.hiddenNeuronLine.pick(linkValue)\r\n\t\t\t} else if (from.type === \"input\") {\r\n\t\t\t\tfill = Draw.inputNeuronLine.pick(linkValue);\r\n\t\t\t}\r\n\r\n\t\t\tDraw.context!.shadowBlur = 0; // Draw.linkShadowBlur * Math.abs(linkValue);\r\n\t\t\t// Draw.context!.shadowColor = fill.asString();\r\n\t\t\tDraw.line(fromX, fromY, toX, toY, fill, lineWidth, from.id + \"T\" + to.id);\r\n\t\t}\r\n\r\n\t\tfor (const neuron of neurons) {\r\n\t\t\tconst neuronX = coordX + sizeX * -neuron.splitY;\r\n\t\t\tconst neuronY = coordY + sizeY * neuron.splitX;\r\n\t\t\t\r\n\t\t\tlet neuronValue = 0.5;\r\n\r\n\t\t\tif (!!phenotype) {\r\n\t\t\t\tfor (const neuronData of phenotype.neurons) {\r\n\t\t\t\t\tif (neuron.id === neuronData.id) {\t\t\t\t\r\n\t\t\t\t\t\tneuronValue = neuronData.output;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (neuron.type === 'input') {\r\n\t\t\t\tconst fill = ColorAnimator.transition(\"N\" + neuron.id, Draw.inputNeuron.pick(neuronValue)).asString();\r\n\r\n\t\t\t\tDraw.context!.shadowBlur = Draw.inputNeuronShadowBlur * Math.abs(neuronValue);\r\n\t\t\t\tDraw.context!.shadowColor = fill;\r\n\t\t\t\tDraw.arcFill(neuronX, neuronY, Draw.inputNeuronRadius, fill);\r\n\t\t\t} else if (neuron.type === 'hidden') {\r\n\t\t\t\tconst fill = ColorAnimator.transition(\"N\" + neuron.id, Draw.hiddenNeuron.pick(neuronValue)).asString();\t\t\t\r\n\t\t\t\tconst blur = Draw.hiddenNeuronShadowBlur * Math.abs(neuronValue);\r\n\r\n\t\t\t\tDraw.context!.shadowBlur = blur;\r\n\t\t\t\tDraw.context!.shadowColor = fill;\r\n\r\n\t\t\t\tDraw.arcFill(neuronX, neuronY, Draw.hiddenNeuronRadius, fill);\r\n\t\t\t} else if (neuron.type === 'output') {\r\n\t\t\t\tconst fill = ColorAnimator.transition(\"N\" + neuron.id, Draw.outputNeuron.pick(neuronValue)).asString();\r\n\r\n\t\t\t\tDraw.context!.shadowBlur = Draw.outputNeuronShadowBlur * Math.abs(neuronValue);\r\n\t\t\t\tDraw.context!.shadowColor = fill;\r\n\t\t\t\tDraw.arcFill(neuronX, neuronY, Draw.outputNeuronRadius, fill);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tDraw.normX = normX;\r\n\t\tDraw.normY = normY;\r\n\r\n\t\tDraw.context!.shadowBlur = 0;\r\n\t\tDraw.context!.shadowColor = \"rgba(0, 0, 0, 0)\";\r\n\t}\r\n\r\n\t/**\r\n\t * Draw.context must be set before calling this.\r\n\t * Sets the transformation of the context to a translation to (x, y)\r\n\t * @param x \r\n\t * @param y \r\n\t */\r\n\tpublic static setTranslation(x: number, y: number) {\r\n\t\tconst tx = Draw.normX ? (Draw.context!.canvas.width * x / 2) : x;\r\n\t\tconst ty = - (Draw.normY ? (Draw.context!.canvas.height * y / 2) : y);\r\n\t\tDraw.context!.setTransform(1, 0, 0, 1, tx, ty);\r\n\t}\r\n\r\n\t/**\r\n\t * Internal helper method.\r\n\t * Creates an arc path at Draw.context.\r\n\t * @param x \r\n\t * @param y \r\n\t * @param radius \r\n\t * @param startAngle \r\n\t * @param endAngle \r\n\t */\r\n\tprivate static arcPath(x: number, y: number, radius: number, startAngle = 0, endAngle = Math.PI * 2) {\r\n\t\tconst size = Draw.sizeX(radius);\r\n\t\tconst coordX = Draw.coordX(x, 0);\r\n\t\tconst coordY = Draw.coordY(y, 0);\r\n\r\n\t\tDraw.context!.beginPath();\r\n\t\tDraw.context!.arc(coordX, coordY, size, startAngle, endAngle, false);\r\n\t}\r\n\r\n\t/**\r\n\t * \"Denormalizes\" the given width if normHeight is set to true.\r\n\t * @param height \r\n\t */\r\n\tprivate static sizeX(width: number) {\r\n\t\treturn width * (Draw.normWidth ?  Draw.context!.canvas.width : 1);\r\n\t}\r\n\r\n\t/**\r\n\t * \"Denormalizes\" the given height if normHeight is set to true.\r\n\t * @param height \r\n\t */\r\n\tprivate static sizeY(height: number) {\r\n\t\treturn height * (Draw.normHeight ?  Draw.context!.canvas.height : 1);\r\n\t}\r\n\r\n\tprivate constructor() {}\r\n}","import Draw from './index';\r\n\r\ninterface ILog {\r\n\ttext: string;\r\n\ttype: 'print' | 'warn' | 'error';\r\n\tdisplayTime: number;\r\n\tstartTime?: number;\r\n}\r\n\r\n/**\r\n * Handles log drawing at a canvas.\r\n */\r\nexport default class DrawLog {\r\n\tpublic static printToConsole = true;\r\n\r\n\t/**\r\n\t * Adds a print log to the log list.\r\n\t * It will be rendered when render() is called.\r\n\t * @param text \r\n\t * @param displayTime in seconds.\r\n\t */\r\n\tpublic static print(text: string, displayTime = 2.5) {\r\n\t\tDrawLog.latestLogs.push({ text, displayTime, type: 'print' });\r\n\t\t\r\n\t\tif (DrawLog.printToConsole) {\r\n\t\t\tconsole.log(text);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a warning log to the log list.\r\n\t * It will be rendered when render() is called.\r\n\t * @param text \r\n\t */\r\n\tpublic static warn(text: string, displayTime = 2.5) {\r\n\t\tDrawLog.latestLogs.push({ text, displayTime, type: 'warn' });\r\n\r\n\t\tif (DrawLog.printToConsole) {\r\n\t\t\tconsole.warn(text);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adds an error log to the log list.\r\n\t * It will be rendered when render() is called.\r\n\t * @param text \r\n\t */\r\n\tpublic static error(text: string, displayTime = 2.5) {\r\n\t\tDrawLog.latestLogs.push({ text, displayTime, type: 'error' });\r\n\t\t\r\n\t\tif (DrawLog.printToConsole) {\r\n\t\t\tconsole.error(text);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic static render(context: CanvasRenderingContext2D) {\r\n\t\tfor (const log of DrawLog.latestLogs) {\r\n\t\t\tif (!log.startTime) {\r\n\t\t\t\tlog.startTime = performance.now();\r\n\t\t\t\tDrawLog.logs.push(log);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tDraw.context = context;\r\n\t\tDraw.normX = true;\r\n\r\n\t\tlet y = -32;\r\n\t\t\r\n\t\tfor (let i = DrawLog.logs.length - 1; i >= 0; --i) {\r\n\t\t\tif (performance.now() - DrawLog.logs[i].startTime! >= DrawLog.logs[i].displayTime * 1000) {\r\n\t\t\t\tDrawLog.logs.splice(i, 1);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet color = 'black';\r\n\r\n\t\t\tif (DrawLog.logs[i].type === 'warn') {\r\n\t\t\t\tcolor = '#b2880a';\r\n\t\t\t} else if (DrawLog.logs[i].type === 'error') {\r\n\t\t\t\tcolor = 'red';\r\n\t\t\t\t}\r\n\r\n\t\t\tDraw.normY = false;\r\n\t\t\tDraw.setTranslation(0, y);\r\n\r\n\t\t\tDraw.normY = true;\r\n\t\t\tDraw.text(-0.98, 0.98, DrawLog.logs[i].text, '400 13px sans-serif', color);\r\n\r\n\t\t\ty -= 16;\r\n\t\t}\r\n\r\n\t\tDraw.setTranslation(0, 0);\r\n\t}\r\n\r\n\tprivate static latestLogs: ILog[] = [];\r\n\tprivate static logs: ILog[] = [];\r\n}","/**\r\n * A number with stablished bounds that might be whole.\r\n * The \"type classification\" is useful for displaying purposes and dynamic number validity checks.\r\n */\r\nexport default class Scalar {\r\n\t/**\r\n\t * Adds each scalar from the specified object to an array of scalars.\r\n\t * @param obj \r\n\t * @param to\r\n\t */\r\n\tpublic static addScalarsFromObjectToArray(obj: any, to: Scalar[]) {\r\n\t\tfor (const key in obj) {\r\n\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\tconst prop = obj[key];\r\n\t\t\t\t\r\n\t\t\t\tif ((prop.familyName != null) && (prop.name != null) && (prop.value != null) && (prop.min != null) && (prop.max != null) && (prop.isWhole != null)) {\r\n\t\t\t\t\tto.push(prop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic isWhole = false;\r\n\tpublic min = Number.NEGATIVE_INFINITY;\r\n\tpublic max = Number.POSITIVE_INFINITY;\r\n\tpublic value: number;\r\n\r\n\tpublic readonly name: string;\r\n\tpublic readonly familyName: string;\r\n\r\n\t/**\r\n\t * Name used to represent this scalar on a formula (eg. if this obs is an angle, this value may be \"θ\")\r\n\t */\r\n\tpublic readonly formulaName: string;\r\n\r\n\tpublic constructor(familyName: string, name: string, value: number, formulaName?: string) {\r\n\t\tthis.familyName = familyName;\r\n\t\tthis.name = name;\r\n\t\tthis.value = value;\r\n\t\t\r\n\t\tif (!formulaName) {\r\n\t\t\tthis.formulaName = name;\r\n\t\t} else {\r\n\t\t\tthis.formulaName = formulaName;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns true if this.value is within the specified range and is whole if set to be so\r\n\t */\r\n\tpublic isValid(forValue: number) : boolean {\r\n\t\treturn this.min <= forValue && forValue <= this.max && (!this.isWhole || Number.isInteger(forValue));\r\n\t}\r\n\r\n\tpublic ranged(min: number, max: number) : Scalar {\r\n\t\tthis.min = min;\r\n\t\tthis.max = max;\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic wholeNumber() : Scalar {\r\n\t\tthis.isWhole = true;\r\n\t\treturn this;\r\n\t}\r\n}","type StringParamType = 'text' | 'file';\r\n\r\nexport default class StringParam {\r\n\t/**\r\n\t * Adds each string param from the specified object to an array of string params.\r\n\t *\r\n\t * @static\r\n\t * @param {*} obj\r\n\t * @param {StringParam[]} to\r\n\t * @memberof StringParam\r\n\t */\r\n\tpublic static addStringParamsFromObjectToArray(obj: any, to: StringParam[]) {\r\n\t\tfor (const key in obj) {\r\n\t\t\tif (obj.hasOwnProperty(key)) {\r\n\t\t\t\tconst prop = obj[key];\r\n\t\t\t\t\r\n\t\t\t\tif ((prop.familyName != null) && (prop.name != null) && (prop.values != null) && (prop.type != null)) {\r\n\t\t\t\t\tto.push(prop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic values: string[];\r\n\t\r\n\tpublic fileNames: string[];\r\n\r\n\tpublic readonly name: string;\r\n\tpublic readonly familyName: string;\r\n\r\n\t/**\r\n\t * Name used to represent this scalar on a formula (eg. if this obs is an angle, this value may be \"θ\")\r\n\t */\r\n\tpublic readonly type: StringParamType;\r\n\r\n\tpublic constructor(familyName: string, name: string, value: string, type: StringParamType) {\r\n\t\tthis.familyName = familyName;\r\n\t\tthis.name = name;\r\n\t\tthis.values = [ value ];\r\n\t\tthis.fileNames = [];\r\n\t\tthis.type = type;\r\n\t}\r\n}","import EnvironmentModel from \"../envs/environmentModel\";\r\nimport Scalar from '../scalar';\r\nimport Individual from './individual';\r\nimport StringParam from \"../stringParam\";\r\n\r\ntype Int = number;\r\n\r\nexport default abstract class AgentModel {\r\n\t/**\r\n\t * Name string must be in camel case and have no spaces.\r\n\t * Digits are allowed after the first character.\r\n\t */\r\n\tpublic readonly modelName: string;\r\n\r\n\tpublic readonly env: EnvironmentModel;\r\n\r\n\t/**\r\n\t * Array of initial scalar parameters for this model.\r\n\t */\r\n\tpublic readonly paramsArray: Scalar[];\r\n\r\n\t/**\r\n\t * Array of initial string parameters for this model.\r\n\t */\r\n\tpublic readonly stringParamsArray: StringParam[];\r\n\t\r\n\t/**\r\n\t * Index at the individual array of the individual that is currently being evaluated.\r\n\t */\r\n\tprivate index: Int;\r\n\r\n\tprivate hasDoneFirstEval: boolean;\r\n\r\n\tpublic constructor(modelName: string, env: EnvironmentModel) {\r\n\t\tthis.modelName = modelName;\r\n\t\tthis.paramsArray = [];\r\n\t\tthis.stringParamsArray = [];\r\n\t\tthis.env = env;\r\n\t\tthis.index = -1;\r\n\t\tthis.hasDoneFirstEval = false;\r\n\t}\r\n\r\n\tpublic reset(newParamsArray: Scalar[]) {\r\n\t\tfor (const newParam of newParamsArray) {\r\n\t\t\tfor (const param of this.paramsArray) {\r\n\t\t\t\tif (param.familyName === newParam.familyName && param.name === newParam.name) {\r\n\t\t\t\t\tparam.value = newParam.value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic abstract goalReached() : void;\r\n\r\n\tpublic abstract resetState() : void;\r\n\r\n\t/**\r\n\t * Should call the tick method\r\n\t * @param delta \r\n\t */\r\n\tpublic abstract loop(delta: number) : void;\r\n\r\n\tpublic abstract draw(context: CanvasRenderingContext2D) : void;\r\n\r\n\tpublic abstract prepareForIndividual(individual: Individual) : void;\r\n\r\n\t/**\r\n\t * Sets the value for each of the environment's actions.\r\n\t */\r\n\tpublic abstract act() : void;\r\n\r\n\tpublic abstract epoch() : void;\r\n\r\n\t/**\r\n\t * Should be called in the loop function.\r\n\t * Evaluates fitness for all individuals, then runs epoch.\r\n\t * Repeats until the agent stops on some condition imposed at superclasses.\r\n\t * @param delta \r\n\t * @param individuals \r\n\t */\r\n\tprotected lifecycle(delta: number, individuals: Individual[]) {\r\n\t\tif (this.index >= individuals.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Are we currently evaluating an individual?\r\n\t\tif (this.index >= 0) {\r\n\t\t\t// Make the individual act on the environment\r\n\t\t\tthis.act();\r\n\t\t\t\r\n\t\t\t// If step returns true, the fitness evaluation for the current individual should end and the index is incremented.\r\n\t\t\tif (this.env.step(delta)) {\r\n\t\t\t\tindividuals[this.index].fitness = this.env.fitness();\r\n\t\t\t\t++this.index;\r\n\r\n\t\t\t\t// If there are no individuals left, the index is set to -1, and epoch gets called next tick\r\n\t\t\t\tif (this.index > individuals.length - 1) {\r\n\t\t\t\t\tthis.index = -1;\r\n\t\t\t\t\tthis.hasDoneFirstEval = true;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.prepareForIndividual(individuals[this.index]);\r\n\t\t\t\tthis.env.prepareForNewIndividual();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.hasDoneFirstEval) {\r\n\t\t\t\tthis.env.prepareForEpoch();\r\n\t\t\t\tthis.epoch();\r\n\t\t\t}\r\n\r\n\t\t\t// Fitness evaluation is going to be done next time tick is called\r\n\t\t\tthis.index = 0;\r\n\t\t\tthis.prepareForIndividual(individuals[this.index]);\r\n\t\t\tthis.env.prepareForNewIndividual();\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds each scalar from the specified object as a paramater for this model\r\n\t * @param obj \r\n\t */\r\n\tprotected addParamsFromObject(obj: any) {\r\n\t\tScalar.addScalarsFromObjectToArray(obj, this.paramsArray);\r\n\t\tStringParam.addStringParamsFromObjectToArray(obj, this.stringParamsArray);\r\n\t}\r\n\r\n\tprotected addParam(scalar: Scalar) : Scalar {\r\n\t\tthis.paramsArray.push(scalar);\r\n\t\treturn scalar;\r\n\t}\r\n}","import LinkGene from './linkGene';\r\n\r\nexport default class AlleleGenesData {\r\n    public matchingGenesA: LinkGene[] = [];\r\n    public matchingGenesB: LinkGene[] = [];\r\n    public disjointGenesA: LinkGene[] = [];\r\n    public disjointGenesB: LinkGene[] = [];\r\n    public excessGenesA: LinkGene[] = [];\r\n    public excessGenesB: LinkGene[] = [];\r\n}\r\n","/**\r\n * A class that has a fitness value / score.\r\n */\r\nexport default class Individual {\r\n\tpublic fitness: number = 0;\r\n}","import Innovation from './innovation';\r\nimport NeuronGene from './neuronGene';\r\n\r\n/**\r\n * A Link Gene. Use the community to the determine the innovation number.\r\n */\r\nexport default class LinkGene {\r\n\tpublic inNeuron: NeuronGene;\r\n\tpublic outNeuron: NeuronGene;\r\n\tpublic weight: number;\r\n\tpublic isEnabled: boolean;\r\n\tpublic readonly innovation?: Innovation;\r\n\r\n\tconstructor(inNeuron: NeuronGene, outNeuron: NeuronGene, weight: number, isEnabled: boolean, innovation?: Innovation) {\r\n\t\tthis.inNeuron = inNeuron;\r\n\t\tthis.outNeuron = outNeuron;\r\n\t\tthis.weight = weight;\r\n\t\tthis.isEnabled = isEnabled;\r\n\t\tthis.innovation = innovation;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns a new instance of this LinkGene.\r\n\t * Does not copy innovations - passes them by reference instead.\r\n\t * @param clonedInNeuron \r\n\t * @param clonedOutNeuron \r\n\t */\r\n\tpublic clone(clonedInNeuron: NeuronGene, clonedOutNeuron: NeuronGene) {\r\n\t\t// We are passing this.innovation by reference here, so it's not really copying everything\r\n\t\t// However, innovations should never change for a existing gene, so it makes no difference\r\n\t\treturn new LinkGene(clonedInNeuron, clonedOutNeuron, this.weight, this.isEnabled, this.innovation);\r\n\t}\r\n}\r\n","type Int = number;\r\n\r\n/**\r\n * Structure to store runtime data for each neuron\r\n */\r\nexport default class NeuronData {\r\n\tpublic id: Int;\r\n\tpublic input: number;\r\n\tpublic output: number;\r\n\r\n\tconstructor(id: Int, input: number, output: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.input = input;\r\n\t\tthis.output = output;\r\n\t}\r\n}","type Int = number;\r\n\r\n/**\r\n * Structure to store runtime data for each neuron\r\n */\r\nexport default class StringNeuronData {\r\n\tpublic id: Int;\r\n\tpublic input: string;\r\n\tpublic output: string;\r\n\r\n\tconstructor(id: Int, input: string, output: string) {\r\n\t\tthis.id = id;\r\n\t\tthis.input = input;\r\n\t\tthis.output = output;\r\n\t}\r\n}","import StringNeuronData from './stringNeuronData';\r\nimport Genome from '../genome';\r\nimport LinkGene from '../genome/linkGene';\r\nimport NeuronGene from '../genome/neuronGene';\r\n\r\ntype Int = number;\r\n\r\nexport default class StringNeuralNetwork {\r\n\t/**\r\n\t * Prevents RangeError (exceeding maximum string length).\r\n\t * @private\r\n\t * @static\r\n\t */\r\n\tprivate static maximumStringLength = (1 << 27) - 10;\r\n\r\n\tpublic neurons: StringNeuronData[];\r\n\tprivate precisionMul: number = 100;\r\n\r\n\tconstructor(genome: Genome, floatDigitsPrecision: number) {\r\n\t\tthis.neurons = [];\r\n\t\tthis.precisionMul = Math.pow(10, floatDigitsPrecision);\r\n\r\n\t\tfor (let i = 0; i < genome.neuronGenes.length; ++i) {\r\n\t\t\tconst neuron = genome.neuronGenes[i];\r\n\r\n\t\t\t// Empty strings for now\r\n\t\t\tthis.neurons.push(new StringNeuronData(neuron.id, \"\", \"\"));\r\n\r\n\t\t\t// Adds bias if it exists and is not zero\r\n\t\t\tif (neuron.type !== 'input' && neuron.bias !== 0.0) {\r\n\t\t\t\tthis.neurons[i].input = \"\" + this.numberToStr(neuron.bias!);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic feedForward(links: LinkGene[]) {\r\n\t\tfor (const link of links) {\r\n\t\t\tif (!link.isEnabled || link.inNeuron.id === link.outNeuron.id) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst inIndex = this.getNeuronIndexByID(link.inNeuron.id);\r\n\t\t\tconst outIndex = this.getNeuronIndexByID(link.outNeuron.id);\r\n\t\t\tlet prefix = (!!this.neurons[outIndex].input ? \"+\" : \"\");\r\n\t\t\tconst weightString = this.numberToStr(link.weight);\r\n\r\n\t\t\tif (weightString.startsWith(\"-\")) {\r\n\t\t\t\tprefix = \"\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.neurons[outIndex].input = this.appendToStr(this.neurons[outIndex].input, prefix + weightString + \"*\" + this.neurons[inIndex].output);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getNeuronIndexByID(id: Int) : Int {\r\n\t\tfor (let i = 0; i < this.neurons.length; ++i) {\r\n\t\t\tif (this.neurons[i].id === id) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.warn(\"Runtime index requested for invalid ID: \" + id);\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Internal use.\r\n\t * Returns the NeuronData for the neuron with the given ID.\r\n\t * @param  network\r\n\t * @param  id\r\n\t * @return\r\n\t */\r\n\tpublic getNeuronDataByID(id: Int) : StringNeuronData | undefined {\r\n\t\tfor (const neuron of this.neurons) {\r\n\t\t\tif (neuron.id === id) {\r\n\t\t\t\treturn neuron;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.warn(\"Runtime data requested for invalid ID: \" + id);\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Activates a neural network's neuron, and returns the activated neuron output\r\n\t * Neuron must not be of type hidden or output\r\n\t * @param  neuron\r\n\t */\r\n\tpublic activateNeuron(neuronGene: NeuronGene) : string {\r\n\t\tif (neuronGene.type !== \"hidden\" && neuronGene.type !== \"output\") {\r\n\t\t\tconsole.warn(\"Tried to activate an input neuron!\");\r\n\t\t\treturn \"NULL\";\r\n\t\t}\r\n\r\n\t\tconst index = this.getNeuronIndexByID(neuronGene.id);\r\n\r\n\t\t// Is looped recurrent link?\r\n\t\tif (neuronGene.loopedLink) {\r\n\t\t\t// See http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/\r\n\t\t\t// RNN unfold\r\n\t\t\t// RNN memory getNeuronIndexByID should be the same as our current neurons' getNeuronIndexByID\r\n\t\t\tconst prefix = !!this.neurons[index].input ? \"+\" : \"\";\r\n\t\t\tthis.neurons[index].input = this.appendToStr(this.neurons[index].input, prefix + this.numberToStr(neuronGene.loopedLink.weight) + \"*M\" + index);\r\n\t\t}\r\n\r\n\t\tthis.neurons[index].output = this.appendToStr(this.neurons[index].output, \"𝛼(\" + this.neurons[index].input + \")\");\r\n\t\t\r\n\t\treturn this.neurons[index].output;\r\n\t}\r\n\r\n\t/**\r\n\t * Safely appends strToAppend to dst. Prevents RangeErrors.\r\n\t *\r\n\t * @private\r\n\t * @param {string} dstlllllllllllll\r\n\t * @param {string} strToAppend\r\n\t * @memberof StringNeuralNetwork\r\n\t */\r\n\tprivate appendToStr(dst: string, strToAppend: string) {\r\n\t\tif (dst.length + strToAppend.length <= StringNeuralNetwork.maximumStringLength) {\r\n\t\t\treturn dst + strToAppend;\r\n\t\t}\r\n\r\n\t\tconsole.warn(\"Attempted to append to dst a string with length \" + strToAppend.length + \". Dst length is: \" + dst.length + \".\");\r\n\t\treturn dst;\r\n\t}\r\n\r\n\tprivate numberToStr(n: number) {\r\n\t\treturn String(Math.round(n * this.precisionMul) / this.precisionMul);\r\n\t}\r\n}","import Genome from '../genome';\r\nimport LinkGene from '../genome/linkGene';\r\nimport NeuronData from './neuronData';\r\nimport NeuronGene from '../genome/neuronGene';\r\nimport StringNeuralNetwork from './stringNeuralNetwork';\r\n\r\ntype Int = number;\r\n\r\nfunction beautifyFormulaString(str: string) {\r\n\treturn str.replace(/1\\*/g, \"\").replace(/\\*1/g, \"\").replace(/\\*/g, \"\");\r\n}\r\n\r\n/**\r\n * A Neural network that may have looped recurrencies\r\n * Depth defines the amount of unfolding/size of memory stored for looped recurrent links\r\n * Only single looped recurrencies are allowed - there must be no loops defined between multiple neurons\r\n * @param  {Genome} genome\r\n * @param  {number} depth\r\n * @constructor\r\n */\r\nexport default class NeuralNetwork {\r\n\tpublic readonly genome: Genome;\r\n\r\n\t/**\r\n\t * Runtime input/output data used during activation.\r\n\t */\r\n\tpublic readonly neurons: NeuronData[] = [];\r\n\r\n\t/**\r\n\t * Holds the previous neuron data.\r\n\t * Used in recursive links.\r\n\t */\r\n\tprivate rnnMemory: NeuronData[] = [];\r\n\r\n\tprivate hasActivated: boolean = false;\r\n\r\n\tconstructor(genome: Genome) {\r\n\t\tthis.genome = genome;\r\n\t}\r\n\r\n    public generateFormula(inputsAsFormulaNames: string[], digitsPrecision: Int) : string[] {\r\n\t\tconst nn = new StringNeuralNetwork(this.genome, digitsPrecision);\r\n\r\n\t\tconst finalOutputs: string[] = [];\r\n\r\n\t\tthis.genome.iterate(\r\n\t\t\t(inputNeuron, outLinks, _) => {\r\n\t\t\t\t// Note that the index is from the genome's array\r\n\t\t\t\tconst i = nn.getNeuronIndexByID(inputNeuron.id);\r\n\t\t\t\tnn.neurons[i].input = nn.neurons[i].output = inputsAsFormulaNames[i];\r\n\t\t\t\tnn.feedForward(outLinks);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\t(hiddenNeuron, outLinks, _) => {\r\n\t\t\t\t// Note that the index is from the genome's array\r\n\t\t\t\tnn.activateNeuron(hiddenNeuron);\r\n\t\t\t\tnn.feedForward(outLinks);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\t(outputNeuron, _) => {\r\n\t\t\t\t// Note that the index is from the genome's array\r\n\t\t\t\tnn.activateNeuron(outputNeuron);\r\n\t\t\t\tfinalOutputs.push(nn.getNeuronDataByID(outputNeuron.id)!.output);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\t// Beautifies formula and returns\r\n\t\treturn finalOutputs.map(element => beautifyFormulaString(element));\r\n    }\r\n\r\n    /**\r\n     * Activates the neural network with the given inputs\r\n     * Returns the output from the NeuralNetwork, or\r\n     * undefined if the number of inputs given isn't the same as the number of input neurons in the network\r\n     * @param  inputs\r\n     * @return\r\n     */\r\n\tpublic activate(inputs: number[]) : number[] {\r\n\t\tif (inputs.length !== this.genome.inputCount) {\r\n\t\t\tconsole.warn(`Tried to activate a phenotype passing an incorrect number of inputs for the original genome. Genome input count: ${this.genome.inputCount}. Passed input count: ${inputs.length}.`);\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tthis.prepareForActivation();\r\n\r\n\t\tconst outputs: number[] = [];\r\n\t\tconst network = this;\r\n\r\n\t\tthis.genome.iterate(\r\n\t\t\t(inputNeuron, outLinks, _) => {\r\n\t\t\t\t// Note that the index is from the genome's array\r\n\t\t\t\tconst i = network.getNeuronIndexByID(inputNeuron.id);\r\n\t\t\t\tnetwork.neurons[i].input = network.neurons[i].output = inputs[i];\r\n\t\t\t\tnetwork.feedForward(outLinks);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\t(hiddenNeuron, outLinks, _) => {\r\n\t\t\t\t// Note that the index is from the genome's array\r\n\t\t\t\tnetwork.activateNeuron(hiddenNeuron);\r\n\t\t\t\tnetwork.feedForward(outLinks);\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\t(outputNeuron, _) => {\r\n\t\t\t\t// Note that the index is from the genome's array\r\n\t\t\t\tnetwork.activateNeuron(outputNeuron);\r\n\t\t\t\toutputs.push(network.getNeuronDataByID(outputNeuron.id)!.output);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.hasActivated = true;\r\n\r\n\t\treturn outputs;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets inputs to the respective neuron's bias, resets outputs, and stores the previous input/output data\r\n\t * @return {void}\r\n\t */\r\n\tprivate prepareForActivation() : void {\r\n\t\tif (this.hasActivated) {\r\n\t\t\t// Copies elements to the rnn memory\r\n\t\t\tthis.rnnMemory = []; // First we reset the rnn memory\r\n\r\n\t\t\tfor (const neuron of this.neurons) {\r\n\t\t\t\tthis.rnnMemory.push(new NeuronData(neuron.id, neuron.input, neuron.output));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this.genome.neuronGenes.length; ++i) {\r\n\t\t\tconst neuron = this.genome.neuronGenes[i];\r\n\r\n\t\t\t// If it is the first time activating, we need to populate the list\r\n\t\t\tif (!this.hasActivated) {\r\n\t\t\t\tthis.neurons.push(new NeuronData(neuron.id, 0, 0));\r\n\t\t\t}\r\n\r\n\t\t    // We need the runtime data to be zeroed in order for the calculations to be proper (+=)\r\n\r\n\t\t\t// Bias is added here (0 + bias = bias)\r\n\t\t\tif (neuron.type === 'input') {\r\n\t\t\t\t// Input neurons don't have biases\r\n\t\t\t\tthis.neurons[i].input = 0;\r\n\t\t\t} else {\r\n\t\t\t\tthis.neurons[i].input = neuron.bias!;\r\n\t\t\t}\r\n\r\n\t\t\tthis.neurons[i].output = 0;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Activates a neural network's neuron, and returns the activated neuron output\r\n\t * Neuron must not be of type hidden or output\r\n\t * @param  neuron\r\n\t */\r\n\tprivate activateNeuron(neuron: NeuronGene) : number {\r\n\t\tif (neuron.type !== 'hidden' && neuron.type !== 'output') {\r\n\t\t\tconsole.warn(\"Tried to activate a input neuron!\");\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tconst index = this.getNeuronIndexByID(neuron.id);\r\n\r\n\t\t// Is looped recurrent link?\r\n\t\tif (neuron.loopedLink && this.hasActivated) {\r\n\t\t\t// See http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/\r\n\t\t\t// RNN unfold\r\n\t\t\t// RNN memory indexByID should be the same as our current neurons' indexByID\r\n\t\t\tthis.neurons[index].input += neuron.loopedLink.weight * this.rnnMemory[index].output;\r\n\t\t}\r\n\r\n\t\tthis.neurons[index].output = activation(this.neurons[index].input);\r\n\t\treturn this.neurons[index].output;\r\n\t}\r\n\r\n\t/**\r\n\t * Internal use.\r\n\t * Feeds the output data from some neuron to its enabled links, sending the data to the proper destination neurons\r\n\t * @param  network\r\n\t * @param  links\r\n\t * @return\r\n\t */\r\n\tprivate feedForward(links: LinkGene[]) {\r\n\t\tfor (const link of links) {\r\n\t\t\tif (!link.isEnabled || link.inNeuron.id === link.outNeuron.id) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst inIndex = this.getNeuronIndexByID(link.inNeuron.id);\r\n\t\t\tconst outIndex = this.getNeuronIndexByID(link.outNeuron.id);\r\n\t\t\tthis.neurons[outIndex].input += link.weight * this.neurons[inIndex].output;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Internal use.\r\n\t * Returns the index of the neuron runtime data given an ID\r\n\t * @param  network\r\n\t * @param  id\r\n\t * @return\r\n\t */\r\n\tprivate getNeuronIndexByID(id: Int) : Int {\r\n\t\tfor (let i = 0; i < this.neurons.length; ++i) {\r\n\t\t\tif (this.neurons[i].id === id) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.warn(\"Runtime index requested for invalid ID: \" + id);\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Internal use.\r\n\t * Returns the NeuronData for the neuron with the given ID.\r\n\t * @param  network\r\n\t * @param  id\r\n\t * @return\r\n\t */\r\n\tprivate getNeuronDataByID(id: Int) : NeuronData | undefined {\r\n\t\tfor (const neuron of this.neurons) {\r\n\t\t\tif (neuron.id === id) {\r\n\t\t\t\treturn neuron;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.warn(\"Runtime data requested for invalid ID: \" + id);\r\n\r\n\t\treturn undefined;\r\n\t}\r\n}\r\n\r\n/**\r\n * Activation function.\r\n * https://sharpneat.sourceforge.io/research/activation-fn-review/activation-fn-review.html\r\n * @param  x\r\n * @return\r\n */\r\nfunction activation(x: number): number {\r\n\treturn 2/(1 + Math.exp(-4.9 * x)) - 1;\r\n\r\n\t// const gradient = 0.001;\r\n\t// relu: return x > 0 ? x : gradient * x;\r\n\t// logisticsteep: return 2/(1 + Math.exp(-4.9 * x)) - 1;\r\n\t// tanh: return return Math.tanh(x);\r\n}\r\n","import LinkGene from './linkGene';\r\n\r\ntype Int = number;\r\n\r\nexport type NeuronType = 'hidden' | 'input' | 'output';\r\n\r\n/**\r\n * A Neuron Gene. Use the static functions to create instances.\r\n * @param  splitX\r\n * @param  splitY\r\n * @return\r\n */\r\nexport default class NeuronGene {\r\n\tpublic loopedLink?: LinkGene = undefined;\r\n\tpublic readonly id: Int;\r\n\tpublic readonly type: NeuronType;\r\n\t// Used for display purposes\r\n\tpublic readonly splitX: number;\r\n\tpublic readonly splitY: number;\r\n\tpublic bias?: number;\r\n\r\n\tconstructor(id: Int, type: NeuronType, splitX: number, splitY: number) {\r\n\t\tthis.id = id;\r\n\t\tthis.type = type;\r\n\t\tthis.splitX = splitX;\r\n\t\tthis.splitY = splitY;\r\n\r\n\t\t// Input neurons may not have biases\r\n\t\tif (type !== 'input') {\r\n\t\t\tthis.bias = 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Clones this neuron.\r\n\t * Does not clone looped link (or set it).\r\n\t */\r\n\tpublic clone() {\r\n\t\t// Type should never change at this point, so we pass it by reference\r\n\t\tconst clonedNeuron = new NeuronGene(this.id, this.type, this.splitX, this.splitY);\r\n\r\n\t\tif (this.type !== 'input') {\r\n\t\t\tclonedNeuron.bias = this.bias;\r\n\t\t}\r\n\r\n\t\treturn clonedNeuron;\r\n\t}\r\n}\r\n","type Int = number;\r\n\r\nexport default class Helper {\r\n\t/**\r\n\t * Helper method\r\n\t * Returns a random int in range [min, max] (inclusive on both sides)\r\n\t * @param  min\r\n\t * @param  max\r\n\t * @return\r\n\t */\r\n\tpublic static randomInt(min: Int, max: Int): Int {\r\n\t\treturn Math.floor(Math.random() * (max - min + 1)) + min;\r\n\t}\r\n\r\n\t/**\r\n\t * Helper method\r\n\t * Shuffles the elements of an array\r\n\t * @param  array\r\n\t * @return\r\n\t */\r\n\tpublic static shuffle(array: any[]): void {\r\n\t\tfor (let i = array.length - 1; i > 0; i--) {\r\n\t\t\tconst j = Math.floor(Math.random() * (i + 1));\r\n\t\t\tconst temp = array[i];\r\n\t\t\tarray[i] = array[j];\r\n\t\t\tarray[j] = temp;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Rounds up or down to a whole number by using the fractional part of the input value\r\n\t * as the probability that the value will be rounded up.\r\n\t * @param x\r\n\t * @return\r\n\t */\r\n\tpublic static stochasticRound(value: number) {\r\n\t\tconst integerPart = Math.floor(value);\r\n\t\tconst fraction = value - integerPart;\r\n\t\treturn Math.random() < fraction ? integerPart + 1 : integerPart;\r\n\t}\r\n\r\n\tprivate constructor() { }\r\n}\r\n","import NeuronGene from './neuronGene';\r\n\r\ntype Int = number;\r\n\r\n/**\r\n * Hidden neurons are create in a mutation that splits an existing link. When we do so, a new record is made (if there are no existing ones).\r\n * @param id\r\n * @param inNeuron\r\n * @param outNeuron\r\n */\r\nexport default class NeuronGeneMutationRecord {\r\n    public readonly id: Int;\r\n    public readonly inNeuron: NeuronGene;\r\n    public readonly outNeuron: NeuronGene;\r\n\r\n    constructor(id: Int, inNeuron: NeuronGene, outNeuron: NeuronGene) {\r\n        this.id = id;\r\n        this.inNeuron = inNeuron;\r\n        this.outNeuron = outNeuron;\r\n    }\r\n}\r\n","import Genome from '.';\r\nimport Helper from '../utils/helper';\r\nimport LinkGene from './linkGene';\r\nimport NeuronGene from './neuronGene';\r\nimport NeuronGeneMutationRecord from './neuronGeneMutationRecord';\r\nimport NEATParams from '../params';\r\n\r\ntype Int = number;\r\n\r\ninterface ILinkIndex {\r\n\tfrom: Int;\r\n\tto: Int;\r\n}\r\n\r\nexport default class GenomeMutator {\r\n\tpublic static mutate(genome: Genome, params: NEATParams) {\r\n\t\tgenome.fitness = 0;\r\n        genome.adjustedFitness = 0;\r\n        genome.phenotype = undefined;\r\n\r\n\t\tif (genome.neuronGenes.length - genome.inputCount - genome.outputCount < params.maxNumberOfHiddenNeurons.value) {\r\n\t\t\tGenomeMutator.addHiddenNeuronMutation(genome, params.hiddenNeuronMutationRate.value);\r\n\t\t}\r\n\r\n\t\tGenomeMutator.addLinkMutation(genome, params.linkMutationRate.value,\r\n\t\t\t\t\t\t\t\t\t\t\tparams.linkMutationChanceOfConsideringLoopedRecurrency.value);\r\n\t\t\r\n\t\tGenomeMutator.weightsMutation(genome, params.weightMutationRateForEachLink.value,\r\n\t\t\t\t\t\t\t\t\t\t\tparams.weightMutationProbNewVal.value,\r\n\t\t\t\t\t\t\t\t\t\t\tparams.weightMutationMaxPertubation.value,\r\n\t\t\t\t\t\t\t\t\t\t\tparams.weightMutationNewValRange.value);\r\n\t\t\r\n\t\tGenomeMutator.biasesMutation(genome, params.biasMutationRateForEachLink.value,\r\n\t\t\t\t\t\t\t\t\t\t   params.biasMutationProbNewVal.value,\r\n\t\t\t\t\t\t\t\t\t\t   params.biasMutationMaxPertubation.value,\r\n\t\t\t\t\t\t\t\t\t\t   params.biasMutationNewValRange.value);\r\n\t}\r\n\r\n\t/**\r\n\t * Mutation that adds a link to a genome\r\n\t * @param  genome\r\n\t * @param  mutationRate\r\n\t * @param  chanceOfConsideringLoopedRecurrency See EpochConfig.\r\n\t * @return\r\n\t */\r\n\tpublic static addLinkMutation(genome: Genome, mutationRate: number, chanceOfConsideringLoopedRecurrency: number) : void {\r\n\t\tif (Math.random() >= mutationRate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Array of all possible combinations of source and destination\r\n\t\tconst possibleLinks: ILinkIndex[] = [];\r\n\r\n\t\tfor (let i = 0; i < genome.neuronGenes.length; ++i) {\r\n\t\t\tfor (let j = 0; j < genome.neuronGenes.length; ++j) {\r\n\t\t\t\tif (genome.neuronGenes[i].id !== genome.neuronGenes[j].id) {\r\n\t\t\t\t\tpossibleLinks.push({ from: i, to: j });\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (Math.random() < chanceOfConsideringLoopedRecurrency) {\r\n\t\t\t// We add source=dest links separatedly to avoid duplicate links\r\n\t\t\tfor (let i = 0; i < genome.neuronGenes.length; ++i) {\r\n\t\t\t\tpossibleLinks.push({ from: i, to: i });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Shuffles our array\r\n\t\tHelper.shuffle(possibleLinks);\r\n\r\n\t\t// Go through the shuffled possibleLinks array until we find a combination of (src, dst) that is valid to make the mutation\r\n\t\tfor (const link of possibleLinks) {\r\n\t\t\tconst src = link.from;\r\n\t\t\tconst dst = link.to;\r\n\r\n\t\t\t// The destination neuron\r\n\t\t\t// Input neurons don't take inputs from other neurons\r\n\t\t\tif (genome.neuronGenes[dst].type !== 'input' && !genome.isDuplicateLink(genome.neuronGenes[src].id, genome.neuronGenes[dst].id)) {\r\n\t\t\t\tif (dst === src) {\r\n\t\t\t\t\tif (genome.neuronGenes[src].loopedLink) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (genome.neuronGenes[src].type === 'output') {\r\n\t\t\t\t\t// We don't allow links that have output neuron as source unless the link is looped recurrent\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Checks if the link might create an infinite loop when trying to activate the phenotype\r\n\t\t\t\tif (src !== dst && genome.isLinkPotentialLoop(genome.neuronGenes[src], genome.neuronGenes[dst])) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Also sets the 'loopedLink' variable at our neuron\r\n\t\t\t\tgenome.community!.addLinkToGenome(genome, genome.neuronGenes[src], genome.neuronGenes[dst], Math.random() * 4 - 2, true);\r\n\r\n\t\t\t\t// Break loop\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Mutation that adds a hidden neuron to a genome\r\n\t * @param  genome\r\n\t * @param  mutationRate\r\n\t * @return\r\n\t */\r\n\tpublic static addHiddenNeuronMutation(genome: Genome, mutationRate: number) : void {\r\n\t\tif (Math.random() >= mutationRate) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Links which we can use to perform the mutation at\r\n\t\tconst validLinks: LinkGene[] = [];\r\n\r\n\t\tfor (const link of genome.linkGenes) {\r\n\t\t\t// If the link is enabled and is not looped recurrent, then it is valid for mutation\r\n\t\t\tif (link.isEnabled && link.inNeuron.id !== link.outNeuron.id) {\r\n\t\t\t\tvalidLinks.push(link);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// It is possible that every link is disabled\r\n\t\tif (validLinks.length <= 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet chosenLinkIndex = 0;\r\n\r\n\t\t// If the genome has more than 5 hidden neurons or is at its minimal state, any link from the validLinks list can be picked\r\n\t\t// Else, we limit ourselves to pick one of the older genes (which are the ones that are closer to the start of our validLinks array)\r\n\t\t// This is done in order to avoid a mutation chaining effect (a lot of neurons added at the same connection), which is the likely scenario if any link index is picked at all cases)\r\n\t\t// FIXME: There's probably a better way to avoid chaining (number of steps to input and output - weighted probability)\r\n\r\n\t\tif (genome.linkGenes.length === genome.inputCount * genome.outputCount || genome.neuronGenes.length >= genome.inputCount + genome.outputCount + 5) {\r\n\t\t\tchosenLinkIndex = Helper.randomInt(0, validLinks.length - 1);\r\n\t\t} else {\r\n\t\t\t// Genome too small, limit our randomness to older neurons\r\n\t\t\tchosenLinkIndex = Helper.randomInt(0, validLinks.length - Math.floor(Math.sqrt(validLinks.length)) - 1);\r\n\t\t}\r\n\r\n\t\t// Found a good link, start the actual mutation process\r\n\r\n\t\tconst chosenLink = validLinks[chosenLinkIndex];\r\n\t\tchosenLink.isEnabled = false;\r\n\r\n\t\tlet neuronID = genome.community!.findNeuronIDForMutationAtLink(chosenLink.inNeuron, chosenLink.outNeuron);\r\n\t\t// A new innovation will be created if we could not find a neuron ID for this link\r\n\t\tconst shouldCreateNewInnovation = (neuronID < 0);\r\n\r\n\t\t// Found a neuron id for the mutation but genome already has such id?\r\n\t\tif (neuronID >= 0 && genome.hasNeuronWithID(neuronID)) {\r\n\t\t\t// If so, a new neuron id is created\r\n\t\t\tneuronID = -1;\r\n\t\t}\r\n\r\n\t\t// Either the genome has a neuron with the ID from the innovation already or the innovation was not found at our database\r\n\t\tif (neuronID < 0) {\r\n\t\t\t// A new id is made for the neuron\r\n\t\t\t++genome.maxNeuronID;\r\n\t\t\tneuronID = genome.maxNeuronID;\r\n\t\t}\r\n\r\n\t\t// At this point, neuronID must be valid\r\n\r\n\t\t// We only want to create a new innovation if we don't already have a similar one (similar: innovationInNeuron=inNeuron and innovationOutNeuron=outNeuron)\r\n\t\tif (shouldCreateNewInnovation) {\r\n\t\t\tgenome.community!.neuronGenesRecords.push(new NeuronGeneMutationRecord(neuronID, chosenLink.inNeuron, chosenLink.outNeuron));\r\n\t\t}\r\n\r\n\t\tconst newNeuron = new NeuronGene(neuronID, 'hidden',\r\n\t\t\t\t\t\t\t\t\t  \t(chosenLink.inNeuron.splitX + chosenLink.outNeuron.splitX) / 2, // splitX\r\n\t\t\t\t\t\t\t\t\t  \t(chosenLink.inNeuron.splitY + chosenLink.outNeuron.splitY) / 2); // splitY\r\n\t\tgenome.neuronGenes.push(newNeuron);\r\n\t\t// The new weights assigned attempt to minimize the disturbance to the genome's current output\r\n\t\tgenome.community!.addLinkToGenome(genome, chosenLink.inNeuron, newNeuron, 1, true);\r\n\t\tgenome.community!.addLinkToGenome(genome, newNeuron, chosenLink.outNeuron, chosenLink.weight, true);\r\n\t}\r\n\r\n\t/**\r\n\t * Mutates the weights of our connections within the predifined limits\r\n\t * Note that the actual chance of a newWeightMutation is: mutationRateForEachLink * probNewWeightMutation\r\n\t * @param  genome\r\n\t * @param  mutationRateForEachLink\r\n\t * @param  probNewWeightMutation\r\n\t * @param  maxPertubation\r\n\t * @param  newWeightRange\r\n\t * @return\r\n\t */\r\n\tpublic static weightsMutation(genome: Genome, mutationRateForEachLink: number, probNewWeightMutation: number, maxPertubation: number, newWeightRange: number) : void {\r\n\t\tfor (const link of genome.linkGenes) {\r\n\t\t\tif (Math.random() < mutationRateForEachLink) {\r\n\t\t\t\tif (Math.random() >= probNewWeightMutation) {\r\n\t\t\t\t\tlink.weight += (Math.random() * 2 - 1) * maxPertubation * (1 - mutationRateForEachLink);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// This means that we want to replace our weight with a completely new one\r\n\t\t\t\t\tlink.weight = Math.random() * newWeightRange * 2 - newWeightRange;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Mutates the weights of our connections within the predifined limits\r\n\t * Note that the actual chance of a newBiasMutation is: mutationRateForEachLink * probNewWeightMutation\r\n\t * @param  genome\r\n\t * @param  mutationRateForEachLink\r\n\t * @param  probNewBiasMutation\r\n\t * @param  maxPertubation\r\n\t * @param  newBiasRange\r\n\t * @return\r\n\t */\r\n\tpublic static biasesMutation(genome: Genome, mutationRateForEachLink: number, probNewBiasMutation: number, maxPertubation: number, newBiasRange: number) : void {\r\n\t\tfor (const neuron of genome.neuronGenes) {\r\n\t\t\tif (neuron.type === 'input') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (Math.random() < mutationRateForEachLink) {\r\n\t\t\t\tif (Math.random() >= probNewBiasMutation) {\r\n\t\t\t\t\tneuron.bias! += (Math.random() * 2 - 1) * maxPertubation * (1 - mutationRateForEachLink);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Means that we want to replace our bias with a completely new one\r\n\t\t\t\t\tneuron.bias = Math.random() * newBiasRange * 2 - newBiasRange;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate constructor() {}\r\n}\r\n","import Individual from '../../individual';\r\nimport Community from '../community';\r\nimport LinkGene from './linkGene';\r\nimport NeuralNetwork from '../neuralNetworks';\r\nimport NeuronGene from './neuronGene';\r\nimport Species from '../species';\r\nimport { saveAs } from \"file-saver\";\r\nimport GenomeMutator from './genomeMutator';\r\nimport NEATParams from '../params';\r\nimport Helper from '../utils/helper';\r\n\r\ntype Int = number;\r\n\r\n/**\r\n * A NEAT Genome.\r\n * @param community\r\n */\r\nexport default class Genome extends Individual {\r\n    public static fromCommunity(community: Community) : Genome {\r\n        ++community.maxGenomeID;\r\n\r\n        const newGenome = new Genome(community.inputCount, community.outputCount, community.maxGenomeID);\r\n        newGenome.community = community;\r\n\r\n        return newGenome;\r\n    }\r\n\r\n    public static fromJSON(json: string) : Genome {\r\n        const parsed = JSON.parse(json);\r\n        const newGenome = new Genome(JSON.parse(parsed.inputCount), JSON.parse(parsed.outputCount), JSON.parse(parsed.id));\r\n        \r\n        newGenome.neuronGenes = JSON.parse(parsed.neuronGenes);\r\n        newGenome.inputNeuronGenes = JSON.parse(parsed.inputNeuronGenes);\r\n        newGenome.linkGenes = JSON.parse(parsed.linkGenes);\r\n        newGenome.adjustedFitness = JSON.parse(parsed.adjustedFitness);\r\n        newGenome.maxNeuronID = JSON.parse(parsed.maxNeuronID);\r\n\r\n        return newGenome;\r\n    }\r\n\r\n    public community?: Community;\r\n    public species?: Species;\r\n    public readonly id: Int;\r\n    public readonly inputCount: Int;\r\n    public readonly outputCount: Int;\r\n\r\n    public neuronGenes: NeuronGene[] = [];\r\n    public inputNeuronGenes: NeuronGene[] = [];\r\n    public linkGenes: LinkGene[] = [];\r\n    public phenotype: NeuralNetwork | undefined = undefined;\r\n    public adjustedFitness = 0; // Fitness when genome is inside a species\r\n    public maxNeuronID: Int = 0; // Biggest neuron ID currently\r\n\r\n    constructor(inputCount: number, outputCount: number, id: number) {\r\n        super();\r\n        \r\n        this.id = id;\r\n        this.inputCount = inputCount;\r\n        this.outputCount = outputCount;\r\n    }\r\n\r\n    public toJSON() : string {\r\n        return JSON.stringify({\r\n            id: JSON.stringify(this.id),\r\n            inputCount: JSON.stringify(this.inputCount),\r\n            outputCount: JSON.stringify(this.outputCount),\r\n            neuronGenes: JSON.stringify(this.neuronGenes),\r\n            inputNeuronGenes: JSON.stringify(this.inputNeuronGenes),\r\n            linkGenes: JSON.stringify(this.linkGenes),\r\n            adjustedFitness: JSON.stringify(this.adjustedFitness),\r\n            maxNeuronID: JSON.stringify(this.maxNeuronID),\r\n        });\r\n    }\r\n\r\n    public saveWithName(name: string) {\r\n        const blob = new Blob([ this.toJSON() ], { type: \"text/plain;charset=utf-8\" });\r\n\t\tsaveAs(blob, name);\r\n    }\r\n\r\n    /**\r\n     * Creates a phenotype based on this genome\r\n     * Returns this.phenotype\r\n     * @return\r\n     */\r\n    public createPhenotype(): NeuralNetwork {\r\n        this.phenotype = new NeuralNetwork(this);\r\n        return this.phenotype;\r\n    }\r\n\r\n    /**\r\n     * Sorts this genome's neurons in crescent id order and links in crescent innovation number order.\r\n     * Useful for crossover operations.\r\n     * @return\r\n     */\r\n    public sortGenes(): void {\r\n        this.neuronGenes.sort((a, b) => {\r\n            return a.id - b.id;\r\n        });\r\n\r\n        this.linkGenes.sort((a, b) => {\r\n            return a.innovation!.n - b.innovation!.n;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calculates the compatibility distance between this and another genome.\r\n     * See http://nn.cs.utexas.edu/downloads/papers/stanley.ec02.pdf section 3.3.\r\n     * @param  other\r\n     * @param  excessGenesCoefficient (c1)\r\n     * @param  disjointGenesCoefficient (c2)\r\n     * @param  weightsCoefficient (c3)\r\n     * @return\r\n     */\r\n    public compatibilityDistance(other: Genome, params: NEATParams) {\r\n        if (this.id === other.id) {\r\n            return 0;\r\n        }\r\n        \r\n        const recA = this.community!.alignAlleleGenes(this, other);\r\n\r\n        let N = Math.max(this.linkGenes.length, other.linkGenes.length); // Number of genes of the larger genome\r\n\r\n        if (N <= 0) {\r\n            console.warn(\"Tried to calculate the compatibility distance of two genomes with no linkGenes\");\r\n        }\r\n\r\n        let W = 0; // Average weight difference of matching genes, including disabled genes\r\n\r\n        for (let i = 0; i < recA.matchingGenesA.length; ++i) {\r\n            W += Math.abs(recA.matchingGenesA[i].weight - recA.matchingGenesB[i].weight);\r\n        }\r\n\r\n        W /= recA.matchingGenesA.length;\r\n\r\n        return params.excessGenesCoefficient.value / N * (recA.excessGenesA.length + recA.excessGenesB.length) +\r\n               params.disjointGenesCoefficient.value / N * (recA.disjointGenesA.length + recA.disjointGenesB.length) +\r\n               params.weightsCoefficient.value * W;\r\n    }\r\n\r\n    /**\r\n     * Initializes a minimal fully connected input layer and output layer genome\r\n     * @return this\r\n     */\r\n    public initMinimalGenome() : Genome {\r\n        // We use these variables to calculate the splitX value. Only for display purposes.\r\n        const inputSplitXOffset = 0.5/this.community!.inputCount;\r\n        const outputSplitXOffset = 0.5/this.community!.outputCount;\r\n\r\n        this.inputNeuronGenes = [];\r\n        this.neuronGenes = [];\r\n        this.maxNeuronID = 0;\r\n\r\n        for (let i = 0; i < this.community!.inputCount; ++i) {\r\n            ++this.maxNeuronID;\r\n            this.inputNeuronGenes.push(new NeuronGene(this.maxNeuronID, 'input', (i+1)/this.community!.inputCount - inputSplitXOffset, 1));\r\n            this.neuronGenes.push(this.inputNeuronGenes[i]);\r\n        }\r\n\r\n        for (let i = 0; i < this.community!.outputCount; ++i) {\r\n            ++this.maxNeuronID;\r\n            this.neuronGenes.push(new NeuronGene(this.maxNeuronID, 'output', (i+1)/this.community!.outputCount - outputSplitXOffset, 0));\r\n        }\r\n\r\n        for (let i = 0; i < this.community!.inputCount; ++i) {\r\n            for (let j = 0; j < this.community!.outputCount; ++j) {\r\n                if (Math.random() < this.community!.params.probOfMakingLinkInInitialGenome.value) {\r\n                    this.community!.addLinkToGenome(this, this.neuronGenes[i], this.neuronGenes[j + this.community!.inputCount], Math.random() * 2 - 1, true);\r\n                }\r\n            }\r\n        }\r\n\r\n        // If we have no links in our genome...\r\n        // Pick a random one and add to it\r\n        if (this.linkGenes.length <= 0) {\r\n            const i = Helper.randomInt(0, this.community!.inputCount - 1);\r\n            const j = Helper.randomInt(0, this.community!.outputCount - 1);\r\n            this.community!.addLinkToGenome(this, this.neuronGenes[i], this.neuronGenes[j + this.community!.inputCount], Math.random() * 2 - 1, true);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * If another link with inNeuron and outNeuron given exists, returns true\r\n     * @param  inNeuron\r\n     * @param  outNeuron\r\n     * @return\r\n     */\r\n    public isDuplicateLink(inNeuronID: Int, outNeuronID: Int) : boolean {\r\n        for (const link of this.linkGenes) {\r\n            if (link.inNeuron.id === inNeuronID && link.outNeuron.id === outNeuronID) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Given a neuron id, returns its index at this genome's neurons array.\r\n     * Returns -1 if a neuron with the given ID was not found.\r\n     * @param  neuronID\r\n     * @return\r\n     */\r\n    public getNeuronIndexByID(neuronID: Int) : Int {\r\n        for (let i = 0; i < this.neuronGenes.length; ++i) {\r\n            if (this.neuronGenes[i].id === neuronID) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        console.warn(\"Tried to get neuron passing an invalid neuronID \" + neuronID + \" in genome \" + this.id);\r\n\r\n        return -1;\r\n    }\r\n\r\n    /**\r\n     * Returns neuron with the given ID\r\n     * @return\r\n     */\r\n    public getNeuronByID(neuronID: Int, warning?: boolean) : NeuronGene | undefined {\r\n        for (const gene of this.neuronGenes) {\r\n            if (gene.id === neuronID) {\r\n                return gene;\r\n            }\r\n        }\r\n\r\n        if (warning) {\r\n            console.warn(\"Tried to get neuron passing an invalid neuronID \" + neuronID + \" in genome \" + this.id);\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    /** Returns true if the genome has a neuron with the given ID\r\n     * @param  neuronID\r\n     * @return\r\n     */\r\n    public hasNeuronWithID(neuronID: Int) : boolean {\r\n        for (const neuron of this.neuronGenes) {\r\n            if (neuron.id === neuronID) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Iterates through this genome's links and neurons, calling onInputNeuron, onHiddenNeuron, onOutputNeuron when appropriate.\r\n     * Return true in any of passed functions to break the current loop in the iterate function.\r\n     * @param  onInputNeuron   Return true to stop iterating through the input neurons\r\n     * @param  onHiddenNeuron  Return true to stop iterating through the hidden neurons\r\n     * @param  onOutputNeuron  Return true to stop iterating through the output neurons\r\n     * @return\r\n     */\r\n    public iterate(onInputNeuron: (inputNeuron: NeuronGene, inputOutLinks: LinkGene[], i: Int) => boolean,\r\n            onHiddenNeuron: (hiddenNeuron: NeuronGene, hiddenOutLinks: LinkGene[], i: Int) => boolean,\r\n            onOutputNeuron: (outputNeuron: NeuronGene, i: Int) => boolean) : void {\r\n        let allLinks: LinkGene[] = [];\r\n\r\n        // Input neurons\r\n        for (let i = 0; i < this.inputNeuronGenes.length; ++i) {\r\n            const inputOutLinks = this.getNonLoopedLinksWithSource(this.inputNeuronGenes[i]);\r\n            Array.prototype.push.apply(allLinks, inputOutLinks);\r\n            if (onInputNeuron(this.inputNeuronGenes[i], inputOutLinks, i)) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        whileLoop: while (allLinks.length > 0) {\r\n            const newAllLinks: LinkGene[] = [];\r\n\r\n            for (let i = 0; i < allLinks.length; ++i) {\r\n                const hiddenOutLinks = this.getNonLoopedLinksWithSource(allLinks[i].outNeuron);\r\n                Array.prototype.push.apply(newAllLinks, hiddenOutLinks);\r\n\r\n                if (hiddenOutLinks.length > 0) {\r\n                    if (onHiddenNeuron(allLinks[i].outNeuron, hiddenOutLinks, i)) {\r\n                        break whileLoop;\r\n                    }\r\n                }\r\n                // else outNeuron is actually an output neuron (or a disjoint hidden neuron)\r\n            }\r\n\r\n            allLinks = newAllLinks;\r\n        }\r\n\r\n        for (let i = 0; i < this.neuronGenes.length; ++i) {\r\n            if (this.neuronGenes[i].type === 'output') {\r\n                if (onOutputNeuron(this.neuronGenes[i], i)) {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checks if the genome has a structure that will loop forever when trying to feed forward the phenotype\r\n     * @return\r\n     */\r\n    public hasLoop() : boolean {\r\n        const recordedNeuronsID: Int[] = [];\r\n        let foundLoop = false;\r\n\r\n        this.iterate(\r\n            (inputNeuron: NeuronGene, outLinks: LinkGene[], index: Int) : boolean => {\r\n                return false;\r\n            },\r\n            (hiddenNeuron: NeuronGene, outLinks: LinkGene[], index: Int) : boolean => {\r\n                recordedNeuronsID.push(hiddenNeuron.id);\r\n\r\n                for (const outLink of outLinks) {\r\n                    if (recordedNeuronsID.indexOf(outLink.outNeuron.id) >= 0) {\r\n                        foundLoop = true;\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                return false;\r\n            },\r\n            (outputNeuron: NeuronGene, index: Int) : boolean => {\r\n                return false;\r\n            }\r\n        );\r\n\r\n        return foundLoop;\r\n    }\r\n\r\n    /**\r\n     * Checks if a link is going to create a loop in this genome. See the hasLoop function.\r\n     * @param  inNeuron\r\n     * @param  outNeuron\r\n     * @return\r\n     */\r\n    public isLinkPotentialLoop(inNeuron: NeuronGene, outNeuron: NeuronGene) : boolean {\r\n        // Add link temporally\r\n        this.linkGenes.push(new LinkGene(inNeuron, outNeuron, 1, true, undefined));\r\n        const hasLoop = this.hasLoop();\r\n        // Remove the temporary link\r\n        this.linkGenes.pop();\r\n\r\n        return hasLoop;\r\n    }\r\n\r\n    /**\r\n     * Returns the id of all destination neurons of all links that have one of the neurons ids passed as a source\r\n     * @param  srcNeuronsIDs\r\n     * @return\r\n     */\r\n    public getNonLoopedOutIDsFromInIDs(srcNeuronsIDs: Int[]): Int[] {\r\n        const destsIDs = new Array<Int>();\r\n\r\n        for (const link of this.linkGenes) {\r\n            for (const srcID of srcNeuronsIDs) {\r\n                if (link.inNeuron.id === srcID && (link.inNeuron.id !== link.outNeuron.id)) {\r\n                    destsIDs.push(link.outNeuron.id);\r\n                }\r\n            }\r\n        }\r\n\r\n        return destsIDs;\r\n    }\r\n\r\n    /**\r\n     * Returns all links with source equal to the given NeuronGene\r\n     * @param  src\r\n     * @return\r\n     */\r\n    public getNonLoopedLinksWithSource(src: NeuronGene): LinkGene[] {\r\n        const linksWithSrc = new Array<LinkGene>();\r\n\r\n        for (const linkGene of this.linkGenes) {\r\n            if (linkGene.inNeuron.id === src.id && (linkGene.inNeuron.id !== linkGene.outNeuron.id)) {\r\n                linksWithSrc.push(linkGene);\r\n            }\r\n        }\r\n\r\n        return linksWithSrc;\r\n    }\r\n\r\n    public createOffspring(params: NEATParams): Genome {\r\n        const offspring = this.clone();\r\n\r\n        GenomeMutator.mutate(offspring, params);\r\n\r\n        return offspring;\r\n    }\r\n\r\n    /**\r\n     * Clones a genome and generates a new ID for it.\r\n     *\r\n     * @param {Genome} genome\r\n     * @returns\r\n     */\r\n    public clone(): Genome {\r\n        const newGenome = Genome.fromCommunity(this.community!); // When we do this, a new ID is automatically generated for us\r\n\r\n        newGenome.phenotype = undefined;\r\n        newGenome.fitness = this.fitness;\r\n        newGenome.adjustedFitness = this.adjustedFitness;\r\n        newGenome.species = this.species;\r\n        newGenome.maxNeuronID = this.maxNeuronID;\r\n\r\n        // Copies each link and neuron from the old genome into the new one\r\n        for (const link of this.linkGenes) {\r\n            newGenome.copyLinkAndNeuronsToGenome(link);\r\n        }\r\n\r\n        return newGenome;\r\n    }\r\n\r\n    /**\r\n     * Same as copyLinkAndNeuronsToGenome, except with a X% (defaults to 75) of disabling the link if maybeDisable is set to true.\r\n     * This method is called during crossover, and maybeDisable is set to true if either parent has that link gene disabled.\r\n     * @param  genome\r\n     * @param  linkGene\r\n     * @param  maybeDisable\r\n     * @param  disableChance\r\n     * @return\r\n     */\r\n    public copyLinkAndNeuronsToGenomeAndMaybeDisable(linkGene: LinkGene, maybeDisable: boolean, disableChance: number): void {\r\n        // Note: If the fittest parent doesn't have loops (as it should never have), then its children won't have loops either, so we don't need to call isLinkPotentialLoop on linkGene before pushing\r\n        const inNeuron = this.copyNeuronToGenome(linkGene.inNeuron!);\r\n        const outNeuron = this.copyNeuronToGenome(linkGene.outNeuron!);\r\n\r\n        let isEnabled = true;\r\n\r\n        if (maybeDisable && Math.random() < disableChance) {\r\n            isEnabled = false;\r\n        }\r\n\r\n        // Innovations should never be altered, so we pass it by reference\r\n        this.linkGenes.push(new LinkGene(inNeuron, outNeuron, linkGene.weight, isEnabled, linkGene.innovation));\r\n    }\r\n\r\n    /**\r\n     * If the passed link will make a loop, we cancel the operation.\r\n     * Copies linkGene's inNeuron and outNeuron to genome if they don't already exist in it.\r\n     * Proceeds to copying the linkGene to genome (the passed link must not exist!).\r\n     * @param  genome\r\n     * @param  linkGene\r\n     * @return\r\n     */\r\n    public copyLinkAndNeuronsToGenome(linkGene: LinkGene): void {\r\n        // Note: If the fittest parent doesn't have loops (as it should never have), then its children won't have loops either, so we don't need to call isLinkPotentialLoop on linkGene before pushing\r\n        const inNeuron = this.copyNeuronToGenome(linkGene.inNeuron!);\r\n        const outNeuron = this.copyNeuronToGenome(linkGene.outNeuron!);\r\n        // Innovations should never be altered, so we pass it by reference\r\n        this.linkGenes.push(new LinkGene(inNeuron, outNeuron, linkGene.weight, linkGene.isEnabled, linkGene.innovation));\r\n    }\r\n\r\n    /**\r\n     * Copies neuron to genome if that neuron does not already exist in it.\r\n     * @param  genome\r\n     * @param  neuron\r\n     * @return\r\n     */\r\n    private copyNeuronToGenome(neuron: NeuronGene) : NeuronGene {\r\n        let newNeuron = this.getNeuronByID(neuron.id, false);\r\n\r\n        if (!!newNeuron) {\r\n            return newNeuron;\r\n        }\r\n\r\n        newNeuron = neuron.clone();\r\n\r\n        if (!!neuron.loopedLink) {\r\n            const newLoopedLink = neuron.loopedLink.clone(newNeuron, newNeuron);\r\n            newNeuron.loopedLink = newLoopedLink;\r\n        }\r\n\r\n        this.neuronGenes.push(newNeuron);\r\n\r\n        if (newNeuron.type === 'input') {\r\n            this.inputNeuronGenes.push(newNeuron);\r\n        }\r\n\r\n        return newNeuron;\r\n    }\r\n}\r\n","import NeuronGene from './neuronGene';\r\n\r\ntype Int = number;\r\n\r\nexport default class Innovation {\r\n\tpublic readonly n: Int;\r\n\tpublic readonly inNeuron: NeuronGene;\r\n\tpublic readonly outNeuron: NeuronGene;\r\n\r\n\tconstructor(n: Int, inNeuron: NeuronGene, outNeuron: NeuronGene) {\r\n\t\tthis.n = n;\r\n\t\tthis.inNeuron = inNeuron;\r\n\t\tthis.outNeuron = outNeuron;\r\n\t}\r\n}\r\n","/**\r\n * Holds an array of probabilities, and may be asked to randomly select an element in that array based on its probability.\r\n *\r\n * @export\r\n * @class ProbabilityArray\r\n */\r\nexport default class ProbabilityArray {\r\n    private readonly probs: number[];\r\n    private readonly indexes: number[];\r\n\r\n    constructor(probs: number[]) {\r\n        this.probs = probs;\r\n        this.indexes = new Array<number>(this.probs.length);\r\n\r\n        for (let i = 0; i < probs.length; ++i) {\r\n            this.indexes[i] = i;\r\n        }\r\n\r\n        this.normalize();\r\n    }\r\n\r\n    public length() {\r\n        return this.probs.length;\r\n    }\r\n\r\n    public removeAt(index: number) {\r\n        this.probs.splice(index, 1);\r\n        this.indexes.splice(index, 1);\r\n        this.normalize();\r\n    }\r\n\r\n    /**\r\n     * Randomly picks an index and returns it.\r\n     *\r\n     * @returns\r\n     * @memberof ProbabilityArray\r\n     */\r\n    public randomlySelect() {\r\n        console.assert(this.probs.length > 0, \"Tried to pick from an empty ProbabilityArray!\");\r\n\r\n        const threshold = Math.random();\r\n        let acc = 0.0;\r\n\r\n        for (let i = 0; i < this.probs.length; i++) {\r\n            acc += this.probs[i];\r\n\r\n            if (acc > threshold) {\r\n                return this.indexes[i];\r\n            }\r\n        }\r\n        \r\n        for (let i = 0; i < this.probs.length; ++i) {\r\n            if (0.0 !== this.probs[i]) {\r\n                return this.indexes[i];\r\n            }\r\n        }\r\n\r\n        console.warn(\"Found a probabilities array filled with zero probabilities.\");\r\n\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Normalizes the probabilities in our array (so that they sum up to one).\r\n     * \r\n     * @returns\r\n     * @memberof ProbabilityArray\r\n     */\r\n    private normalize() {\r\n        console.assert(this.probs.length > 0, \"Tried to normalize an empty ProbabilityArray!\");\r\n        \r\n        let total = 0;\r\n\r\n        for (const p of this.probs) {\r\n            total += p;\r\n        }\r\n\r\n        if (total <= 0.000001) {\r\n            const p = 1 / this.probs.length;\r\n\r\n            for (let i = 0; i < this.probs.length; ++i) {\r\n                this.probs[i] = p;\r\n            }\r\n        }\r\n\r\n        // If we have already normalized...\r\n        if (Math.abs(1.0 - total) < 0.000001) {\r\n            return;\r\n        }\r\n\r\n        const factor = 1 / total;\r\n\r\n        for (let i = 0; i < this.probs.length; ++i) {\r\n            this.probs[i] *= factor;\r\n        }\r\n    }\r\n}","import AlleleGenesData from './genome/alleleGenesData';\r\nimport Genome from './genome';\r\nimport Helper from './utils/helper';\r\nimport Innovation from './genome/innovation';\r\nimport LinkGene from './genome/linkGene';\r\nimport LinkGeneMutationRecord from './genome/linkGeneMutationRecord';\r\nimport NeuronGene from './genome/neuronGene';\r\nimport NeuronGeneMutationRecord from './genome/neuronGeneMutationRecord';\r\nimport NEATParams from './params';\r\nimport Species from './species';\r\nimport ProbabilityArray from './utils/probabilityArray';\r\nimport SpeciationAlgorithm from './species/speciationAlgorithm';\r\n\r\ntype Int = number;\r\n\r\n/**\r\n * A group of various species that share the same fitness function, inputCount and outputCount.\r\n * Also stores innovation databases.\r\n * Some of the epoch code is inspired by SharpNEAT (https://github.com/colgreen/sharpneat).\r\n * \r\n * @export\r\n * @class Community\r\n */\r\nexport default class Community {\r\n\t// MARK: Constant parameters chosen at the start\r\n\r\n\tpublic readonly params: NEATParams;\r\n\r\n\tpublic readonly inputCount: Int;\r\n\tpublic readonly outputCount: Int;\r\n\r\n\tpublic readonly populationSize: Int;\r\n\r\n\t/**\r\n\t * The algorithm chosen for speciation.\r\n\t */\r\n\tpublic readonly speciationAlgorithm: SpeciationAlgorithm;\r\n\r\n\r\n\t// MARK: Our genomes and species\r\n\r\n\tpublic genomes: Genome[] = [];\r\n\tpublic species: Species[] = [];\r\n\r\n\r\n\t// MARK: Innovation and ID-related databases\r\n\r\n    /**\r\n     * Used to determine the id of new genomes\r\n     */\r\n\tpublic maxGenomeID: Int = 0;\r\n\r\n    /**\r\n     * Used to determine the id of new species\r\n     */\r\n\tpublic maxSpeciesID: Int = 0;\r\n\r\n\t/**\r\n\t * Stores { inNeuron, outNeuron, id }.\r\n\t * Note this database does NOT keep track of link innovations.\r\n\t * However, we store the inNeuron, outNeuron of the link where the neuron was inserted.\r\n\t * We have a neuron innovation database in order to assign the proper ids to our neurons, thus not confounding our link innovation database.\r\n\t */\r\n\tpublic neuronGenesRecords: NeuronGeneMutationRecord[] = [];\r\n\r\n\t/**\r\n\t * Stores { inNeuron, outNeuron, innovation } objects.\r\n\t */\r\n\tpublic linkGenesRecords: LinkGeneMutationRecord[] = [];\r\n\r\n\tprivate innovationNumber: Int = 0;\r\n\tprivate generationCounter: Int = 0;\r\n\r\n\r\n\t// MARK: Statistics about the community\r\n\r\n\t/**\r\n\t * The index of the best species.\r\n\t */\r\n\tpublic bestSpeciesIndex: number = 0;\r\n\r\n\t/**\r\n\t * The best genome alive. May change from generation to generation.\r\n\t */\r\n\tpublic bestGenome?: Genome = undefined;\r\n\r\n\t/**\r\n\t * The best fitness for each generation.\r\n\t */\r\n\tpublic bestFitnesses: number[] = [];\r\n\r\n\t/**\r\n\t * Mean fitness for each generation.\r\n\t */\r\n\tpublic meanFitnesses: number[] = [];\r\n\r\n\t/**\r\n\t * Creates an instance of Community.\r\n\t * @param {NEATParams} params\r\n\t * @param {Int} inputCount\r\n\t * @param {Int} outputCount\r\n\t * @param {SpeciationAlgorithm} speciationAlgorithm\r\n\t * @memberof Community\r\n\t */\r\n\tconstructor(params: NEATParams, inputCount: Int, outputCount: Int, speciationAlgorithm: SpeciationAlgorithm) {\r\n\t\tthis.params = params;\r\n\t\tthis.inputCount = inputCount;\r\n\t\tthis.outputCount = outputCount;\r\n\t\tthis.speciationAlgorithm = speciationAlgorithm;\r\n\r\n\t\tthis.populationSize = this.params.initialGenomeCount.value;\r\n\t\tconsole.assert(Number.isFinite(this.populationSize) && this.populationSize > 0, \"Population size must be a non zero natural number.\");\r\n\t}\r\n\r\n\tpublic init() {\r\n\t\tthis.genomes = [];\r\n\r\n\t\tfor (let i = 0; i < this.params.initialGenomeCount.value; ++i) {\r\n\t\t\tconst minimalGenome = Genome.fromCommunity(this).initMinimalGenome();\r\n\t\t\tthis.genomes.push(minimalGenome);\r\n\t\t}\r\n\r\n\t\tthis.speciationAlgorithm.init(this.genomes, this.params.initialSpeciesCount.value);\r\n\t\tthis.species = this.speciationAlgorithm.result;\r\n\r\n\t\tthis.assertForNoEmptySpecies();\r\n\t}\r\n\r\n\t/**\r\n\t * Crossover between two genomes.\r\n\t * We expect that mom and dad are two different genomes.\r\n\t * See http://nn.cs.utexas.edu/downloads/papers/stanley.ec02.pdf section 3.2\r\n\t * @param mom \r\n\t * @param dad \r\n\t */\r\n\tpublic crossover(mom: Genome, dad: Genome): Genome {\r\n\t\tif (mom.id === dad.id) {\r\n\t\t\tconsole.warn(\"Called crossover with momID === dadID. This should never happen.\");\r\n\t\t\treturn mom.clone();\r\n\t\t}\r\n\r\n\t\tlet fittest = mom;\r\n\t\tlet other = dad;\r\n\r\n\t\t// If dad is more fit than mom or if the fitness of both parents is equal and a 50% chance passes, update our variables\r\n\t\tif ((dad.fitness > mom.fitness) ||\r\n\t\t\t(mom.fitness === dad.fitness && Math.floor(Math.random() * 2))) {\r\n\t\t\tfittest = dad;\r\n\t\t\tother = mom;\r\n\t\t}\r\n\r\n\t\tconsole.assert(other.fitness <= fittest.fitness, \"The fittest parent has not been chosen correctly.\");\r\n\t\tconsole.assert(fittest.id !== other.id, \"The fittest parent has not been chosen correctly.\");\r\n\r\n\t\t// Note that genome A is always the fittest (as per convetion)\r\n\t\tconst recA = this.alignAlleleGenes(fittest, other);\r\n\t\tconst baby = Genome.fromCommunity(this);\r\n\t\tbaby.maxNeuronID = fittest.maxNeuronID; // because we take the excess and disjoint from the fittest\r\n\r\n\t\t// Copy matching genes at random\r\n\t\tfor (let i = 0; i < recA.matchingGenesA.length; ++i) {\r\n\t\t\tconst maybeDisable = !recA.matchingGenesA[i].isEnabled || !recA.matchingGenesB[i].isEnabled;\r\n\r\n\t\t\tif (Math.floor(Math.random() * 2)) {\r\n\t\t\t\tbaby.copyLinkAndNeuronsToGenomeAndMaybeDisable(recA.matchingGenesA[i], maybeDisable, this.params.offspringLinkDisableRate.value);\r\n\t\t\t} else {\r\n\t\t\t\tbaby.copyLinkAndNeuronsToGenomeAndMaybeDisable(recA.matchingGenesB[i], maybeDisable, this.params.offspringLinkDisableRate.value);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// We only care about excess and disjoint genes from A (the fittest parent)\r\n\t\tfor (const gene of recA.disjointGenesA) {\r\n\t\t\tbaby.copyLinkAndNeuronsToGenome(gene);\r\n\t\t}\r\n\r\n\t\tfor (const gene of recA.excessGenesA) {\r\n\t\t\tbaby.copyLinkAndNeuronsToGenome(gene);\r\n\t\t}\r\n\r\n\t\t// As a convetion, we set the baby's species initially to the fittest parent's species.\r\n\t\t// Note that this species may change during speciation.\r\n\t\tbaby.species = fittest.species;\r\n\r\n\t\treturn baby;\r\n\t}\r\n\r\n\t/**\r\n\t * The epoch method.\r\n\t * Expects that all genomes have their fitness calculated before calling the function.\r\n\t * Implements the core evolution algorithm:\r\n\t *   1. Sorts genomes in each species by fitness.\r\n\t * \t 2. Updates the best genome and the best species.\r\n\t *   3. Update general statistics about the algorithm (eg. generation count)\r\n\t * \t 4. Computes spawn counts and creates offsprings.\r\n\t * \t 5. Updates the genome list.\r\n\t *   6. Speciates.\r\n\t */\r\n\tpublic epoch() {\r\n\t\tconsole.log(\"Epoch start\");\r\n\r\n\t\tthis.generationCounter += 1;\r\n\t\t\r\n\t\tthis.sortEachSpecies();\r\n\t\tthis.updateBestGenome();\r\n\t\tthis.updateStats();\r\n\r\n\t\tconst totalOffspringCount = this.computeSpeciesStats();\r\n\r\n\t\t// Creates offspring.\r\n\t\tconst offspring = this.createOffspring();\r\n\r\n\t\tconsole.assert(totalOffspringCount === offspring.length, `The number of offspring created (${offspring.length}) does not match the desired amount (${totalOffspringCount}).`);\r\n\r\n\t\t// Trims species back to their elite genomes.\r\n\t\tconst emptySpeciesFlag = this.trimSpeciesBackToElite();\r\n\r\n\t\t// Rebuilds the genomes array so that it contains only the elite genomes.\r\n\t\tthis.updateGenomesArray();\r\n\r\n\t\tthis.genomes.push(...offspring);\r\n\r\n\t\t// Speciates the new individuals...\r\n\r\n\t\tconsole.log(\"Speciation start\");\r\n\r\n\t\t// If we have terminated species...\r\n\t\tif (emptySpeciesFlag) {\r\n\t\t\t// We need to re-speciate all genomes to divide them evenly between the required number of species.\r\n\t\t\tthis.speciationAlgorithm.respeciateAll(this.genomes, offspring);\r\n\t\t\tthis.species = this.speciationAlgorithm.result;\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Else, simply integrate offspring into the existing species. \r\n\t\t\tthis.speciationAlgorithm.integrateNewGenomes(this.genomes, offspring);\r\n\t\t\tthis.species = this.speciationAlgorithm.result;\r\n\t\t}\r\n\r\n\t\tthis.assertForNoEmptySpecies();\r\n\r\n\t\tconsole.log(\"Speciation end\");\r\n\r\n\t\t// Since bestSpeciesIndex may have changed, we need to once again update the best genome\r\n\t\tthis.sortEachSpecies();\r\n\t\tthis.updateBestGenome();\r\n\r\n\t\tconsole.assert(this.genomes.length === this.populationSize, \"Population size must be equal to the genome count after epoch.\");\r\n\r\n\t\tconsole.log(\"Epoch end\");\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the number of \"generations\" that have been processed.\r\n\t */\r\n\tpublic get generationCount(): Int {\r\n\t\treturn this.generationCounter;\r\n\t}\r\n\r\n\t/**\r\n\t * Tries to find a neuron id associated to the given link using our neurons database\r\n\t * If an id could not be found, -1 is returned\r\n\t * @param  inNeuron\r\n\t * @param  outNeuron\r\n\t */\r\n\tpublic findNeuronIDForMutationAtLink(inNeuron: NeuronGene, outNeuron: NeuronGene): Int {\r\n\t\tfor (const record of this.neuronGenesRecords) {\r\n\t\t\tif (record.inNeuron.id === inNeuron.id && record.outNeuron.id === outNeuron.id) {\r\n\t\t\t\treturn record.id;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n    /**\r\n     * Tries to find the Innovation associated to the given link using our links database\r\n     * If we can't find such Innovation at our database, a new Innovation is created, added to the database and returned\r\n     * @param  inNeuron\r\n     * @param  outNeuron\r\n     * @return\r\n     */\r\n\tpublic determineInnovationForLink(inNeuron: NeuronGene, outNeuron: NeuronGene): Innovation {\r\n\t\tfor (const record of this.linkGenesRecords) {\r\n\t\t\tif (record.inNeuron.id === inNeuron.id && record.outNeuron.id === outNeuron.id) {\r\n\t\t\t\treturn record.innovation;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If we haven't returned by now, it is because we couldn't find the given link at our database\r\n\t\t// Thus we add a new link innovation to this population's database\r\n\t\tthis.innovationNumber++;\r\n\r\n\t\tconst innovation = new Innovation(this.innovationNumber, inNeuron, outNeuron);\r\n\t\tthis.linkGenesRecords.push({ inNeuron, outNeuron, innovation });\r\n\r\n\t\treturn innovation;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds link to genome, with the proper innovation number\r\n\t * @param  genome\r\n\t * @param  inNeuron\r\n\t * @param  outNeuron\r\n\t * @param  weight\r\n\t * @param  isEnabled\r\n\t */\r\n\tpublic addLinkToGenome(genome: Genome, inNeuron: NeuronGene, outNeuron: NeuronGene, weight: number, isEnabled: boolean): void {\r\n\t\tconst newLink = new LinkGene(inNeuron, outNeuron, weight, isEnabled, this.determineInnovationForLink(inNeuron, outNeuron));\r\n\r\n\t\tif (inNeuron.id === outNeuron.id) {\r\n\t\t\tinNeuron.loopedLink = newLink;\r\n\t\t}\r\n\r\n\t\tgenome.linkGenes.push(newLink);\r\n\t}\r\n\r\n\t/**\r\n\t * Aligns genes of A with B, returning AlleleGenesData\r\n\t * Note that matchingGenesA.length = matchingGenesB.length\r\n\t * @param  a\r\n\t * @param  b\r\n\t * @return\r\n\t */\r\n\tpublic alignAlleleGenes(A: Genome, B: Genome): AlleleGenesData {\r\n\t\tA.sortGenes();\r\n\t\tB.sortGenes();\r\n\r\n\t\tconst c = new AlleleGenesData();\r\n\r\n\t\tif (A.id === B.id) {\r\n\t\t\t// There won't be any disjoint or exccess genes.\r\n\t\t\tc.matchingGenesA = A.linkGenes;\r\n\t\t\tc.matchingGenesB = A.linkGenes;\r\n\t\t\treturn c;\r\n\t\t}\r\n\r\n\t\tif (A.linkGenes.length <= 0 || B.linkGenes.length <= 0) {\r\n\t\t\tc.matchingGenesA = [];\r\n\t\t\tconsole.error(`Tried to align allele genes of invalid genome(s). Link Genes in A: ${A.linkGenes.length}. Link Genes in B: ${B.linkGenes.length}`);\r\n\t\t\treturn c;\r\n\t\t}\r\n\r\n\t\tconst maxInnovationNumberA = A.linkGenes[A.linkGenes.length - 1].innovation!.n;\r\n\t\tconst maxInnovationNumberB = B.linkGenes[B.linkGenes.length - 1].innovation!.n;\r\n\r\n\t\tconst maxInnovationNumber = Math.max(maxInnovationNumberA, maxInnovationNumberB);\r\n\r\n\t\t// Aligns the two link genes arrays by adding void genes where there is no link gene with the given\r\n\t\t// innovation number, which now serves as index.\r\n\t\tconst voidedGenesA = new Array<LinkGene | undefined>(maxInnovationNumber).fill(undefined);\r\n\t\tconst voidedGenesB = new Array<LinkGene | undefined>(maxInnovationNumber).fill(undefined);\r\n\r\n\t\tfor (const geneA of A.linkGenes) {\r\n\t\t\tvoidedGenesA[geneA.innovation!.n - 1] = geneA;\r\n\t\t}\r\n\r\n\t\tfor (const geneB of B.linkGenes) {\r\n\t\t\tvoidedGenesB[geneB.innovation!.n - 1] = geneB;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < maxInnovationNumber; ++i) {\r\n\t\t\t// Note i+1 is the innovation number, not i.\r\n\t\t\tconst voidGeneA = voidedGenesA[i];\r\n\t\t\tconst voidGeneB = voidedGenesB[i];\r\n\r\n\t\t\t// If two genes exist with the same innovation number, they are matching genes.\r\n\t\t\tif (!!voidGeneA && !!voidGeneB) {\r\n\t\t\t\tc.matchingGenesA.push(voidGeneA);\r\n\t\t\t\tc.matchingGenesB.push(voidGeneB);\r\n\t\t\t} else if (!!voidGeneA) {\r\n\t\t\t\t// Excess genes from A occur when a gene from A has an innovation number is greater than\r\n\t\t\t\t// the max innovation number of B.\r\n\t\t\t\tif (i + 1 > maxInnovationNumberB) {\r\n\t\t\t\t\tc.excessGenesA.push(voidGeneA);\r\n\t\t\t\t} else { // Else it is a disjoint gene.\r\n\t\t\t\t\tc.disjointGenesA.push(voidGeneA);\r\n\t\t\t\t}\r\n\t\t\t} else if (!!voidGeneB) {\r\n\t\t\t\t// Excess genes from B occur when a gene from B has an innovation number greater than\r\n\t\t\t\t// the max innovation number of A.\r\n\t\t\t\tif (i + 1 > maxInnovationNumberA) {\r\n\t\t\t\t\tc.excessGenesB.push(voidGeneB);\r\n\t\t\t\t} else { // Else it is a disjoint gene.\r\n\t\t\t\t\tc.disjointGenesB.push(voidGeneB);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn c;\r\n\t}\r\n\r\n\t/**\r\n\t * Asserts that there are no empty species.\r\n\t *\r\n\t * @memberof Community\r\n\t */\r\n\tpublic assertForNoEmptySpecies() {\r\n\t\tlet foundNoEmptySpecies = true;\r\n\r\n\t\tfor (const species of this.species) {\r\n\t\t\tif (species.genomes.length <= 0) {\r\n\t\t\t\tfoundNoEmptySpecies = false;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.assert(foundNoEmptySpecies, \"One or more species are empty. It is likely that speciation was not done correctly.\");\r\n\t}\r\n\r\n\tpublic updateStats() {\r\n\t\tlet meanFitness = 0;\r\n\r\n\t\tfor (const genome of this.genomes) {\r\n\t\t\tmeanFitness += genome.fitness;\r\n\t\t}\r\n\r\n\t\tmeanFitness /= this.genomes.length;\r\n\r\n\t\tthis.meanFitnesses[this.generationCounter - 1] = meanFitness;\r\n\t}\r\n\r\n\t/**\r\n\t * Computes spawn count and species' adjusted fitness\r\n\t */\r\n\tpublic computeSpeciesStats(): number {\r\n\t\tlet totalMeanFitness = 0;\r\n\t\tlet totalSpawnCount = 0;\r\n\r\n\t\t// Computes the adjusted fitness and its mean\r\n\t\tfor (const species of this.species) {\r\n\t\t\tif (species.genomes.length <= 0) {\r\n\t\t\t\tconsole.warn(\"Found a species with no members while running NEAT.\");\r\n\t\t\t}\r\n\r\n\t\t\tspecies.computeAdjustedFitnesses(this.params);\r\n\r\n\t\t\ttotalMeanFitness += species.meanAdjustedFitness;\r\n\t\t}\r\n\r\n\t\tfor (const species of this.species) {\r\n\t\t\t// Now, we compute the spawnCount for each species\r\n\r\n\t\t\tspecies.computeSpawnCount(totalMeanFitness);\r\n\t\t\ttotalSpawnCount += species.spawnCount;\r\n\t\t}\r\n\r\n\t\t// Since we are rounding the spawn count for each species, we may have a new generation with too many or too little genomes.\r\n\t\t// Thus, we need to handle those two cases separately to try to mantain the population size constant.\r\n\t\tconst deltaSpawnCount = totalSpawnCount - this.populationSize;\r\n\r\n\t\tif (deltaSpawnCount < 0) {\r\n\t\t\tif (deltaSpawnCount === -1) {\r\n\t\t\t\t// Special (and simpler to handle) case.\r\n\t\t\t\tthis.species[this.bestSpeciesIndex].spawnCount++;\r\n\t\t\t\ttotalSpawnCount += 1;\r\n\t\t\t} else {\r\n\t\t\t\t// In this case, randomly assign the remaining spawn count to each species based on the rounding error of its spawn count.\r\n\t\t\t\tconst probabilities = new Array<number>(this.species.length);\r\n\r\n\t\t\t\tfor (let i = 0; i < this.species.length; ++i) {\r\n\t\t\t\t\tprobabilities[i] = Math.max(0, this.species[i].spawnCountReal - this.species[i].spawnCount);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst probArray = new ProbabilityArray(probabilities);\r\n\r\n\t\t\t\tfor (let i = 0; i < Math.abs(deltaSpawnCount); ++i) {\r\n\t\t\t\t\tconst speciesIndex = probArray.randomlySelect();\r\n\r\n\t\t\t\t\tthis.species[speciesIndex].spawnCount += 1;\r\n\t\t\t\t\tthis.species[speciesIndex].spawnCountReal = this.species[speciesIndex].spawnCount;\r\n\t\t\t\t\ttotalSpawnCount += 1;\r\n\r\n\t\t\t\t\tif (probArray.length() > 1) {\r\n\t\t\t\t\t\tprobArray.removeAt(speciesIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (deltaSpawnCount > 0) {\r\n\t\t\t// This case is treated analogously to the case above, except we remove from the spawn count instead of adding to it.\r\n\t\t\tconst probabilities = new Array<number>(this.species.length);\r\n\r\n\t\t\tfor (let i = 0; i < this.species.length; ++i) {\r\n\t\t\t\tprobabilities[i] = Math.max(0, this.species[i].spawnCount - this.species[i].spawnCountReal);\r\n\t\t\t}\r\n\r\n\t\t\tconst probArray = new ProbabilityArray(probabilities);\r\n\r\n\t\t\tfor (let i = 0; i < Math.abs(deltaSpawnCount); ++i) {\r\n\t\t\t\tconst speciesIndex = probArray.randomlySelect();\r\n\r\n\t\t\t\tthis.species[speciesIndex].spawnCount -= 1;\r\n\t\t\t\tthis.species[speciesIndex].spawnCountReal = this.species[speciesIndex].spawnCount;\r\n\t\t\t\ttotalSpawnCount -= 1;\r\n\r\n\t\t\t\tif (probArray.length() > 1) {\r\n\t\t\t\t\tprobArray.removeAt(speciesIndex);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.assert(this.populationSize === totalSpawnCount, `The total spawn count (${totalSpawnCount}) is different from the expected population size (${this.populationSize}).`);\r\n\r\n\t\t// In order to preserve the best genome, we ensure that the spawn count of the best species is not zero.\r\n\t\tif (this.species[this.bestSpeciesIndex].spawnCount <= 0) {\r\n\t\t\tthis.species[this.bestSpeciesIndex].spawnCount += 1;\r\n\r\n\t\t\t// To compensate, we randomly decrease the spawn count of one of the species by one.\r\n\t\t\tconst shuffledSpecies = this.species.slice();\r\n\t\t\tHelper.shuffle(shuffledSpecies);\r\n\r\n\t\t\tfor (const species of shuffledSpecies) {\r\n\t\t\t\tif (species.spawnCount > 0 &&\r\n\t\t\t\t\tspecies.id !== this.species[this.bestSpeciesIndex].id) {\r\n\t\t\t\t\tspecies.spawnCount -= 1;\r\n\t\t\t\t\tspecies.spawnCountReal -= 1;\r\n\t\t\t\t\tspecies.spawnCountReal = Math.max(0, species.spawnCountReal);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet totalOffspringCount = 0;\r\n\r\n\t\tfor (let i = 0; i < this.species.length; ++i) {\r\n\t\t\tconst species = this.species[i];\r\n\r\n\t\t\tif (species.spawnCount <= 0) {\r\n\t\t\t\tspecies.eliteSize = 0;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst eliteSizeReal = species.genomes.length * this.params.speciesEliteProportion.value;\r\n\t\t\tlet eliteSize = Math.min(Helper.stochasticRound(eliteSizeReal), species.spawnCount);\r\n\r\n\t\t\t// Ensures that the best genome is passed to the next generation\r\n\t\t\tif (i === this.bestSpeciesIndex && eliteSize <= 0) {\r\n\t\t\t\tconsole.assert(this.species[this.bestSpeciesIndex].genomes.length > 0, \"The best species must have at least one genome.\");\r\n\t\t\t\teliteSize = 1;\r\n\t\t\t}\r\n\r\n\t\t\tspecies.eliteSize = eliteSize;\r\n\t\t\tspecies.offspringCount = species.spawnCount - eliteSize;\r\n\r\n\t\t\t// Computes asexual and sexual reproduction count, as well as the number of fittest genomes that will be used as parents\r\n\t\t\tspecies.computeOffspringStats(this.params.offspringAsexualProportion.value, this.params.fittestParentsCutoffProportion.value);\r\n\r\n\t\t\ttotalOffspringCount += species.offspringCount;\r\n\t\t}\r\n\r\n\t\treturn totalOffspringCount;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates offsprings for all species.\r\n\t * Note that computeSpeciesStats must be called before this method.\r\n\t *\r\n\t * @private\r\n\t * @returns {Genome[]}\r\n\t * @memberof Community\r\n\t */\r\n\tpublic createOffspring(): Genome[] {\r\n\t\tconst offspring = new Array<Genome>();\r\n\r\n\t\tlet totalAsexual = 0;\r\n\t\tlet totalSexual = 0;\r\n\t\tlet totalElite = 0;\r\n\r\n\t\tfor (const species of this.species) {\r\n\t\t\ttotalAsexual += species.asexualReproductionCount;\r\n\t\t\ttotalSexual += species.sexualReproductionCount;\r\n\t\t\ttotalElite += species.eliteSize;\r\n\r\n\t\t\tif (species.offspringCount <= 0) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// First, we setup the probabilities array that will be used for getting the parents for asexual & sexual reproduction\r\n\t\t\tconst probs = new Array<number>(species.genomes.length);\r\n\t\t\tlet nonZeroFitness = 0;\r\n\r\n\t\t\tfor (let i = 0; i < species.genomes.length; ++i) {\r\n\t\t\t\tprobs[i] = species.genomes[i].fitness;\r\n\r\n\t\t\t\tif (probs[i] !== 0) {\r\n\t\t\t\t\tnonZeroFitness += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// If everyone has a zero probability of being selected...\r\n\t\t\tif (nonZeroFitness <= 0) {\r\n\t\t\t\t// Makes it so everyone has an equal probability of being selected\r\n\t\t\t\tfor (let i = 0; i < species.genomes.length; ++i) {\r\n\t\t\t\t\tprobs[i] = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Then, we do asexual reproduction\r\n\t\t\tif (species.asexualReproductionCount > 0) {\r\n\t\t\t\tconst probArray = new ProbabilityArray(probs);\r\n\r\n\t\t\t\tfor (let i = 0; i < species.asexualReproductionCount; ++i) {\r\n\t\t\t\t\tconst index = probArray.randomlySelect();\r\n\t\t\t\t\toffspring.push(species.genomes[index].createOffspring(this.params));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Now, we do sexual reproduction (if sexualReproductionCount > 0)\r\n\t\t\tif (species.sexualReproductionCount > 0 && species.fittestParentsCutoff <= species.genomes.length) {\r\n\t\t\t\t// We can reuse the probs array since having normalized the probabilities will make no difference\r\n\t\t\t\tconst parentsProbs = probs.splice(0, species.fittestParentsCutoff);\r\n\r\n\t\t\t\tfor (let i = 0; i < species.sexualReproductionCount; ++i) {\r\n\t\t\t\t\t// Copies parentsProbs and initializes a new ProbabilityArray from that copy.\r\n\t\t\t\t\t// The copy avoids emptying out the parents array accidentally.\r\n\t\t\t\t\t// This also ensures that the indexes match 1:1 to our species' genomes.\r\n\t\t\t\t\tconst parentsProbsArray = new ProbabilityArray(parentsProbs.slice());\r\n\r\n\t\t\t\t\t// Picks parent 1\r\n\t\t\t\t\tconst parent1Index = parentsProbsArray.randomlySelect();\r\n\r\n\t\t\t\t\t// If there is another parent...\r\n\t\t\t\t\tif (parentsProbsArray.length() > 1) {\r\n\t\t\t\t\t\t// Removes the first parent so that it is not considered again\r\n\t\t\t\t\t\tparentsProbsArray.removeAt(parent1Index);\r\n\t\t\t\t\t\tconst parent2Index = parentsProbsArray.randomlySelect();\r\n\r\n\t\t\t\t\t\tconst child = this.crossover(species.genomes[parent1Index], species.genomes[parent2Index]);\r\n\t\t\t\t\t\toffspring.push(child);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// There is only one parent, so we fallback so asexual reproduction\r\n\t\t\t\t\t\toffspring.push(species.genomes[parent1Index].createOffspring(this.params));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.log(`Offspring Report. Asexual: ${totalAsexual}, Sexual: ${totalSexual} and Elite: ${totalElite}.`);\r\n\r\n\t\treturn offspring;\r\n\t}\r\n\r\n\tpublic trimSpeciesBackToElite(): boolean {\r\n\t\tlet foundEmptySpecies = false;\r\n\t\tlet foundBestGenomeNextGen = false;\r\n\r\n\t\tfor (const species of this.species) {\r\n\t\t\tconsole.assert(species.eliteSize <= species.spawnCount && species.eliteSize <= species.genomes.length, \"Some of the elite genomes for this species do not exist!\");\r\n\r\n\t\t\tif (species.eliteSize <= 0 || species.spawnCount <= 0) {\r\n\t\t\t\tspecies.genomes = [];\r\n\t\t\t\tfoundEmptySpecies = true;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tspecies.genomes = species.genomes.splice(0, species.eliteSize);\r\n\r\n\t\t\tif (!!this.bestGenome && species.genomes[0].id === this.bestGenome!.id) {\r\n\t\t\t\tfoundBestGenomeNextGen = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.assert(foundBestGenomeNextGen, \"The best genome has not been passed to the next generation as elite.\");\r\n\r\n\t\treturn foundEmptySpecies;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the genomes array to be the genomes present at our species.\r\n\t *\r\n\t * @private\r\n\t * @memberof Community\r\n\t */\r\n\tpublic updateGenomesArray() {\r\n\t\tthis.genomes = [];\r\n\r\n\t\tfor (const species of this.species) {\r\n\t\t\tthis.genomes.push(...species.genomes);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic sortEachSpecies() {\r\n\t\tfor (const species of this.species) {\r\n\t\t\tspecies.sortGenomes();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Updates bestGenome and bestSpeciesIndex.\r\n\t *\r\n\t * @private\r\n\t * @memberof Community\r\n\t */\r\n\tpublic updateBestGenome() {\r\n\t\tif (this.generationCounter <= 0) {\r\n\t\t\tconsole.warn(\"Tried to call update best genome before epoch!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.generationCounter - 1 >= this.bestFitnesses.length) {\r\n\t\t\tthis.bestFitnesses.push(-1);\r\n\t\t}\r\n\r\n\t\tthis.bestGenome = undefined;\r\n\t\tthis.bestFitnesses[this.generationCounter - 1] = -1;\r\n\r\n\t\tfor (let i = 0; i < this.species.length; ++i) {\r\n\t\t\tthis.species[i].spawnCount = 0;\r\n\t\t\tthis.species[i].offspringCount = 0;\r\n\t\t\tthis.species[i].sexualReproductionCount = 0;\r\n\t\t\tthis.species[i].asexualReproductionCount = 0;\r\n\r\n\t\t\t// Best genome from specices\r\n\t\t\tconst genome = this.species[i].genomes[0];\r\n\r\n\t\t\tif (genome.fitness > this.bestFitnesses[this.generationCounter - 1]) {\r\n\t\t\t\tthis.bestFitnesses[this.generationCounter - 1] = genome.fitness;\r\n\t\t\t\tthis.bestGenome = genome;\r\n\t\t\t\tthis.bestSpeciesIndex = i;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","import Scalar from '../../scalar';\r\n\r\nexport default class NEATParams {\r\n    public readonly showLog = new Scalar('Universal', 'Show errors', 1).wholeNumber().ranged(0, 1);\r\n\r\n    public readonly initialGenomeCount = new Scalar('Universal', 'Initial genome count', 180).wholeNumber().ranged(1, 2000);\r\n    public readonly initialSpeciesCount = new Scalar('Universal', 'Initial species count', 40).wholeNumber().ranged(1, 2000);\r\n\r\n\r\n    // Epoch Params\r\n\r\n    /**\r\n     * For each possible link for the initial genome, the probability of making the connection. Note that genomes with zero links automatically get one link added to them.\r\n     *\r\n     * @memberof NEATParams\r\n     */\r\n    public readonly probOfMakingLinkInInitialGenome = new Scalar('Epoch', 'Probability of Making Each Link In Initial Genome', 0.1).ranged(0.0001, 1);\r\n\r\n    /**\r\n     * sh c1 linear coefficient (see compatibility distance function)\r\n     */\r\n\tpublic readonly excessGenesCoefficient = new Scalar('Epoch', 'Sharing excess coefficient (C1)', 1).ranged(0.0001, 10);\r\n\r\n    /**\r\n     * sh c2 linear coefficient (see compatibility distance function)\r\n     */\r\n    public readonly disjointGenesCoefficient = new Scalar('Epoch', 'Sharing disjoint coefficient (C2)', 1).ranged(0.0001, 10);\r\n\r\n    /**\r\n     * c3 linear coefficient (see compatibility distance function)\r\n     */\r\n    public readonly weightsCoefficient = new Scalar('Epoch', 'Sharing weights coefficient (C3)', 0.4).ranged(0.0001, 10);\r\n\r\n    /**\r\n     * sh threshold\r\n     */\r\n    public readonly shThreshold = new Scalar('Epoch', \"Sharing threshold\", 3).ranged(0.0001, 10);\r\n\r\n    /**\r\n     * Chance of an offspring to be generated from two different species.\r\n     * TODO: Implement this\r\n     */\r\n    public readonly interspeciesMatingRate = new Scalar('Epoch', \"Interspecies mating rate\", 0.0).ranged(0.00001, 1);\r\n\r\n    \r\n    /**\r\n     * Chance of a link being disabled in the offspring if it was disabled in either parent.\r\n     */\r\n    public readonly offspringLinkDisableRate = new Scalar('Epoch', \"Sharing threshold\", 0.75).ranged(0.0001, 1);\r\n    \r\n    /**\r\n     * Minimum compatibility distance for a genome to have with the representative genome of a species in order to add such genome to the species\r\n     */\r\n    public readonly minSpeciesCompatibilityDistance = new Scalar('Epoch', 'Min species compatibility distance', 0.2).ranged(0.0001, 3);\r\n\r\n    /**\r\n     * If a species has been stagnated for the specified amount of generations, it will be removed\r\n     */\r\n    public readonly maxStagnationAllowed = new Scalar('Epoch', 'Max species stagnation', 15).wholeNumber().ranged(1, 200);\r\n\r\n    /**\r\n     * Proportion of top genomes that will be retained for the next generation. If set to zero, no elitism is applied.\r\n     */\r\n    public readonly speciesEliteProportion = new Scalar('Epoch', 'Species elite proportion', 0.1).ranged(0, 1);\r\n\r\n    /**\r\n     * Proportion of offspring that result from asexual reproduction.\r\n     */\r\n    public readonly offspringAsexualProportion = new Scalar('Epoch', 'Asexual reproduction proportion', 0.75).ranged(0, 1);\r\n\r\n    /**\r\n     * Proportion of parents to pick amongst the fittest genomes of a species.\r\n     */\r\n    public readonly fittestParentsCutoffProportion = new Scalar('Epoch', 'Parents proportion amongst fittest', 0.5).ranged(0, 1);\r\n\r\n    // -----------------\r\n    //  Mutation Params\r\n    // -----------------\r\n\r\n    public readonly maxNumberOfHiddenNeurons = new Scalar('Mutation', 'Max Number of Hidden Neurons', 40).wholeNumber().ranged(0, 500);\r\n\r\n    /**\r\n     * Mutation rate for a hidden neuron.\r\n     */\r\n    public readonly hiddenNeuronMutationRate = new Scalar('Mutation', 'Hidden Neuron Mutation Rate', 0.25).ranged(0, 1);\r\n    public readonly linkMutationRate = new Scalar('Mutation', 'Link Mutation Rate', 0.7).ranged(0, 1);\r\n\r\n    /**\r\n     * At the specified chance, if the two randomly selected neurons are the same neuron, a looped recurrency will be made\r\n     */\r\n    public readonly linkMutationChanceOfConsideringLoopedRecurrency = new Scalar('Mutation', 'Chance of Considering Looped Recurrencies', 0).ranged(0, 1);\r\n\r\n\tpublic readonly weightMutationRateForEachLink = new Scalar('Mutation', 'Weight Mutation Rate For Each Link', 0.9).ranged(0, 1);\r\n    public readonly weightMutationProbNewVal = new Scalar('Mutation', 'New Weight Value Mutation Rate', 0.1).ranged(0, 1);\r\n\r\n    public readonly biasMutationRateForEachLink = new Scalar('Mutation', 'Bias Mutation Rate For Each Link', 0.2).ranged(0, 1);\r\n    public readonly biasMutationProbNewVal = new Scalar('Mutation', 'New Bias Value Mutation Rate', 0.07).ranged(0, 1);\r\n\r\n    /**\r\n     * New range for the node value when mutating (i.e. random value in [oldValue - 0.5, oldValue + 0.5])\r\n     */\r\n    public readonly weightMutationMaxPertubation = new Scalar('Mutation', 'Weight Mutation Max Pertubation', 0.5).ranged(0, 1);\r\n    public readonly weightMutationNewValRange = new Scalar('Mutation', 'New Weight Value Mutation Range', 3).ranged(0, 1);\r\n\r\n    /**\r\n     * New range for the node value when mutating (i.e. random value in [oldValue - 0.5, oldValue + 0.5])\r\n     */\r\n    public readonly biasMutationMaxPertubation = new Scalar('Mutation', 'Bias Mutation Max Pertubation', 0.5).ranged(0, 1);\r\n    public readonly biasMutationNewValRange = new Scalar('Mutation', 'New Bias Value Mutation Range', 3).ranged(0, 1);\r\n}\r\n","import Genome from \"../genome\";\r\nimport Species from \"./index\";\r\n\r\nexport default abstract class SpeciationAlgorithm {\r\n    protected species: Species[] = [];\r\n\r\n    /**\r\n     * Initializes speciation for a certain genome population.\r\n     *\r\n     * @abstract\r\n     * @param {Genome[]} genomes\r\n     * @param {number} speciesCount\r\n     * @memberof SpeciationAlgorithm\r\n     */\r\n    public abstract init(genomes: Genome[], speciesCount: number): void;\r\n    \r\n    /**\r\n     * Respeciates all genomes.\r\n     * \r\n     * @abstract\r\n     * @param {Genome[]} genomes\r\n     * @param {Genome[]} offspring\r\n     * @memberof SpeciationAlgorithm\r\n     */\r\n    public abstract respeciateAll(genomes: Genome[], offspring: Genome[]): void;\r\n\r\n    /**\r\n     * Integrates new genomes into existing species.\r\n     *\r\n     * @abstract\r\n     * @param {Genome[]} genomes\r\n     * @param {Genome[]} offspring\r\n     * @memberof SpeciationAlgorithm\r\n     */\r\n    public abstract integrateNewGenomes(genomes: Genome[], offspring: Genome[]): void;\r\n\r\n    public get result() {\r\n        return this.species;\r\n    }\r\n}","import Community from '../community';\r\nimport Genome from '../genome';\r\nimport Helper from '../utils/helper';\r\nimport NEATParams from '../params';\r\n\r\ntype Int = number;\r\n\r\n/**\r\n * A Species is a group of similar genomes\r\n * See http://nn.cs.utexas.edu/downloads/papers/stanley.ec02.pdf section 3.3 for more details\r\n * @param       {Genome} leader\r\n * @constructor\r\n */\r\nexport default class Species {\r\n\tpublic readonly community: Community;\r\n\tpublic readonly id: Int;\r\n\r\n\tpublic gensStagnated: Int = 0;\t\t // Number of generations without improvement\r\n\tpublic meanAdjustedFitness: Int = 0; // Average adjusted fitness of members\r\n\t\r\n\tpublic spawnCount: Int = 0;    \t\t      // eliteSize + offspringCount\r\n\tpublic spawnCountReal: number = 0;   \t  // The unrounded spawn count for this species\r\n\tpublic eliteSize: Int = 0;      \t\t  // Number of elite genomes that will be kept for the next generation\r\n\tpublic offspringCount: Int = 0;   \t      // Number of offsprings this species will produce\r\n\tpublic asexualReproductionCount: Int = 0; // Number of offspring generated from the same parent.\r\n\tpublic sexualReproductionCount: Int = 0;  // Number of offspring generated from two different parents\r\n\tpublic fittestParentsCutoff: Int = 0; \t  // Number of the fittest genomes that will be selected as parents \r\n\r\n\tpublic leader: Genome;\r\n\tpublic genomes: Genome[] = [];\r\n\r\n\tconstructor(community: Community, firstGenome: Genome) {\r\n\t\tthis.community = community;\r\n\t\t++community.maxSpeciesID;\r\n\t\tthis.id = community.maxSpeciesID;\r\n\r\n\t\tthis.leader = firstGenome;\r\n\t\tthis.genomes.push(this.leader);\r\n\t}\r\n\r\n\t/**\r\n\t * Ensure offspringCount has already been calculated before calling.\r\n\t * Computes asexual and sexual reproduction count, as well as the number of fittest genomes that will be used as parents.\r\n\t * \r\n\t * @memberof Species\r\n\t */\r\n\tpublic computeOffspringStats(offspringAsexualProportion: number, fittestParentsCutoffProportion: number) {\r\n\t\tif (this.offspringCount <= 0) {\r\n\t\t\tthis.asexualReproductionCount = 0;\r\n\t\t\tthis.sexualReproductionCount = 0;\r\n\t\t\tthis.fittestParentsCutoff = 0;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst offspringAsexualCountReal = this.offspringCount * offspringAsexualProportion;\r\n\t\tthis.asexualReproductionCount = Helper.stochasticRound(offspringAsexualCountReal);\r\n\t\tthis.sexualReproductionCount = this.offspringCount - this.asexualReproductionCount;\r\n\r\n\t\tconst fittestParentsCutoffReal = this.genomes.length * fittestParentsCutoffProportion;\r\n\t\tthis.fittestParentsCutoff = Math.min(Math.max(2, Helper.stochasticRound(fittestParentsCutoffReal)), this.genomes.length);\r\n\t\r\n\t\t// If there is only one parent, we fallback to asexual reproduction\r\n\t\tif (this.fittestParentsCutoff === 1) {\r\n\t\t\tthis.asexualReproductionCount += this.sexualReproductionCount;\r\n\t\t\tthis.sexualReproductionCount = 0;\r\n\t\t}\r\n\t}\r\n\r\n    /**\r\n     * Must be called after computeAdjustedFitnesses.\r\n     * Computes the spawn count of each individual and the total for the species.\r\n     * @return\r\n     */\r\n\tpublic computeSpawnCount(totalMeanFitness: number) {\r\n\t\t// If the total mean fitness is zero, we spawn the same number of genomes for each species.\r\n\t\tthis.spawnCountReal = totalMeanFitness === 0 ? this.community.genomes.length / this.community.species.length\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t : (this.meanAdjustedFitness / totalMeanFitness) * this.community.genomes.length;\r\n\r\n\t\tthis.spawnCount = Helper.stochasticRound(this.spawnCountReal);\r\n\t}\r\n\r\n    /**\r\n     * Calculates adjustedFitness value for each member genome, as well as the meanAdjustedFitness.\r\n     * @param  params\r\n     * @param  threshold  Affects how the adjusted fitness relates to the compatibility distance. Passed to the sh method.\r\n     * @return\r\n     */\r\n\tpublic computeAdjustedFitnesses(params: NEATParams) {\r\n\t\tlet mean = 0;\r\n\r\n\t\tfor (const mom of this.genomes) {\r\n\t\t\tlet sharing = 0;\r\n\r\n\t\t\tfor (const dad of this.genomes) {\r\n\t\t\t\tsharing += sh(mom.compatibilityDistance(dad, params), params.shThreshold.value);\r\n\t\t\t}\r\n\r\n\t\t\tif (sharing <= 0) {\r\n\t\t\t\tconsole.warn(\"Found a species with a genome that has zero sharing.\");\r\n\t\t\t}\r\n\r\n\t\t\tmom.adjustedFitness = mom.fitness / sharing;\r\n\t\t\tmean += mom.adjustedFitness;\r\n\t\t}\r\n\r\n\t\tmean /= this.genomes.length;\r\n\t\tthis.meanAdjustedFitness = mean;\r\n\t}\r\n\r\n\t/**\r\n\t * Sorts member genomes in decrescent raw fitness order\r\n\t * @return\r\n\t */\r\n\tpublic sortGenomes() {\r\n\t\tthis.genomes.sort((a, b) => {\r\n\t\t\treturn b.fitness - a.fitness;\r\n\t\t});\r\n\t}\r\n}\r\n\r\n/**\r\n * Sharing function as described in the NEAT paper\r\n * @param  compatibilityDistance\r\n * @param  threshold\r\n * @return\r\n */\r\nfunction sh(compatibilityDistance: number, threshold: number): Int {\r\n\treturn compatibilityDistance > threshold ? 0 : 1;\r\n}\r\n","import SpeciationAlgorithm from \"./speciationAlgorithm\";\r\nimport Genome from \"../genome\";\r\nimport Species from \"./index\";\r\nimport NEATParams from \"../params\";\r\n\r\nexport default class UncannyValleySpeciationAlgorithm extends SpeciationAlgorithm {\r\n    public speciesCount: number = 0;\r\n\r\n    private readonly params: NEATParams;\r\n\r\n    constructor(params: NEATParams) {\r\n        super();\r\n        this.params = params;\r\n    }\r\n    \r\n    public init(genomes: Genome[], speciesCount: number) {\r\n        this.speciesCount = speciesCount;\r\n        this.species = new Array<Species>(speciesCount);\r\n\r\n        let assignedGenomesCount = 0;\r\n        let speciesIndex = 0;\r\n\r\n        while (assignedGenomesCount < genomes.length) {\r\n            if (speciesIndex > this.species.length - 1) {\r\n                speciesIndex = 0;\r\n            }\r\n\r\n            if (!this.species[speciesIndex]) {\r\n                this.species[speciesIndex] = new Species(genomes[0].community!, genomes[assignedGenomesCount]);\r\n            } else {\r\n                this.species[speciesIndex].genomes.push(genomes[assignedGenomesCount]);\r\n            }\r\n\r\n            genomes[assignedGenomesCount].species = this.species[speciesIndex];\r\n\r\n            assignedGenomesCount += 1;\r\n            speciesIndex += 1;\r\n        }\r\n    }\r\n    \r\n    public respeciateAll(genomes: Genome[], offspring: Genome[]) {\r\n        for (let i = this.species.length - 1; i >= 0; --i) {\r\n            if (this.species[i].genomes.length <= 0) {\r\n                this.species.splice(i, 1);\r\n            }\r\n        }\r\n\r\n        this.integrateNewGenomes(genomes, offspring);\r\n    }\r\n\r\n    public integrateNewGenomes(genomes: Genome[], offspring: Genome[]) {\r\n        this.updateLeaders(genomes);\r\n        \r\n        // newGenomes are offspring from the previous generation. As a convention, their species are set to the parents' species.\r\n        \r\n        const newSpeciesPool: Species[] = [];\r\n\r\n        for (const genome of offspring) {\r\n            if (!genome.species) {\r\n                console.warn(\"Could not find parent species.\");\r\n                continue;\r\n            }\r\n\r\n            const isCompatibleWithParent = genome.compatibilityDistance(genome.species!.leader, this.params) < this.params.minSpeciesCompatibilityDistance.value;\r\n\r\n            // If compatible with parent...\r\n            if (isCompatibleWithParent) {\r\n                // Search for non-parent species below threshold\r\n                for (const species of this.species) {\r\n                    if (species.id !== genome.species!.id) {\r\n                        const isCompatible = genome.compatibilityDistance(genome.species!.leader, this.params) < this.params.minSpeciesCompatibilityDistance.value;\r\n                        \r\n                        if (isCompatible) {\r\n                            genome.species = species;\r\n                            species.genomes.push(genome);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                // Else just stick to the parent species\r\n            } else {\r\n                // If not, we either create a new species or we place the genome with the most compatible amongst the parent and the new species.\r\n                \r\n                if (newSpeciesPool.length + this.species.length < this.speciesCount) {\r\n                    newSpeciesPool.push(new Species(genome.community!, genome));\r\n                } else {\r\n                    let minCompatDistance = Number.POSITIVE_INFINITY;\r\n                    let closestSpecies: Species | undefined;\r\n\r\n                    for (const species of newSpeciesPool) {\r\n                        const compatDistance = genome.compatibilityDistance(species.leader, this.params);\r\n\r\n                        if (compatDistance < minCompatDistance) {\r\n                            closestSpecies = species;\r\n                            minCompatDistance = compatDistance;\r\n                        }\r\n                    }\r\n\r\n                    // If better compatible with parent species...\r\n                    if (genome.compatibilityDistance(genome.species.leader, this.params) < minCompatDistance) {\r\n                        closestSpecies = genome.species;\r\n                    }\r\n\r\n                    genome.species = closestSpecies;\r\n                    closestSpecies?.genomes.push(genome);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.species.push(...newSpeciesPool);\r\n    }\r\n\r\n    private updateLeaders(genomes: Genome[]) {\r\n        let newLeader: Genome | undefined;\r\n        let newLeaderCompat = 0;\r\n        let unspeciatedCount = 0;\r\n\r\n        // It is possible that the leader of a species was removed\r\n        // So we search for an unspeciated genome that is closest to the previous leader\r\n        for (const species of this.species) {\r\n            newLeader = species.genomes[0];\r\n\r\n            // The genome with smallest compatibility distance to the previous leader to be the new leader\r\n            for (const genome of genomes) {\r\n                // Checks if the old leader is at the new generation\r\n                if (genome.id === species.leader.id) {\r\n                    // If it is, just pick him\r\n                    newLeader = genome;\r\n                    break;\r\n                }\r\n\r\n                if (!genome.species || genome.species.id === species.id) {\r\n                    const compat = genome.compatibilityDistance(species.leader, this.params);\r\n                    ++unspeciatedCount;\r\n\r\n                    if (compat < newLeaderCompat) {\r\n                        newLeader = genome;\r\n                        newLeaderCompat = compat;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (newLeader == null) {\r\n                console.error(\"Could not find new leader for a species. Unspeciated count: \" + unspeciatedCount + \", Genome count: \" + genomes.length);\r\n            }\r\n\r\n            newLeader = newLeader!;\r\n        }\r\n    }\r\n}","import Draw, { ILinkDrawData, INeuronDrawData } from '../../../draw';\r\nimport DrawLog from '../../../draw/log';\r\nimport EnvironmentModel from '../../envs/environmentModel';\r\nimport AgentModel from '../agentModel';\r\nimport Individual from '../individual';\r\nimport Community from './community';\r\nimport Genome from './genome';\r\nimport NeuralNetwork from './neuralNetworks';\r\nimport NEATParams from './params';\r\nimport UncannyValleySpeciationAlgorithm from './species/uncannyValleySpeciationAlgorithm';\r\n\r\ninterface INetworkDrawData {\r\n\tneurons: INeuronDrawData[];\r\n\tlinks: ILinkDrawData[];\r\n}\r\n\r\nexport default class NEATAgent extends AgentModel {\r\n\tprivate params: NEATParams = new NEATParams();\r\n\tprivate community?: Community;\r\n\tprivate phenotype?: NeuralNetwork = undefined;\r\n\tprivate currentGenome?: Genome = undefined;\r\n\tprivate shouldStop = false;\r\n\r\n\tprivate savedGenomeCount = 0;\r\n\r\n\tprivate latexFormula: string[] = [];\r\n\r\n\t// Used for rendering purposes\r\n\tprivate popDrawIndex: number = 0;\r\n\tprivate popDrawData: INetworkDrawData[] = [];\r\n\r\n\tpublic constructor(env: EnvironmentModel) {\r\n\t\tsuper('neat', env);\r\n\r\n\t\tDrawLog.printToConsole = true;\r\n\r\n\t\tthis.addParamsFromObject(this.params);\r\n\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic resetState() {\r\n\t\tconst speciationAlgorithm = new UncannyValleySpeciationAlgorithm(this.params);\r\n\t\t\r\n\t\tthis.community = new Community(this.params, this.env.obsCount(), this.env.actionsCount(), speciationAlgorithm);\r\n\t\tthis.community.init();\r\n\r\n\t\tthis.phenotype = undefined;\r\n\t\tthis.currentGenome = undefined;\r\n\r\n\t\tthis.populationData();\r\n\t}\r\n\r\n\tpublic prepareForIndividual(individual: Individual) {\r\n\t\tif (!!this.env!.saveRequestedName) {\r\n\t\t\tthis.currentGenome!.saveWithName(this.env!.saveRequestedName);\r\n\t\t\tthis.env!.saveRequestedName = undefined;\r\n\t\t}\r\n\r\n\t\tif (!!this.env && this.env!.hasReachedGoal) {\r\n\t\t\tthis.goalReached();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!individual) {\r\n\t\t\tconsole.warn(\"Tried preparing for null individual!\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst genome = individual as Genome;\r\n\t\tthis.currentGenome = genome;\r\n\t\tthis.phenotype = genome.createPhenotype();\r\n\r\n\t\t// this.latexFormula = this.phenotype.generateFormula(this.env.obsFormulaNames(), 2);\r\n\r\n\t\t++this.popDrawIndex;\r\n\t}\r\n\r\n\tpublic goalReached() {\r\n\t\tconsole.log(\"Fitness Goal Reached. Ending algorithm...\");\r\n\r\n\t\tif (!!this.currentGenome) {\r\n\t\t\tthis.currentGenome!.saveWithName(\"best.genome\");\r\n\t\t}\r\n\r\n\t\tthis.shouldStop = true;\r\n\t}\r\n\r\n\tpublic act() {\r\n\t\tif (!this.phenotype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet index = 0;\r\n\t\tconst outputs = this.phenotype!.activate(this.env.obsValues());\r\n\t\t\r\n\t\tfor (const s of this.env.actions) {\r\n\t\t\tlet val = 0;\r\n\r\n\t\t\tif (outputs[index] >= 0) {\r\n\t\t\t\tval = 1;\r\n\t\t\t} else {\r\n\t\t\t\tval = 0;\r\n\t\t\t}\r\n\r\n\t\t\ts.value = val;\r\n\t\t\t\t\t\t\r\n\t\t\t++index;\r\n\t\t}\r\n\t} \r\n\r\n\tpublic draw(context: CanvasRenderingContext2D) {\r\n\t\tDraw.context = context;\r\n\t\tDraw.clear();\r\n\r\n\t\tif (!this.community) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tDrawLog.render(context); // Draws logs\r\n\t\t\r\n\t\tDraw.setTranslation(0, 0);\r\n\r\n\t\tDraw.normX = Draw.normY = true;\r\n\t\tDraw.normWidth = Draw.normHeight = true;\r\n\r\n\t\tDraw.text(-0.98, 0.94, 'Gen ' + (this.community.generationCount + 1), '300 18px sans-serif', 'black', 'left');\r\n\r\n\t\tif (!!this.community.bestGenome) {\r\n\t\t\tDraw.text(-0.68, 0.94, 'Best: ' + Math.round(this.community.bestGenome.fitness * 100) / 100, 'Arial', 'black');\r\n\t\t}\r\n\r\n\t\tif (this.community.bestFitnesses.length > 0) {\r\n\t\t\tconst bestFitness = this.community.bestFitnesses[this.community.generationCount - 1];\r\n\t\t\tDraw.text(0, 0.94, 'Gen Best: ' + Math.round(bestFitness * 100) / 100, 'Arial', 'black');\r\n\t\t}\r\n\r\n\t\tif (this.popDrawIndex >= 0) {\r\n\t\t\tDraw.text(-0.98, 0.85, 'Fitness: ' + Math.round(this.env.fitness() * 100) / 100, 'Arial', 'green', 'left');\r\n\t\t}\r\n\r\n\t\tif (this.popDrawIndex >= 0) {\r\n\t\t\tDraw.text(0, 0.85, 'Species: ' + this.community.species.length, 'Arial', 'black', 'left');\r\n\t\t}\r\n\r\n\t\tif (this.popDrawIndex >= 0) {\r\n\t\t\tDraw.normX = Draw.normY = true;\r\n\t\t\tDraw.normWidth = Draw.normHeight = true;\r\n\r\n\t\t\tif (!!this.popDrawData && !!this.popDrawData[this.popDrawIndex] && !!this.popDrawData[this.popDrawIndex].neurons && !!this.phenotype) {\r\n\t\t\t\tDraw.linkShadowBlur = 0;\r\n\t\t\t\tDraw.inputNeuronShadowBlur = 10;\r\n\t\t\t\tDraw.hiddenNeuronShadowBlur = 20;\r\n\t\t\t\tDraw.outputNeuronShadowBlur = 10;\r\n\t\t\t\tDraw.inputNeuronRadius = 0.005;\r\n\t\t\t\tDraw.hiddenNeuronRadius = 0.006;\r\n\t\t\t\tDraw.outputNeuronRadius = 0.0065;\r\n\t\t\t\tDraw.linkLineWidth = 1;\r\n\t\t\t\tDraw.neuralNetwork(0, 0, 0.4, 0.95, this.popDrawData[this.popDrawIndex].neurons, this.popDrawData[this.popDrawIndex].links, this.phenotype);\r\n\t\t\t}\r\n\t\t\t/*\r\n\t\t\t// Draws genotype\r\n\t\t\tDraw.normX = Draw.normY = false;\r\n\t\t\tDraw.text(-Draw.width()/2 + 64, -Draw.height()/3.2, 'Genotype:', '300 21px sans-serif', 'black');\r\n\t\t\tDraw.genome(-Draw.width()/2 + 64, -Draw.height()/2.9, this.currentGenome!, 'black');\r\n\t\t\tDraw.normX = Draw.normY = true;\r\n\r\n\t\t\t// Draws phenotype label\r\n\t\t\tDraw.normX = false;\r\n\t\t\tDraw.text(-Draw.width()/2 + 64, 0.34, 'Phenotype:', '300 21px sans-serif', 'black');\r\n\t\t\tDraw.normX = true;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// Draws all latex formulas\r\n\t\t\tlet yOffset = 0;\r\n\t\t\tfor (const formula of this.latexFormula) {\r\n\t\t\t\tyOffset += 0.05;\r\n\t\t\t\tDraw.text(0, -0.34 - yOffset, formula, '300 19px sans-serif', 'black');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst width = 1 / this.popDrawData.length;\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < this.community.genomes.length; ++i) {\r\n\t\t\t\tif (i === this.popDrawIndex) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDraw.neuralNetwork((i*width - 0.5) * 2 + width, -0.7, 0.125, 0.125, 0.008, this.popDrawData[i].neurons, this.popDrawData[i].links, undefined);\r\n\r\n\t\t\t\tif (i < this.popDrawIndex) {\r\n\t\t\t\t\tDraw.normX = false;\r\n\t\t\t\t\tconst baseX = (i*width - 0.5) * Draw.width();\r\n\t\t\t\t\tDraw.text(baseX + 40, 0.87, String(Math.round(this.community.genomes[i].fitness * 100) / 100), '12px Arial', 'green');\r\n\t\t\t\t\tDraw.normX = true;\r\n\t\t\t\t}\r\n\t\t\t}*/\r\n\t\t}\r\n\t}\r\n\r\n\tpublic loop(delta: number) {\r\n\t\tif (this.shouldStop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.env.hasReachedGoal) {\r\n\t\t\tthis.goalReached();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tsuper.lifecycle(delta, !!this.community ? this.community.genomes : []);\r\n\t}\r\n\r\n\tpublic epoch() {\r\n\t\tif (!this.community) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.community.epoch();\r\n\t\t\r\n\t\tif (!!this.community.bestGenome && this.savedGenomeCount < this.community.generationCount) {\r\n\t\t\tthis.community.bestGenome.saveWithName(\"gen\" + (this.community.generationCount) + \".genome\");\r\n\t\t\tthis.savedGenomeCount += 1;\r\n\t\t}\r\n\r\n\t\tconsole.log(\"Best fitnesses: \", this.community.bestFitnesses);\r\n\t\tconsole.log(\"Mean fitnesses: \", this.community.meanFitnesses);\r\n\r\n\t\tthis.populationData();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the data used for drawing the neurons and genomes.\r\n\t */\r\n\tprivate populationData() {\r\n\t\tif (!this.community) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.popDrawIndex = -1;\r\n\t\tthis.popDrawData = [];\r\n\r\n\t\tfor (const genome of this.community.genomes) {\r\n\t\t\tconst linksData = genome.linkGenes.map((link) => {\r\n\t\t\t\treturn { inIndex: genome.getNeuronIndexByID(link.inNeuron.id), outIndex: genome.getNeuronIndexByID(link.outNeuron.id), isEnabled: false };\r\n\t\t\t});\r\n\r\n\t\t\tconst neuronsData = genome.neuronGenes.map((neuron) => {\r\n\t\t\t\treturn { splitX: neuron.splitX, splitY: neuron.splitY, type: neuron.type, id: neuron.id };\r\n\t\t\t});\r\n\r\n\t\t\tconst nnData = { links: linksData, neurons: neuronsData };\r\n\t\t\tthis.popDrawData.push(nnData);\r\n\t\t}\r\n\t}\r\n}\r\n","import EnvironmentModel from '../../envs/environmentModel';\r\nimport AgentModel from '../agentModel';\r\nimport Individual from '../individual';\r\n\r\nexport default class RandomAgent extends AgentModel {\r\n\tprivate individuals: Individual[] = [];\r\n\tprivate shouldStop = false;\r\n\r\n\tpublic constructor(environment: EnvironmentModel) {\r\n\t\tsuper(\"randomAgent\", environment);\r\n\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic resetState() {\r\n\t\tthis.individuals = [ new Individual() ];\r\n\t}\r\n\r\n\tpublic prepareForIndividual(individual: Individual) {\r\n\t\t// ...\r\n\t}\r\n\r\n\tpublic draw(context: CanvasRenderingContext2D) {\r\n\t\t// ...\r\n\t}\r\n\r\n\tpublic goalReached() {\r\n\t\tthis.shouldStop = true;\r\n\t}\r\n\r\n\tpublic loop(delta: number) {\r\n\t\tif (this.shouldStop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.env.hasReachedGoal) {\r\n\t\t\tthis.goalReached();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsuper.lifecycle(delta, this.individuals);\r\n\t}\r\n\r\n\tpublic act() {\r\n\t\tfor (const s of this.env.actions) {\r\n\t\t\tif (Number.isFinite(s.min) && Number.isFinite(s.max)) {\r\n\t\t\t\tif (!s.isWhole) {\r\n\t\t\t\t\ts.value = Math.random() * (s.max - s.min) + s.min;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ts.value = Math.random() * (s.max - s.min + 1) + s.min;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ts.value = Math.random() * 2 - 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (s.isWhole) {\r\n\t\t\t\ts.value = Math.round(s.value);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic epoch() {\r\n\t\t/*\r\n\t\tpool.individuals.sort((a: Individual, b: Individual) => {\r\n\t\t\treturn b.fitness - a.fitness;\r\n\t\t});\r\n\t\tpool.individuals = pool.individuals.slice(0, Math.min(Math.ceil(pool.individuals.length * 0.2), pool.individuals.length - 1));\r\n\t\t*/\r\n\t}\r\n}","import Scalar from \"../scalar\";\r\n\r\ntype Int = number;\r\n\r\n/**\r\n * Model for a reinforcement learning environment.\r\n */\r\nexport default abstract class EnvironmentModel {\r\n\tpublic readonly modelName: string;\r\n\t\r\n\tpublic readonly actions: Scalar[];\r\n\r\n\t/**\r\n\t * Array of initial parameters for this model.\r\n\t */\r\n\tpublic readonly paramsArray: Scalar[] = [];\r\n\r\n\tpublic hasReachedGoal = false;\r\n\r\n\t/**\r\n\t * If not undefined, requests the current individual to be saved to disk when evaluation ends.\r\n\t */\r\n\tpublic saveRequestedName?: string = undefined;\r\n\r\n\tprotected readonly obsArray: Scalar[];\r\n\r\n\t/**\r\n\t * @param modelName \r\n\t * @param actionsDef Defines the expected behaviour of each action (eg. is whole number, value range) and the action scalar count.\r\n\t */\r\n\tpublic constructor(modelName: string) {\r\n\t\tthis.modelName = modelName;\r\n\t\tthis.actions = [];\r\n\t\tthis.obsArray = [];\r\n\t\tthis.paramsArray = [];\r\n\t}\r\n\r\n\tpublic reset(newParamsArray: Scalar[]) : void {\r\n\t\tfor (const newParam of newParamsArray) {\r\n\t\t\tfor (const param of this.paramsArray) {\r\n\t\t\t\tif (param.familyName === newParam.familyName && param.name === newParam.name) {\r\n\t\t\t\t\tparam.value = newParam.value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic requestSave(withFileName) {\r\n\t\tthis.saveRequestedName = withFileName;\r\n\t}\r\n\r\n\tpublic abstract resetState() : void;\r\n\r\n\tpublic actionsCount() : Int {\r\n\t\treturn this.actions.length;\r\n\t}\r\n\r\n\tpublic obsCount() : Int {\r\n\t\treturn this.obsArray.length;\r\n\t}\r\n\r\n\tpublic obsFormulaNames() : string[] {\r\n\t\treturn this.obsArray.map(e => e.formulaName);\r\n\t}\r\n\r\n\tpublic obsValues() : number[] {\r\n\t\treturn this.obsArray.map(e => e.value);\r\n\t}\r\n\r\n\t/**\r\n\t * Resets the variables from the environment in order to start a new fitness evaluation.\r\n\t */\r\n\tpublic abstract prepareForNewIndividual() : void;\r\n\r\n\t/**\r\n\t * Called just before the next epoch\r\n\t */\r\n\tpublic abstract prepareForEpoch() : void;\r\n\r\n\t/**\r\n\t * Updates the environment based on the actions' values.\r\n\t * @returns If true, the fitness evaluation should end.\r\n\t */\r\n\tpublic abstract step(delta: number) : boolean;\r\n\r\n\t/**\r\n\t * Draws the a visual representation of the environment\r\n\t */\r\n\tpublic abstract draw(context: CanvasRenderingContext2D) : void;\r\n\r\n\t/**\r\n\t * Returns the fitness calculated throughout the agent-environment interaction\r\n\t */\r\n\tpublic abstract fitness() : number;\r\n\r\n\t/**\r\n\t * Adds each scalar from the specified object as paramaters for this model.\r\n\t * @param obj \r\n\t */\r\n\tprotected addParamsFromObject(obj: any) {\r\n\t\tScalar.addScalarsFromObjectToArray(obj, this.paramsArray);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds each scalar from the specified object as observations scalar for this model.\r\n\t * @param obj \r\n\t */\r\n\tprotected addObsFromObject(obj: any) {\r\n\t\tScalar.addScalarsFromObjectToArray(obj, this.obsArray);\r\n\t}\r\n\r\n\t/**\r\n\t * Adds each scalar from the specified object as actions for this model.\r\n\t * @param obj \r\n\t */\r\n\tprotected addActionsFromObject(obj: any) {\r\n\t\tScalar.addScalarsFromObjectToArray(obj, this.actions);\r\n\t}\r\n\r\n\tprotected addParam(scalar: Scalar) : Scalar {\r\n\t\tthis.paramsArray.push(scalar);\r\n\t\treturn scalar;\r\n\t}\r\n\r\n\tprotected addObs(scalar: Scalar) : Scalar {\r\n\t\tthis.obsArray.push(scalar);\r\n\t\treturn scalar;\r\n\t}\r\n\r\n\tprotected addAction(scalar: Scalar) : Scalar {\r\n\t\tthis.actions.push(scalar);\r\n\t\treturn scalar;\r\n\t}\r\n}","import Scalar from '../../scalar';\r\n\r\nexport default class CartPoleObs {\r\n\tpublic readonly cartPosition = new Scalar('Cart', 'Position', 0, 'x').ranged(0.001, 1000);\r\n\tpublic readonly cartVelocity = new Scalar('Cart', 'Velocity', 0, 'v').ranged(0.001, 1000);\r\n\tpublic readonly poleAngle = new Scalar('Pole', 'Angle', 0, 'θ').ranged(-60, 60);\r\n\tpublic readonly poleVelocity = new Scalar('Pole', 'Angular Velocity', 0, 'ω').ranged(-60/0.02, 60/0.02);\r\n}","import Scalar from '../../scalar';\r\n\r\nexport default class CartPoleParams {\r\n\tpublic readonly trackLength = new Scalar('Universal', 'Track Length', 2.4).ranged(0.001, 50);\r\n\tpublic readonly gravity = new Scalar('Universal', 'Gravity', 9.68).ranged(0.001, 100);\r\n\r\n\tpublic readonly cartMass = new Scalar('Cart', 'Mass', 1).ranged(0.001, 100);\r\n\tpublic readonly cartForceLength = new Scalar('Cart', 'Force Length', 0.15).ranged(0.001, 100);\r\n\r\n\tpublic readonly poleLength = new Scalar('Pole', 'Length', 1.2).ranged(0.001, 100);\r\n\tpublic readonly poleMaxAngle = new Scalar('Pole', 'Max Angle Degrees', 45).ranged(0.001, 60);\r\n\tpublic readonly poleMass = new Scalar('Pole', 'Pole Mass', 0.1).ranged(0.001, 100);\r\n\r\n\tpublic readonly cartWidth = new Scalar('Draw', 'Cart Width', 28*3).ranged(0.001, 512);\r\n\tpublic readonly cartHeight = new Scalar('Draw', 'Cart Height', 17*3).ranged(0.001, 512);\r\n\tpublic readonly wheelRadius = new Scalar('Draw', 'Wheel Radius', 10).ranged(0.001, 128);\r\n}","import Draw from '../../../draw';\r\nimport DrawLog from '../../../draw/log';\r\nimport Scalar from '../../scalar';\r\nimport EnvironmentModel from '../environmentModel';\r\nimport CartPoleObs from './obs';\r\nimport CartPoleParams from './params';\r\nimport Color from 'src/draw/color';\r\n\r\nexport default class EnvCartPole extends EnvironmentModel {\r\n\tprivate angularAcc = 0;\r\n\tprivate cartAcc = 0;\r\n\tprivate numberOfSteps = 0;\r\n\r\n\tprivate params = new CartPoleParams();\r\n\tprivate obs = new CartPoleObs();\t\r\n\r\n\t// Actions\r\n\tprivate actionMoveDirection = new Scalar('Cart', 'Move Direction', 0).wholeNumber().ranged(0, 1);\r\n\r\n\tpublic constructor() {\r\n\t\tsuper('poleBalancing');\r\n\r\n\t\tthis.addParamsFromObject(this.params);\r\n\t\tthis.addObsFromObject(this.obs);\r\n\r\n\t\tthis.addAction(this.actionMoveDirection);\r\n\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic resetState() {\r\n\t\tthis.prepareForNewIndividual();\r\n\t}\r\n\r\n\tpublic prepareForEpoch() {\r\n\t\t// We don't really need to do anything here, but to avoid warnings...\r\n\t\tthis.numberOfSteps = 0;\r\n\t}\r\n\r\n\tpublic prepareForNewIndividual() {\r\n\t\tthis.numberOfSteps = 0;\r\n\r\n\t\tthis.cartAcc = 0;\r\n\t\tthis.angularAcc = 0;\r\n\t\tthis.obs.poleAngle.value = 0;\r\n\t\tthis.obs.poleVelocity.value = 0;\r\n\t\tthis.obs.cartPosition.value = 0;\r\n\t\tthis.obs.cartVelocity.value = 0;\r\n\t}\r\n\r\n\t// See https://pdfs.semanticscholar.org/3dd6/7d8565480ddb5f3c0b4ea6be7058e77b4172.pdf\r\n\tpublic step(delta: number) {\r\n\t\tconst moveDir = this.actionMoveDirection.value === 1 ? 1 : -1;\r\n\r\n\t\tconst Mp = this.params.poleMass.value;\r\n\t\tconst Mc = this.params.cartMass.value;\r\n\t\tconst F = moveDir * this.params.cartForceLength.value;\r\n\t\tconst l = this.params.poleLength.value;\r\n\t\tconst t2 = this.obs.poleVelocity.value * this.obs.poleVelocity.value;\r\n\t\tconst gravity = this.params.gravity.value;\r\n\r\n\t\tconst sin = Math.sin(this.obs.poleAngle.value);\r\n\t\tconst cos = Math.cos(this.obs.poleAngle.value);\r\n\t\t\r\n\t\tthis.angularAcc = (gravity * sin + cos * ((-F - Mp*l*t2*sin)/(Mc + Mp))) /\r\n\t\t\t\t\t\t  (l * (4/3 - (Mp*cos*cos/(Mc+Mp))));\r\n\t\tthis.cartAcc = (F + Mp*l*(t2*sin - this.angularAcc*cos))/(Mc + Mp);\r\n\r\n\t\tthis.obs.cartPosition.value += this.obs.cartVelocity.value * delta;\r\n\t\tthis.obs.cartVelocity.value += this.cartAcc * delta;\r\n\r\n\t\tthis.obs.poleAngle.value += this.obs.poleVelocity.value * delta;\r\n\t\tthis.obs.poleVelocity.value += this.angularAcc * delta;\r\n\r\n\t\t++this.numberOfSteps;\r\n\r\n\t\tif (this.numberOfSteps > 10000) {\r\n\t\t\tthis.hasReachedGoal = true;\r\n\t\t}\r\n\r\n\t\t// Returns true if the environment should finalize\r\n\t\t// Here, this happens when the cart position is greater than the track length\r\n\t\t// or the pole angle is greater than a pre-established limit angle.\r\n\t\treturn Math.abs(this.obs.cartPosition.value) >= this.params.trackLength.value ||\r\n\t\t\t   Math.abs(this.obs.poleAngle.value) >= (Math.PI/180) * this.params.poleMaxAngle.value;\r\n\t}\r\n\r\n\tpublic draw(context: CanvasRenderingContext2D) {\r\n\t\tDraw.context = context;\r\n\t\tDraw.clear();\r\n\r\n\t\tDrawLog.render(context);\r\n\r\n\t\t// Track length equals to 1 in normalized screen coordinates\r\n\t\t// Thus, to convert a width at our environment to a normalized screen width, we simply divide it by track length\r\n\r\n\t\tconst cartX = this.obs.cartPosition.value/this.params.trackLength.value;\r\n\r\n\t\tDraw.setLineCap('butt');\r\n\r\n\t\t// Sets translation to origin\r\n\t\tDraw.setTranslation(0, 0);\r\n\t\t\r\n\t\t// Track\r\n\t\tDraw.normX = Draw.normWidth = true;\r\n\t\tDraw.normHeight = Draw.normY = false;\r\n\r\n\t\tDraw.rectFill(0, -this.params.cartHeight.value/2 - this.params.wheelRadius.value, 1, 5, '#222222');\r\n\r\n\t\t// Cart and pole drawing\r\n\t\t// Offsets everything by the cart position\r\n\t\tDraw.normX = true;\r\n\t\tDraw.setTranslation(cartX, 0);\r\n\r\n\t\t// Cart\r\n\t\tDraw.normWidth = false;\r\n\t\tDraw.rectFill(0, 0, this.params.cartWidth.value, this.params.cartHeight.value, '#CEAA61');\r\n\r\n\t\t// Wheels\r\n\t\tDraw.normX = Draw.normY = false;\r\n\t\tDraw.arcFill((this.params.wheelRadius.value * 2 - this.params.cartWidth.value)/2 + 1, -this.params.cartHeight.value/2, this.params.wheelRadius.value, '#333333');\r\n\t\tDraw.arcFill((-this.params.wheelRadius.value * 2 + this.params.cartWidth.value)/2 - 1, -this.params.cartHeight.value/2, this.params.wheelRadius.value, '#333333');\r\n\t\r\n\t\t// Force vector\r\n\t\tDraw.normX = Draw.normY = false;\r\n\t\tDraw.normWidth = Draw.normHeight = false;\r\n\r\n\t\tconst forceDir = (this.actionMoveDirection.value === 1 ? -1 : 1);\r\n\t\tconst F = this.params.cartForceLength.value*500;\r\n\r\n\t\tDraw.setLineDash(); // Disables line dashing\r\n\t\tDraw.arrow(forceDir * (this.params.cartWidth.value/2 + F), 0, forceDir * this.params.cartWidth.value/2, 0, '#A0A0A0', 3, 8);\r\n\t\tDraw.text(forceDir * (this.params.cartWidth.value + F)/2, 8, 'F', '500 italic 19px Times New Roman', '#222222');\r\n\r\n\t\t// Normal\r\n\t\tDraw.setLineDash(4, 8);\r\n\t\tDraw.line(0, this.params.cartHeight.value/2, 0, this.params.cartHeight.value/2 + 12*4*1.5, new Color(160,160,160), 3);\r\n\r\n\t\t// Pole\r\n\t\tDraw.setLineDash(); // Disables line dashing\r\n\t\tDraw.setLineCap('round');\r\n\t\t\r\n\t\tDraw.normWidth = Draw.normHeight = true;\r\n\t\tconst poleLength = this.params.poleLength.value / this.params.trackLength.value;\r\n\t\tconst poleX = Math.cos(this.obs.poleAngle.value + Math.PI/2) * poleLength;\r\n\t\tconst poleY = Math.sin(this.obs.poleAngle.value + Math.PI/2) * poleLength;\r\n\r\n\t\tDraw.normX = true;\r\n\t\tDraw.setTranslation(cartX, this.params.cartHeight.value/2);\r\n\t\tDraw.normX = Draw.normY = true;\r\n\t\tDraw.line(0, 0, poleX, poleY, new Color(34,34,34), 3);\r\n\t\tDraw.setTranslation(cartX, 0);\r\n\r\n\t\t// Angle\r\n\t\tDraw.normWidth = Draw.normHeight = false;\r\n\t\tDraw.setLineCap('square');\r\n\t\tDraw.normX = Draw.normY = false;\r\n\t\tconst angleRadius = 48;\r\n\r\n\t\tif (this.obs.poleAngle.value > 0) {\r\n\t\t\tDraw.arcStroke(0, this.params.cartHeight.value/2, angleRadius, '#A0A0A0', 3, Math.PI*1.5 - this.obs.poleAngle.value, Math.PI*1.5);\r\n\t\t} else {\r\n\t\t\tDraw.arcStroke(0, this.params.cartHeight.value/2, angleRadius, '#A0A0A0', 3, Math.PI*1.5, Math.PI*1.5 - this.obs.poleAngle.value);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic fitness() {\r\n\t\treturn this.numberOfSteps;\r\n\t}\r\n}","import Scalar from '../../scalar';\r\n\r\nexport default class BirdGameObs {\r\n\tpublic readonly deltaX = new Scalar('Bird', 'Delta X', 0, 'Δx').ranged(-1, 1);\r\n\tpublic readonly deltaY = new Scalar('Bird', 'Delta Y', 0, 'Δy').ranged(-1, 1);\r\n}\r\n","import Scalar from '../../scalar';\r\n\r\nexport default class BirdGameParams {\r\n\tpublic readonly gameScale = new Scalar('Graphics', 'Scale', 2).ranged(1, 5);\r\n\r\n\tpublic readonly gravity = new Scalar('Physics', 'Gravity', 10).ranged(0.01, 100);\r\n\tpublic readonly birdHorizontalSpeed = new Scalar('Physics', 'Bird Horizontal Speed', 50).ranged(0.01, 100);\r\n\tpublic readonly birdFlappingSpeed = new Scalar('Physics', 'Bird Flapping Speed', 155).ranged(0.01, 1000);\r\n\r\n\tpublic readonly manualInputMode = new Scalar('Game', 'Manual Input Mode', 0).wholeNumber().ranged(0, 1);\r\n}","export default class Pipe {\r\n    public y: number = 0;\r\n    public x: number = 0;\r\n    public opening: number = 20;\r\n}","export default class Point {\r\n    public x: number;\r\n    public y: number;\r\n\r\n    public constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}","import Point from \"./point\";\r\n\r\nexport default class Polygon {\r\n\tpublic static fromRectangle(x: number, y: number, w: number, h: number, angle: number): Polygon {\r\n        const c = Math.cos(angle)/2;\r\n        const s = Math.sin(angle)/2;\r\n\r\n        const x0 = x + w/2;\r\n        const y0 = y + h/2;\r\n\r\n        const cw = c * w;\r\n        const sh = s * h;\r\n        \r\n        const ch = c * h;\r\n        const sw = s * w;\r\n\r\n        return new Polygon([ new Point(x0 + sh - cw, y0 + -ch - sw), new Point(x0 + sh + cw, y0 + -ch + sw), new Point(x0 + -sh + cw, y0 + ch + sw), new Point(x0 - sh - cw, y0 + ch - sw) ]);\r\n    }\r\n\t\r\n\tpublic points: Point[];\r\n\r\n\tpublic constructor(points: Point[]) {\r\n\t\tthis.points = points;\r\n\t}\r\n\r\n    public draw(context: CanvasRenderingContext2D) {\r\n        context.beginPath();\r\n        context.moveTo(this.points[0].x*2 + 194, this.points[0].y*2 + 140);\r\n        \r\n        for (let i = 1; i < this.points.length; ++i) {\r\n            context.lineTo(this.points[i].x*2 + 194, this.points[i].y*2 + 140);\r\n        }\r\n        \r\n        context.closePath();\r\n        context.fillStyle = \"red\";\r\n        context.fill();\r\n    }\r\n\r\n\t/**\r\n\t * Determines whether there is an intersection between two polygons. Uses the Separating Axis Theorem.\r\n\t * Adapted from https://stackoverflow.com/questions/10962379/how-to-check-intersection-between-2-rotated-rectangles.\r\n\t * \r\n\t * @param other a polygon to compare with\r\n\t * @return\r\n\t */\r\n\tpublic isIntersecting(other: Polygon): boolean {\r\n\t\tconst polygons: Array<ReadonlyArray<Point>> = [ this.points, other.points ];\r\n\r\n\t\tconst pointsFirst: ReadonlyArray<Point> = polygons[0];\r\n\t\tconst pointsSecond: ReadonlyArray<Point> = polygons[1];\r\n\r\n\t\tlet minA: number | undefined;\r\n\t\tlet maxA: number | undefined;\r\n\t\tlet projected: number | undefined;\r\n\t\tlet minB: number | undefined;\r\n\t\tlet maxB: number | undefined;\r\n\r\n\t\tfor (const polygon of polygons) {\r\n\t\t\t// For each polygon, look at each edge of the polygon, and determine if it separates the two shapes\r\n\t\t\tfor (let i1 = 0; i1 < polygon.length; i1++) {\r\n\r\n\t\t\t\t// Grab 2 vertices to create an edge\r\n\t\t\t\tconst i2 = (i1 + 1) % polygon.length;\r\n\t\t\t\tconst p1 = polygon[i1];\r\n\t\t\t\tconst p2 = polygon[i2];\r\n\r\n\t\t\t\t// Find the line perpendicular to this edge\r\n\t\t\t\tconst normal = {\r\n\t\t\t\t\tx: p2.y - p1.y,\r\n\t\t\t\t\ty: p1.x - p2.x\r\n\t\t\t\t};\r\n\r\n\t\t\t\tminA = maxA = undefined;\r\n\t\t\t\t// For each vertex in the first shape, project it onto the line perpendicular to the edge\r\n\t\t\t\t// and keep track of the min and max of these values\r\n\t\t\t\tfor (const point1 of pointsFirst) {\r\n\t\t\t\t\tprojected = normal.x * point1.x + normal.y * point1.y;\r\n\r\n\t\t\t\t\tif (!minA || projected <= minA) {\r\n\t\t\t\t\t\tminA = projected;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!maxA || projected >= maxA) {\r\n\t\t\t\t\t\tmaxA = projected;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// For each vertex in the second shape, project it onto the line perpendicular to the edge\r\n\t\t\t\t// and keep track of the min and max of these values\r\n\t\t\t\tminB = maxB = undefined;\r\n\t\t\t\tfor (const point2 of pointsSecond) {\r\n\t\t\t\t\tprojected = normal.x * point2.x + normal.y * point2.y;\r\n\r\n\t\t\t\t\tif (!minB || projected <= minB) {\r\n\t\t\t\t\t\tminB = projected;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!maxB || projected >= maxB) {\r\n\t\t\t\t\t\tmaxB = projected;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If there is no overlap between the projects, the edge we are looking at separates the two\r\n\t\t\t\t// polygons, and we know there is no overlap\r\n\t\t\t\tif (maxA! <= minB! || maxB! <= minA!) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n}","import Draw from '../../../draw';\r\nimport DrawLog from '../../../draw/log';\r\nimport Scalar from '../../scalar';\r\nimport EnvironmentModel from '../environmentModel';\r\nimport BirdGameObs from './obs';\r\nimport BirdGameParams from './params';\r\nimport Pipe from './pipe';\r\nimport Polygon from './polygon';\r\n\r\n// Image imports\r\n\r\nimport pipeUpImageSrc from \"./assets/pipe-up.png\";\r\nimport pipeDownImageSrc from \"./assets/pipe-down.png\";\r\nimport backgroundImageSrc from \"./assets/background.png\";\r\nimport bird1ImageSrc from \"./assets/bird1.png\";\r\nimport bird2ImageSrc from \"./assets/bird2.png\";\r\nimport bird3ImageSrc from \"./assets/bird3.png\";\r\nimport floorImageSrc from \"./assets/floor.png\";\r\n\r\nexport default class EnvBirdGame extends EnvironmentModel {\r\n\tprivate params = new BirdGameParams();\r\n\tprivate obs = new BirdGameObs();\r\n\r\n\t/**\r\n\t * Used to calculate score\r\n\t *\r\n\t * @private\r\n\t * @type {number}\r\n\t * @memberof EnvBirdGame\r\n\t */\r\n\tprivate score: number = 0;\r\n\r\n\t/**\r\n\t * Images\r\n\t *\r\n\t * @private\r\n\t * @memberof EnvBirdGame\r\n\t */\r\n\tprivate pipeDown = new Image();\r\n\tprivate pipeUp = new Image();\r\n\tprivate bird1 = new Image();\r\n\tprivate bird2 = new Image();\r\n\tprivate bird3 = new Image();\r\n\tprivate floor = new Image();\r\n\tprivate background = new Image();\r\n\r\n\tprivate birdAnimation = [ this.bird1, this.bird2, this.bird3 ];\r\n\t\r\n\tprivate tickCounter = 0;\r\n\r\n\tprivate birdVerticalSpeed = 0;\r\n\tprivate birdLastJumpTime = 0;\r\n\tprivate birdAngle = 0;\r\n\tprivate actualBirdAngle = 0;\r\n\tprivate birdVHeight = 0;\r\n\r\n\tprivate floorX = 0;\r\n\tprivate birdY = 0;\r\n\r\n\tprivate isCollidingWithPipe = false;\r\n\r\n\tprivate pipe1 = new Pipe();\r\n\tprivate pipe2 = new Pipe();\r\n\r\n\tprivate scoreHitbox = { shape: Polygon.fromRectangle(0, 0, 1, 1, 0), hasBeenTriggered: true };\r\n\r\n\tprivate shouldJumpManual = false;\r\n\r\n\t/**\r\n\t * Actions (outputs)\r\n\t *\r\n\t * @private\r\n\t * @memberof EnvBirdGame\r\n\t */\r\n\tprivate actionShouldJump = new Scalar('Bird', 'Should Jump', 0).wholeNumber().ranged(0, 1);\r\n\r\n\tpublic constructor() {\r\n\t\tsuper('birdGame');\r\n\r\n\t\tthis.addParamsFromObject(this.params);\r\n\t\tthis.addObsFromObject(this.obs);\r\n\r\n\t\tthis.addAction(this.actionShouldJump);\r\n\r\n\t\tthis.pipeDown.src = pipeDownImageSrc;\r\n\t\tthis.pipeUp.src = pipeUpImageSrc;\r\n\t\tthis.bird1.src = bird1ImageSrc;\r\n\t\tthis.bird2.src = bird2ImageSrc;\r\n\t\tthis.bird3.src = bird3ImageSrc;\r\n\t\tthis.floor.src = floorImageSrc;\r\n\t\tthis.background.src = backgroundImageSrc;\r\n\r\n\t\twindow.onkeydown = e => {\r\n\t\t\tthis.shouldJumpManual = true;\r\n\t\t};\r\n\r\n\t\twindow.onkeyup = e => {\r\n\t\t\tthis.shouldJumpManual = false;\r\n\t\t};\r\n\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic resetState() {\r\n\t\tthis.prepareForNewIndividual();\r\n\t}\r\n\r\n\tpublic prepareForEpoch() {\r\n\t\tthis.tickCounter = 0;\r\n\t}\r\n\r\n\tpublic prepareForNewIndividual() {\r\n\t\tthis.obs.deltaX.value = 0.5;\r\n\t\tthis.obs.deltaY.value = 0.25;\r\n\t\tthis.scoreHitbox = { shape: Polygon.fromRectangle(0, 0, 1, 1, 0), hasBeenTriggered: true };\r\n\t\tthis.birdVerticalSpeed = 0;\r\n\t\tthis.birdY = 0;\r\n\t\tthis.score = 0;\r\n\t\tthis.tickCounter = 0;\r\n\t\tthis.birdAngle = 0;\r\n\t\tthis.isCollidingWithPipe = false;\r\n\t\tthis.actualBirdAngle = 0;\r\n\t\tthis.floorX = 0;\r\n\r\n\t\tthis.randomizePipe(this.pipe1);\r\n\t\tthis.randomizePipe(this.pipe2);\r\n\r\n\t\tconst pipeDistance = this.background.naturalWidth * 0.583;\r\n\r\n\t\tthis.pipe1.x = 0;\r\n\t\tthis.pipe2.x = pipeDistance;\r\n\r\n\t\tthis.pipe1.x += pipeDistance * 0.6 + (this.background.naturalWidth - 20) / 2;\r\n\t\tthis.pipe2.x += pipeDistance * 0.6 + (this.background.naturalWidth - 20) / 2;\r\n\t}\r\n\r\n\t// See https://pdfs.semanticscholar.org/3dd6/7d8565480ddb5f3c0b4ea6be7058e77b4172.pdf\r\n\tpublic step(delta: number) {\r\n\t\tthis.birdVerticalSpeed -= this.params.gravity.value * delta;\r\n\r\n\t\tthis.birdAngle = -this.birdVerticalSpeed;\r\n\t\tthis.birdAngle = Math.min(Math.PI/4, this.birdAngle);\r\n\t\tthis.birdAngle = Math.max(-Math.PI/4, this.birdAngle);\r\n\r\n\t\tthis.actualBirdAngle = this.birdAngle + Math.sin(this.tickCounter)/7;\r\n\r\n\t\tthis.birdY += this.birdVerticalSpeed;\r\n\r\n\t\tconst shouldJump = (this.actionShouldJump.value === 1 && !this.params.manualInputMode.value) || (this.params.manualInputMode.value && this.shouldJumpManual);\r\n\t\t// shouldJump = this.obs.deltaY.value < 0;// tanh(-this.obs.deltaY.value + tanh(0.003 * this.obs.deltaX.value)) >= 0 ? true : false;\r\n\r\n\t\tif (shouldJump && performance.now() - this.birdLastJumpTime >= 50) {\r\n\t\t\tthis.birdVerticalSpeed = this.params.birdFlappingSpeed.value * delta;\r\n\t\t\tthis.birdLastJumpTime = performance.now();\r\n\t\t}\r\n\r\n\t\tthis.tickCounter += delta * 10;\r\n\r\n\t\tthis.calculateObs();\r\n\r\n\t\tthis.pipe1.x -= this.params.birdHorizontalSpeed.value * delta;\r\n\t\tthis.pipe2.x -= this.params.birdHorizontalSpeed.value * delta;\r\n\t\tthis.scoreHitbox.shape.points[0].x -= this.params.birdHorizontalSpeed.value * delta;\r\n\t\tthis.scoreHitbox.shape.points[1].x -= this.params.birdHorizontalSpeed.value * delta;\r\n\t\tthis.scoreHitbox.shape.points[2].x -= this.params.birdHorizontalSpeed.value * delta;\r\n\t\tthis.scoreHitbox.shape.points[3].x -= this.params.birdHorizontalSpeed.value * delta;\r\n\r\n\t\tconst maxFloorX = this.floor.naturalWidth - this.background.naturalWidth;\r\n\r\n\t\tthis.floorX -= this.params.birdHorizontalSpeed.value * delta;\r\n\r\n\t\tif (this.floorX < 0) {\r\n\t\t\tthis.floorX = maxFloorX;\r\n\t\t}\r\n\r\n\t\tconst birdDistToGround = this.birdVHeight * this.background.naturalHeight;\r\n\r\n\t\t// Returns true if the environment should finalize\r\n\t\treturn birdDistToGround < 4 || birdDistToGround > 240 || this.isCollidingWithPipe;\r\n\t}\r\n\r\n\tpublic draw(context: CanvasRenderingContext2D) {\r\n\t\tDraw.context = context;\r\n\t\tDraw.context.imageSmoothingEnabled = false;\r\n\t\tDraw.clear();\r\n\r\n\t\tDrawLog.render(context);\r\n\r\n\t\t// Track\r\n\t\tDraw.normX = Draw.normWidth = Draw.normHeight = Draw.normY = false;\r\n\r\n\t\tconst scale = this.params.gameScale.value;\r\n\t\tconst backgroundWidth = this.background.naturalWidth * scale;\r\n\t\tconst backgroundHeight = this.background.naturalHeight * scale;\r\n\r\n\t\tDraw.setTranslation(0, 0);\r\n\r\n\t\t// Background\r\n\t\tDraw.imageScaled(this.background, 0, 0, scale);\r\n\r\n\t\tthis.drawPipe(this.pipe1);\r\n\t\tthis.drawPipe(this.pipe2);\r\n\r\n\t\t// Ground\r\n\t\tDraw.imageScaled(this.floor, this.floorX*scale - (this.floor.naturalWidth - this.background.naturalWidth)*scale/2, -(backgroundHeight)/2, scale);\r\n\r\n\t\tDraw.setTranslation(0, 0);\r\n\r\n\t\t// Bird\r\n\t\tDraw.imageScaledRotated(this.birdAnimation[Math.round(this.tickCounter) % 3], -20 * scale, this.birdY * scale, scale, this.actualBirdAngle);\r\n\r\n\t\t// Clips everything to the background\r\n\t\tDraw.rectClear(backgroundWidth, 0, backgroundWidth, backgroundHeight*2);\r\n\t\tDraw.rectClear(-backgroundWidth, 0, backgroundWidth, backgroundHeight*2);\r\n\t\tDraw.rectClear(0, backgroundHeight, backgroundWidth*2, backgroundHeight);\r\n\t\tDraw.rectClear(0, -backgroundHeight, backgroundWidth*2, backgroundHeight);\r\n\r\n\t\tDraw.text(-2, (this.background.naturalHeight*scale - 100)/2 + 1, this.score + \"\", \"22px 'Press Start 2P', cursive\", \"black\", \"center\");\r\n\t\tDraw.text(0, (this.background.naturalHeight*scale - 100)/2, this.score + \"\", \"20px 'Press Start 2P', cursive\", \"white\", \"center\");\r\n\r\n\t\tthis.calculateObs();\r\n\t}\r\n\r\n\tpublic fitness() {\r\n\t\treturn this.score + this.tickCounter / 100;\r\n\t}\r\n\r\n\tprivate calculateObs() {\r\n\t\tif (!Draw.context) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst birdX = this.background.naturalWidth/2 - 20;\r\n\t\tconst birdY = this.background.naturalHeight/2 - this.birdY;\r\n\r\n\t\tconst birdPolygon = Polygon.fromRectangle(birdX - 4, birdY - 4, this.bird1.naturalWidth - 6, this.bird1.naturalHeight - 4, this.actualBirdAngle);\r\n\r\n\t\t// Score increaser\r\n\t\tif (birdPolygon.isIntersecting(this.scoreHitbox.shape)) {\r\n\t\t\tif (!this.scoreHitbox.hasBeenTriggered) {\r\n\t\t\t\tthis.score += 1;\r\n\t\t\t\tthis.scoreHitbox.hasBeenTriggered = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.pipe1.x > birdX && this.scoreHitbox.hasBeenTriggered) {\r\n\t\t\tthis.scoreHitbox.shape = Polygon.fromRectangle(this.pipe1.x + (this.pipeDown.naturalWidth - 4) / 2, this.pipe1.y + this.pipeDown.naturalHeight, 4, this.pipe1.opening, 0);\r\n\t\t\tthis.scoreHitbox.hasBeenTriggered = false;\r\n\t\t}\r\n\r\n\t\tif (this.pipe2.x > birdX && (this.pipe2.x < this.pipe1.x || this.pipe1.x < birdX) && this.scoreHitbox.hasBeenTriggered) {\r\n\t\t\tthis.scoreHitbox.shape = Polygon.fromRectangle(this.pipe2.x + (this.pipeDown.naturalWidth - 4) / 2, this.pipe2.y + this.pipeDown.naturalHeight, 4, this.pipe2.opening, 0);\r\n\t\t\tthis.scoreHitbox.hasBeenTriggered = false;\r\n\t\t}\r\n\r\n\t\tif (this.pipe1.x + this.pipeDown.naturalWidth > birdX) {\r\n\t\t\tthis.obs.deltaX.value = (this.pipe1.x - birdX + this.pipeDown.naturalWidth/2) / this.background.naturalWidth;\r\n\t\t\tthis.obs.deltaY.value = (this.pipe1.y + this.pipeDown.naturalHeight + this.pipe1.opening / 2 - birdY) / this.background.naturalHeight;\r\n\t\t}\r\n\r\n\t\tif (this.pipe2.x + this.pipeDown.naturalWidth > birdX && (this.pipe2.x < this.pipe1.x || this.pipe1.x + this.pipeDown.naturalWidth < birdX)) {\r\n\t\t\tthis.obs.deltaX.value = (this.pipe2.x - birdX + this.pipeDown.naturalWidth/2) / this.background.naturalWidth;\r\n\t\t\tthis.obs.deltaY.value = (this.pipe2.y + this.pipeDown.naturalHeight + this.pipe2.opening / 2 - birdY) / this.background.naturalHeight;\r\n\t\t}\r\n\r\n\t\tthis.isCollidingWithPipe = this.checkCollisionWithPipe(birdPolygon, this.pipe1) || this.checkCollisionWithPipe(birdPolygon, this.pipe2);\r\n\t\t\r\n\t\tthis.birdVHeight = 0.5 + (this.birdY - this.floor.naturalHeight/2)/this.background.naturalHeight;\r\n\t}\r\n\r\n\tprivate checkCollisionWithPipe(birdPolygon: Polygon, pipe: Pipe): boolean {\r\n\t\tconst pipeDownPolygon = Polygon.fromRectangle(pipe.x, pipe.y, this.pipeDown.naturalWidth, this.pipeDown.naturalHeight, 0);\r\n\t\tconst pipeUpPolygon = Polygon.fromRectangle(pipe.x, pipe.y + this.pipeDown.naturalHeight + pipe.opening, this.pipeUp.naturalWidth, this.pipeUp.naturalHeight, 0);\r\n\r\n\t\treturn birdPolygon.isIntersecting(pipeDownPolygon) || birdPolygon.isIntersecting(pipeUpPolygon);\r\n\t}\r\n\r\n\tprivate randomizePipe(pipe: Pipe) {\r\n\t\tpipe.x = this.background.naturalWidth;\r\n\t\tpipe.y = -Math.random() * (this.pipeDown.naturalHeight - 20);\r\n\t\tpipe.opening = Math.random() * 30 + 54;\r\n\t}\r\n\r\n\tprivate drawPipe(pipe: Pipe) {\r\n\t\tif (pipe.x < -this.pipeDown.naturalWidth) {\r\n\t\t\tthis.randomizePipe(pipe);\r\n\t\t}\r\n\r\n\t\t// Pipes\r\n\t\tconst scale = this.params.gameScale.value;\r\n\t\tconst pipeHeight = this.pipeDown.naturalHeight;\r\n\t\t\r\n\t\tconst backgroundOffsetX = (Draw.width() - this.background.naturalWidth*scale) / 2;\r\n\t\tconst backgroundOffsetY = (Draw.height() - this.background.naturalHeight*scale) / 2;\r\n\t\tDraw.context!.drawImage(this.pipeDown, pipe.x*scale + backgroundOffsetX, pipe.y * scale + backgroundOffsetY, this.pipeDown.naturalWidth * scale, this.pipeDown.naturalHeight * scale);\r\n\t\tDraw.context!.drawImage(this.pipeUp, pipe.x*scale + backgroundOffsetX, (pipe.y + pipe.opening + pipeHeight) * scale + backgroundOffsetY, this.pipeDown.naturalWidth * scale, this.pipeDown.naturalHeight * scale);\r\n\t}\r\n}","import Scalar from \"../../scalar\";\r\n\r\nexport default class NESParams {\r\n    public readonly screenScale = new Scalar(\"Screen\", \"Scale\", 2).wholeNumber().ranged(1, 5);\r\n    public readonly disableGraphics = new Scalar(\"Screen\", \"Disable Graphics\", 0).wholeNumber().ranged(0, 1);\r\n\r\n    public readonly fitnessXWeight = new Scalar(\"Fitness\", \"X Distance\", 1).ranged(0.001, 100);\r\n    public readonly fitnessSpeedWeight = new Scalar(\"Fitness\", \"Speed\", 0.1).ranged(0.001, 100);\r\n\r\n    public readonly maxFramesStuck = new Scalar(\"Stop Conditions\", \"Max frames stuck\", 200).wholeNumber().ranged(2, 120);\r\n\r\n    /**\r\n     * Number of times to repeat the stage\r\n     */\r\n    public readonly repeatStageCount = new Scalar(\"Stop Conditions\", \"Stage repeat count\", 4).wholeNumber().ranged(0, 20);\r\n\r\n    public readonly visionBoxRight = new Scalar(\"Inputs\", \"Vision Distance\", 7).wholeNumber().ranged(1, 7);\r\n    public readonly visionBoxLeft = new Scalar(\"Inputs\", \"Vision Distance\", 1).wholeNumber().ranged(1, 7);\r\n    public readonly visionBoxTop = new Scalar(\"Inputs\", \"Vision Distance\", 3).wholeNumber().ranged(1, 7);\r\n    public readonly visionBoxBottom = new Scalar(\"Inputs\", \"Vision Distance\", 4).wholeNumber().ranged(1, 7);\r\n    \r\n    public readonly normalJumpTicks = new Scalar(\"Inputs\", \"Normal Jump Ticks\", 9).wholeNumber().ranged(2, 120);\r\n    public readonly longJumpTicks = new Scalar(\"Inputs\", \"Long Jump Ticks\", 24).wholeNumber().ranged(2, 120);\r\n}","import * as JsNES from \"jsnes\";\r\n\r\n// a set of state values indicating that Mario is \"busy\"\r\nconst BUSY_STATES = [0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x07];\r\n\r\n// RAM addresses for enemy types on the screen\r\nconst ENEMY_TYPE_ADDRESSES = [0x0016, 0x0017, 0x0018, 0x0019, 0x001A];\r\n\r\nconst STAGE_OVER_ENEMIES = [0x2D, 0x31];\r\n\r\nexport default class RAMGetter {\r\n    public nes: JsNES.NES;\r\n\r\n    public constructor(nes: JsNES.NES) {\r\n        this.nes = nes;\r\n    }\r\n\r\n    public time() {\r\n        return this.nes.cpu.mem[0x07f8] * 100 + this.nes.cpu.mem[0x07f9] * 10 + this.nes.cpu.mem[0x07FA];\r\n    }\r\n\r\n    /**\r\n     * Returns the number of remaining lives.\r\n     */\r\n    public lifes() {\r\n        return this.nes.cpu.mem[0x075A];\r\n    }\r\n\r\n    /**\r\n     * Return the current horizontal position.\r\n     */\r\n    public xPosition() {\r\n        // add the current page 0x6d to the current x\r\n        return this.nes.cpu.mem[0x6d] * 0x100 + this.nes.cpu.mem[0x86];\r\n    }\r\n\r\n    /**\r\n     * Return the number of pixels from the left of the screen.\r\n     */\r\n    public leftXPosition() {\r\n        // subtract the left x position 0x071c from the current x 0x86\r\n        return (this.nes.cpu.mem[0x86] - this.nes.cpu.mem[0x071c]) % 256;\r\n    }\r\n\r\n    /**\r\n     * Return the current vertical position.\r\n     */\r\n    public yPixel() {\r\n        return this.nes.cpu.mem[0x03b8];\r\n    }\r\n\r\n    /**\r\n     * Returns the current y viewport.\r\n     * Note:\r\n     *    1 = in visible viewport\r\n     *    0 = above viewport\r\n     *    > 1 below viewport (i.e. dead, falling down a hole)\r\n     *    up to 5 indicates falling into a hole\r\n     */\r\n    public yViewport() {\r\n        return this.nes.cpu.mem[0x00b5];\r\n    }\r\n\r\n    /**\r\n     * Returns the current vertical position.\r\n     */\r\n    public yPosition() {\r\n        // check if Mario is above the viewport (the score board area)\r\n        if (this.yViewport() < 1) {\r\n            // y position overflows so we start from 255 and add the offset\r\n            return 255 + (255 - this.yPixel());\r\n        }\r\n\r\n        // Inverts the y pixel into the distance from the bottom of the screen\r\n        return 255 - this.yPixel();\r\n    }\r\n\r\n    public playerState() {\r\n        /**\r\n         * Returns the current player state.\r\n         * Note:\r\n         *    0x00 : Leftmost of screen\r\n         *    0x01 : Climbing vine\r\n         *    0x02 : Entering reversed-L pipe\r\n         *    0x03 : Going down a pipe\r\n         *    0x04 : Auto-walk\r\n         *    0x05 : Auto-walk\r\n         *    0x06 : Dead\r\n         *    0x07 : Entering area\r\n         *    0x08 : Normal\r\n         *    0x09 : Cannot move\r\n         *    0x0B : Dying\r\n         *    0x0C : Palette cycling, can't move\r\n         */\r\n        return this.nes.cpu.mem[0x000e];\r\n    }\r\n\r\n    /**\r\n     * Return True if Mario is in dying animation, False otherwise.\r\n     */\r\n    public isDying() {\r\n        return this.playerState() === 0x0b || this.yViewport() > 1;\r\n    }\r\n\r\n    /**\r\n     * Return True if Mario is dead, False otherwise.\r\n     */\r\n    public isDead() {\r\n        return this.playerState() === 0x06;\r\n    }\r\n\r\n    /**\r\n     * Returns True if the game has ended, False otherwise.\r\n     */\r\n    public isGameOver() {\r\n        // the life counter will get set to 255 (0xff) when there are no lives\r\n        // left. It goes 2, 1, 0 for the 3 lives of the game\r\n        return this.lifes() === 0xff;\r\n    }\r\n\r\n    /**\r\n     * Returns boolean whether Mario is busy with in-game garbage.\r\n     */\r\n    public isBusy() {\r\n        return BUSY_STATES.includes(this.playerState());\r\n    }\r\n\r\n    /**\r\n     * Returns a boolean determining if the world is over.\r\n     */\r\n    public isWorldOver() {\r\n        // 0x0770 contains GamePlay mode:\r\n        // 0 => Demo\r\n        // 1 => Standard\r\n        // 2 => End of world\r\n        return this.nes.cpu.mem[0x0770] === 2;\r\n    }\r\n\r\n    /**\r\n     * Return a boolean determining if the level is over.\r\n     */\r\n    public isStageOver() {\r\n        // iterate over the memory addresses that hold enemy types\r\n        for (const address of ENEMY_TYPE_ADDRESSES) {\r\n            // check if the byte is either Bowser (0x2D) or a flag (0x31)\r\n            // this is to prevent returning true when Mario is using a vine\r\n            // which will set the byte at 0x001D to 3\r\n            if (STAGE_OVER_ENEMIES.includes(this.nes.cpu.mem[address])) {\r\n                // player float state set to 3 when sliding down flag pole\r\n                return this.nes.cpu.mem[0x001D] === 3;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Returns a boolean determining if the agent has reached the flag.\r\n     */\r\n    public hasReachedFlag() {\r\n        return this.isWorldOver() || this.isStageOver();\r\n    }\r\n}","import * as JsNES from \"jsnes\";\r\nimport RAMGetter from \"./ramGetter\";\r\n\r\nexport default class RAMSetter {\r\n    public memGet: RAMGetter;\r\n    public nes: JsNES.NES;\r\n\r\n    constructor(nes: JsNES.NES, memGet: RAMGetter) {\r\n        this.nes = nes;\r\n        this.memGet = memGet;\r\n    }\r\n\r\n    public resetButtons() {\r\n        const BUTTON_COUNT = 8;\r\n\r\n        for (let i = 0; i < BUTTON_COUNT; ++i) { \r\n            this.nes.buttonUp(1, i);\r\n        }\r\n    }\r\n\r\n    public frameAdvance(button?: number) {\r\n        this.resetButtons();\r\n\r\n        if (button !== undefined) {        \r\n            this.nes.buttonDown(1, button);\r\n        }\r\n        \r\n        this.nes.frame();\r\n        \r\n        if (button !== undefined) {\r\n            this.nes.buttonUp(1, button);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Write the stage data to RAM to overwrite loading the next stage.\r\n     */\r\n    public writeStage(world, level) {\r\n        this.nes.cpu.mem[0x075f] = world;\r\n        this.nes.cpu.mem[0x075c] = level;\r\n        this.nes.cpu.mem[0x0760] = level;\r\n    }\r\n\r\n    /**\r\n     * Force the pre-level timer to 0 to skip frames during a death.\r\n     */\r\n    public runoutPrelevelTimer() {\r\n        this.nes.cpu.mem[0x07A0] = 0;\r\n    }\r\n\r\n    public skipChangeArea() {\r\n        // Skips change area animations by running down timers.\r\n        const changeAreaTimer = this.nes.cpu.mem[0x06DE];\r\n\r\n        if (changeAreaTimer > 1 && changeAreaTimer < 255) {\r\n            this.nes.cpu.mem[0x06DE] = 1;\r\n        }\r\n    }\r\n\r\n    public skipOccupiedStates() {\r\n        // Skip occupied states by running out a timer and skipping frames.\r\n        while (this.memGet.isBusy() || this.memGet.isWorldOver()) {\r\n            this.runoutPrelevelTimer();\r\n            this.frameAdvance();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Press and release start to skip the start screen.\r\n     */\r\n    public skipStartScreen(world, stage) {        \r\n        // Press start until the game starts\r\n        do {\r\n            this.writeStage(world, stage);\r\n\r\n            this.frameAdvance(JsNES.Controller.BUTTON_START);\r\n            this.nes.frame();\r\n\r\n            this.writeStage(world, stage);\r\n\r\n            this.runoutPrelevelTimer();\r\n\r\n            this.writeStage(world, stage);\r\n        } while (this.memGet.time() === 0 || this.memGet.time() === 401);\r\n\r\n        // set the last time to now\r\n        let lastTime = this.memGet.time();\r\n        \r\n        // after the start screen idle to skip some extra frames\r\n        while (this.memGet.time() >= lastTime) {\r\n            this.writeStage(world, stage);\r\n\r\n            lastTime = this.memGet.time();\r\n            this.frameAdvance(JsNES.Controller.BUTTON_START);\r\n            this.nes.frame();\r\n\r\n            this.writeStage(world, stage);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Skips the cutscene that plays at the end of a world.\r\n     */\r\n    public skipEndOfWorld() {\r\n        if (this.memGet.isWorldOver()) {\r\n            // Gets the current game time to reference\r\n            const previousTime = this.memGet.time();\r\n            \r\n            // Loops until the time is different\r\n            while (this.memGet.time() === previousTime) {\r\n                // frame advance with NOP\r\n                this.frameAdvance();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Skip a death animation by forcing Mario to death.\r\n     */\r\n    public killMario() {\r\n        // force Mario's state to dead\r\n        this.nes.cpu.mem[0x000e] = 0x06;\r\n        // step forward one frame\r\n        this.frameAdvance();\r\n    }\r\n}","import * as JsNES from \"jsnes\";\r\nimport RAMGetter from \"./ramGetter\";\r\nimport RAMSetter from \"./ramSetter\";\r\n\r\nexport default class EmuManager {\r\n    public world: number;\r\n    public stage: number;\r\n    \r\n    public nes: JsNES.NES;\r\n\r\n    public memGet: RAMGetter;\r\n    public memSet: RAMSetter;\r\n\r\n    constructor(nes: JsNES.NES, world: number, stage: number) {\r\n        this.nes = nes;\r\n        this.world = world;\r\n        this.stage = stage;\r\n        this.memGet = new RAMGetter(nes);\r\n        this.memSet = new RAMSetter(this.nes, this.memGet);\r\n    }\r\n\r\n    /**\r\n     * Handles any RAM hacking after a step occurs.\r\n     */\r\n    public step() : number {\r\n        if (this.memGet.hasReachedFlag()) {\r\n            return 2;\r\n        }\r\n\r\n        const isDone = this.isDone();\r\n\r\n        // if mario is dying, then cut to the chase and kill him\r\n        if (this.memGet.isDying()) {\r\n            this.memSet.killMario();\r\n        }\r\n        \r\n        this.memSet.skipEndOfWorld();\r\n\r\n        // skip area change (i.e. enter pipe, flag get, etc.)\r\n        this.memSet.skipChangeArea();\r\n        \r\n        // skips occupied states like the black screen between lives that shows\r\n        // how many lives the player has left\r\n        this.memSet.skipOccupiedStates();\r\n        \r\n        return isDone ? 1 : 0;\r\n    }\r\n\r\n    public isDone() {\r\n        return this.memGet.isDying() || this.memGet.isDead();\r\n    }\r\n}\r\n ","import Draw from '../../../draw';\r\nimport Scalar from '../../scalar';\r\nimport EnvironmentModel from '../environmentModel';\r\nimport NESParams from './params';\r\nimport * as JsNES from \"jsnes\";\r\nimport EmuManager from \"./emuManager\";\r\nimport Point from '../birdGame/point';\r\nimport Helper from 'src/rl/agents/neat/utils/helper';\r\n\r\nconst SCREEN_WIDTH = 256;\r\nconst SCREEN_HEIGHT = 240;\r\nconst ENEMY_COUNT = 5;\r\n\r\nexport default class EnvNES extends EnvironmentModel {\r\n    public nes: JsNES.NES;\r\n\r\n    private params = new NESParams();\r\n    private world = 1;\r\n    private level = 1;\r\n    private marioX: number = 0;\r\n    private previousMarioX: number = 0;\r\n    private numberOfFramesStuck: number = 0;\r\n    private marioY: number = 0;\r\n    private tiles: number[];\r\n    private sprites: Point[];\r\n    private maxTime: number = 300;\r\n    private stageIndex = 0;\r\n    private repeatCount = 0;\r\n\r\n    // Maximum mario x for current genome\r\n    private maxMarioX: number = 0;\r\n\r\n    /**\r\n     * Fitness accumulated from other levels\r\n     *\r\n     * @private\r\n     * @memberof EnvNES\r\n     */\r\n    private baseFitness = 0;\r\n\r\n    private readonly trainingStages = [  [1, 3] ];\r\n\r\n    private jumpCounter = 0;\r\n    private longJumpCounter = 0;\r\n\r\n    // Emulator-related variables\r\n\r\n    private emuManager?: EmuManager;\r\n    private buf: ArrayBuffer | undefined = undefined;\r\n    private buf8: Uint8ClampedArray | undefined = undefined;\r\n    private buf32: Uint32Array | undefined = undefined;\r\n    private imageData: ImageData | undefined = undefined;\r\n\r\n    // Emulator-related flags\r\n    private hasInitGraphics = false;\r\n    private hasDownloadedROM = false;\r\n    private isFreshROM = true;\r\n    private shouldStartEvaluation = false;\r\n\r\n    // Actions\r\n    private actionJump = new Scalar(\"NES Controller\", \"Jump (A)\", 0).wholeNumber().ranged(0, 1);\r\n    private actionJumpLong = new Scalar(\"NES Controller\", \"Long Jump (A)\", 0).wholeNumber().ranged(0, 1);\r\n    private actionRight = new Scalar(\"NES Controller\", \"Go Right (RIGHT)\", 0).wholeNumber().ranged(0, 1);\r\n    private actionRun = new Scalar(\"NES Controller\", \"Run (B)\", 0).wholeNumber().ranged(0, 1);\r\n    private actionLeft = new Scalar(\"NES Controller\", \"Go Left (LEFT)\", 0).wholeNumber().ranged(0, 1);\r\n\r\n    public constructor() {\r\n        super('nes');\r\n\r\n        // Initializes our level data\r\n        this.tiles = Array(this.visionBoxArea());\r\n        this.sprites = Array(ENEMY_COUNT);\r\n\r\n        for (let i = 0; i < ENEMY_COUNT; ++i) {\r\n            this.sprites[i] = new Point(10000, 10000);\r\n        }\r\n\r\n        this.addParamsFromObject(this.params);\r\n\r\n        // this.addObsFromObject(this.obs);\r\n        // Instead of having an object that holds our obs, we simply add them directly\r\n\r\n        for (let i = 0; i < this.tiles.length; ++i) {\r\n            this.obsArray.push(new Scalar(\"Vision\", \"T\" + i, 0).wholeNumber().ranged(-1, 1));\r\n        }\r\n\r\n        // As of now, only jump and long jump are enabled\r\n        this.addAction(this.actionJump);\r\n        this.addAction(this.actionJumpLong);\r\n        this.addAction(this.actionRight);\r\n        this.addAction(this.actionRun);\r\n        this.addAction(this.actionLeft);\r\n\r\n        this.nes = new JsNES.NES({\r\n            onFrame: this.setBuffer,\r\n            audioEmulation: false\r\n        });\r\n\r\n        const request = new XMLHttpRequest();\r\n        request.open(\"GET\", \"/Super Mario Bros (E).nes\");\r\n        request.overrideMimeType('text/plain; charset=x-user-defined');\r\n        \r\n        request.onload = () => {\r\n            this.nes.loadROM(request.response);\r\n            this.emuManager = new EmuManager(this.nes, 0, 0);\r\n            this.isFreshROM = true;\r\n            this.hasDownloadedROM = true;\r\n\r\n            this.resetEmu();\r\n        };\r\n\r\n        request.send(null);\r\n\r\n        window.onkeydown = e => {               \r\n            if (e.keyCode === 68) {\r\n                this.nes.buttonDown(1, JsNES.Controller.BUTTON_RIGHT);\r\n            }\r\n\r\n            if (e.keyCode === 75) {\r\n                this.actionJumpLong.value = 1;\r\n            }\r\n\r\n            if (e.keyCode === 74) {\r\n                this.actionJump.value = 1;\r\n            }\r\n        };\r\n\r\n        window.onkeyup = e => { \r\n            if (e.keyCode === 68) {\r\n                this.nes.buttonUp(1, JsNES.Controller.BUTTON_RIGHT);\r\n            }\r\n\r\n            if (e.keyCode === 75) {\r\n                this.actionJumpLong.value = 0;\r\n            }\r\n\r\n            if (e.keyCode === 74) {\r\n                this.actionJump.value = 0;\r\n            }\r\n        };\r\n\r\n        this.prepareForEpoch();\r\n    }\r\n\r\n    public resetEmu() {\r\n        if (!this.hasDownloadedROM || !this.emuManager) {\r\n            return;\r\n        }\r\n\r\n        if (!this.isFreshROM) {\r\n            this.nes.reloadROM();\r\n        }\r\n\r\n        this.nes.frame();\r\n\r\n        this.emuManager.memSet.skipStartScreen(this.world - 1, this.level - 1);\r\n\r\n        this.maxTime = this.emuManager.memGet.time();\r\n\r\n        this.isFreshROM = false;\r\n        this.shouldStartEvaluation = true;\r\n    }\r\n\r\n    public prepareForEpoch() {\r\n        Helper.shuffle(this.trainingStages);\r\n\t}\r\n\r\n    public resetState() {\r\n        this.prepareForNewIndividual();\r\n    }\r\n\r\n    public updateStage() {\r\n        const selectedStage = this.trainingStages[this.stageIndex];\r\n        \r\n        this.world = selectedStage[0];\r\n        this.level = selectedStage[1];\r\n    }\r\n\r\n    public prepareForNewIndividual() {\r\n        this.updateStage();\r\n        this.resetEmu();\r\n\r\n        this.tiles = Array(this.visionBoxArea());\r\n        this.sprites = Array(ENEMY_COUNT);\r\n\r\n        for (let i = 0; i < ENEMY_COUNT; ++i) {\r\n            this.sprites[i] = new Point(10000, 10000);\r\n        }\r\n\r\n        this.repeatCount = 0;\r\n        this.numberOfFramesStuck = 0;\r\n        this.jumpCounter = 0;\r\n        this.longJumpCounter = 0;\r\n        this.stageIndex = 0;\r\n        this.baseFitness = 0;\r\n        this.maxMarioX = 0;\r\n    }\r\n\r\n    public processAction(action: Scalar, button: number) {\r\n        if (action.value > 0) {\r\n            this.nes.buttonDown(1, button);\r\n        } else {\r\n            this.nes.buttonUp(1, button);\r\n        }\r\n    }\r\n\r\n    public step(delta: number) {\r\n        if (!this.emuManager) {\r\n            return false;\r\n        }\r\n\r\n        if (this.shouldStartEvaluation) {           \r\n            // Gets the previous mario x to determine if the agent is stuck\r\n            this.previousMarioX = this.marioX;\r\n            \r\n            // Gets mario's position\r\n            this.marioX = this.emuManager.memGet.xPosition();\r\n            this.marioY = this.emuManager.memGet.yPixel() + 32;\r\n\r\n            if (this.marioX <= this.maxMarioX) {\r\n                this.numberOfFramesStuck += 1;\r\n            } else {\r\n                this.numberOfFramesStuck = 0;\r\n            }\r\n\r\n            if (this.marioX > this.maxMarioX) {\r\n                this.maxMarioX = this.marioX;\r\n            }\r\n\r\n            // Stops the evaluation if mario is stuck\r\n            if (this.numberOfFramesStuck >= this.params.maxFramesStuck.value) {\r\n                return true;\r\n            }\r\n\r\n            // Process the actions from the agent\r\n\r\n            // Jump action\r\n            if (this.actionJump.value > 0 || this.jumpCounter > 0) {\r\n                this.jumpCounter += 1;\r\n                this.nes.buttonDown(1, JsNES.Controller.BUTTON_A);\r\n            }\r\n\r\n            if (this.jumpCounter >= this.params.normalJumpTicks.value) {\r\n                this.jumpCounter = 0;\r\n                this.nes.buttonUp(1, JsNES.Controller.BUTTON_A);\r\n            }\r\n\r\n            // Long jump action\r\n            if (this.actionJumpLong.value > 0 || this.longJumpCounter > 0) {\r\n                this.longJumpCounter += 1;\r\n                this.nes.buttonDown(1, JsNES.Controller.BUTTON_A);\r\n            }\r\n\r\n            if (this.longJumpCounter >= this.params.longJumpTicks.value) {\r\n                this.longJumpCounter = 0;\r\n                this.nes.buttonUp(1, JsNES.Controller.BUTTON_A);\r\n            }\r\n\r\n            // Other actions\r\n            this.processAction(this.actionRun, JsNES.Controller.BUTTON_B);\r\n            this.processAction(this.actionRight, JsNES.Controller.BUTTON_RIGHT);\r\n            this.processAction(this.actionLeft, JsNES.Controller.BUTTON_LEFT);\r\n\r\n            this.emuManager.memSet.nes.frame();\r\n\r\n            const flag = this.emuManager.step();\r\n            \r\n            // Finished evaluation, mario died\r\n            if (flag === 1) {\r\n                this.shouldStartEvaluation = false;\r\n                return true;\r\n            }\r\n\r\n            // Finished evaluation, mario completed the level\r\n            if (flag === 2) {\r\n                let repeatCount = this.repeatCount;\r\n                \r\n                if (repeatCount + 1 > this.params.repeatStageCount.value) {\r\n                    this.stageIndex += 1;\r\n                    repeatCount = -1;\r\n                }\r\n                \r\n                if (this.stageIndex > this.trainingStages.length - 1) {\r\n                    this.hasReachedGoal = true;\r\n                    return false;   \r\n                }\r\n\r\n                const baseFitness = this.fitness();\r\n                const fileName = \"completed_\" + this.world + \"-\" + this.level + \"_\" + this.repeatCount + \".genome\";\r\n\r\n                // Forcely prepares for a new individual without actually changing the individual.\r\n                // The preparation resets our state and sets the emulator's stage.\r\n                this.prepareForNewIndividual();\r\n\r\n                this.repeatCount = repeatCount + 1;\r\n\r\n                // Saves the genome that successfully advanced a level\r\n                this.baseFitness = baseFitness;\r\n                this.requestSave(fileName);\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public draw(context: CanvasRenderingContext2D) {\r\n        Draw.context = context;\r\n        Draw.clear();\r\n\r\n        if (this.hasDownloadedROM) {\r\n            if (this.hasInitGraphics && !this.params.disableGraphics.value) {\r\n                this.imageData!.data.set(this.buf8!);\r\n\r\n                Draw.context!.putImageData(this.imageData!, 4, 32);\r\n                Draw.context!.setTransform(1, 0, 0, 1, 0, 0);\r\n            } else {\r\n                this.initNESGraphics();\r\n            }\r\n        }\r\n\r\n        if (!!this.emuManager) {\r\n            this.getInputs();\r\n        }\r\n    }\r\n\r\n    public fitness() {\r\n        if (!this.emuManager) {\r\n            return 0.0001;\r\n        }\r\n\r\n        const avgSpeed = this.marioX / Math.max(1, this.maxTime - this.emuManager.memGet.time());\r\n        const f = this.marioX * this.params.fitnessXWeight.value + avgSpeed * this.params.fitnessSpeedWeight.value + this.baseFitness;\r\n\r\n        if (f === 0) {\r\n            return 0.0001;\r\n        }\r\n\r\n        return f;\r\n    }\r\n\r\n    private getInputs() {\r\n        this.getSprites();\r\n\r\n        let i = 0;\r\n\r\n        for (let dy = -this.params.visionBoxTop.value * 16; dy <= this.params.visionBoxBottom.value * 16; dy += 16) {\r\n            for (let dx = -this.params.visionBoxLeft.value * 16; dx <= this.params.visionBoxRight.value * 16; dx += 16) {\r\n                const tile = this.getTile(dx, dy);\r\n\r\n                this.tiles[i] = (tile === 1 && this.marioY + dy < 0x1B0) ? 1 : 0;\r\n\r\n                for (const sprite of this.sprites) {\r\n                    const distx = Math.abs(sprite.x - (this.marioX + dx));\r\n                    const disty = Math.abs(sprite.y - (this.marioY + dy));\r\n                    \r\n                    if (distx <= 8 && disty <= 8) {\r\n                        this.tiles[i] = -1;\r\n                    }\r\n                }\r\n\r\n                i += 1;\r\n            }\r\n        }\r\n\r\n        const drawOffsetX = this.params.screenScale.value * SCREEN_WIDTH + 10;\r\n        const drawOffsetY = 32;\r\n        // Draws what mario sees\r\n\r\n        Draw.context!.lineWidth = 3;\r\n\r\n        const tileSize = 8 * this.params.screenScale.value;\r\n        const rowWidth = this.visionBoxWidth();\r\n\r\n        Draw.context!.lineWidth = 1;\r\n        for (let y = 0; y < this.visionBoxHeight(); ++y) {\r\n            for (let x = 0; x < rowWidth; ++x) {            \r\n                if (x === this.params.visionBoxLeft.value && y === this.params.visionBoxTop.value) {\r\n                    Draw.context!.strokeStyle = \"blue\";\r\n                } else {\r\n                    const tile = this.tiles[x + y * rowWidth];\r\n\r\n                    if (tile === 0) {\r\n                        continue;\r\n                    } else if (tile === 1) {\r\n                        Draw.context!.strokeStyle = \"black\";\r\n                    } else {\r\n                        Draw.context!.strokeStyle = \"red\";\r\n                    }\r\n                }\r\n\r\n                Draw.context!.strokeRect(drawOffsetX + x * tileSize, drawOffsetY + y * tileSize, tileSize, tileSize);\r\n            }\r\n        }\r\n\r\n        for (i = 0; i < this.tiles.length; ++i) {\r\n            this.obsArray[i].value = this.tiles[i];\r\n        }\r\n    }\r\n\r\n    private getSprites() {\r\n        for (let slot = 0; slot < this.sprites.length; ++slot) {\r\n            const enemy = this.nes.cpu.mem[0xF+slot];\r\n            \r\n            if (enemy !== 0) {\r\n                const ex = this.nes.cpu.mem[0x6E + slot] * 0x100 + this.nes.cpu.mem[0x87 + slot];\r\n                const ey = this.nes.cpu.mem[0xCF + slot] + 24;\r\n\r\n                this.sprites[slot].x = ex;\r\n                this.sprites[slot].y = ey;\r\n            }\r\n        }\r\n    }\r\n\r\n    private getTile(dx, dy) {\r\n        const x = this.marioX + dx + 8;\r\n        const y = this.marioY + dy - 16;\r\n        const page = Math.floor(x/256)%2;\r\n \r\n        const subx = Math.floor((x%256)/16);\r\n        const suby = Math.floor((y - 32)/16);\r\n        const addr = 0x500 + page*13*16 + suby*16 + subx;\r\n               \r\n        if (suby >= 13 || suby < 0) { return 0; }\r\n               \r\n        if (this.nes.cpu.mem[addr] !== 0) { return 1; }\r\n        else { return 0; }\r\n    }\r\n\r\n    private visionBoxWidth(): number {\r\n        return this.params.visionBoxLeft.value + this.params.visionBoxRight.value + 1;\r\n    }\r\n\r\n    private visionBoxHeight(): number {\r\n        return this.params.visionBoxTop.value + this.params.visionBoxBottom.value + 1;\r\n    }\r\n\r\n    private visionBoxArea(): number {\r\n        return this.visionBoxWidth() * this.visionBoxHeight();\r\n    }\r\n\r\n    private initNESGraphics() {\r\n        if (this.params.disableGraphics.value) {\r\n            return;\r\n        }\r\n\r\n        this.imageData = Draw.context!.getImageData(0, 0, SCREEN_WIDTH * this.params.screenScale.value, SCREEN_HEIGHT * this.params.screenScale.value);\r\n\r\n        Draw.context!.fillStyle = \"red\";\r\n        // set alpha to opaque\r\n        Draw.context!.fillRect(0, 0, SCREEN_WIDTH * this.params.screenScale.value, SCREEN_HEIGHT * this.params.screenScale.value);\r\n\r\n        // buffer to write on next animation frame\r\n        this.buf = new ArrayBuffer(this.imageData!.data.length);\r\n        // Get the canvas buffer in 8bit and 32bit\r\n        this.buf8 = new Uint8ClampedArray(this.buf);\r\n        this.buf32 = new Uint32Array(this.buf);\r\n\r\n        // Set alpha\r\n        for (let i = 0; i < this.buf32.length; ++i) {\r\n            this.buf32[i] = 0x0000ff00;\r\n        }\r\n\r\n        this.hasInitGraphics = true;\r\n    }\r\n\r\n    private setBuffer = (buffer) => {\r\n        if (!this.buf32 || this.params.disableGraphics.value) {\r\n            return;\r\n        }\r\n\r\n        let i = 0;\r\n        let color = 0;\r\n\r\n        for (let y = 0; y < SCREEN_HEIGHT; ++y) {\r\n            for (let x = 0; x < SCREEN_WIDTH; ++x) {\r\n                i = x + y * SCREEN_WIDTH;\r\n                color = 0xff000000 | buffer[i];\r\n\r\n                const i2 = (x + y * SCREEN_WIDTH * this.params.screenScale.value) * this.params.screenScale.value;\r\n\r\n                // Converts pixel from NES BGR to canvas ABGR\r\n                for (let j = 0; j < this.params.screenScale.value; ++j) {\r\n                    for (let k = 0; k < this.params.screenScale.value; ++k) {\r\n                        this.buf32[i2 + k * SCREEN_WIDTH * this.params.screenScale.value + j] = color;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import StringParam from \"src/rl/stringParam\";\r\n\r\nexport default class GenomeVisualizerParams {\r\n    public readonly fileInput = new StringParam(\"File\", \"Genomes\", \"__NULL__\", \"file\"); \r\n}","import Draw, { ILinkDrawData, INeuronDrawData } from '../../../draw';\r\nimport DrawLog from '../../../draw/log';\r\nimport EnvironmentModel from '../../envs/environmentModel';\r\nimport AgentModel from '../agentModel';\r\nimport Individual from '../individual';\r\nimport GenomeVisualizerParams from './params';\r\nimport Genome from '../neat/genome';\r\nimport NeuralNetwork from '../neat/neuralNetworks';\r\n\r\ninterface INetworkDrawData {\r\n\tneurons: INeuronDrawData[];\r\n\tlinks: ILinkDrawData[];\r\n}\r\n\r\nexport default class GenomeVisualizerAgent extends AgentModel {\r\n\tprivate params: GenomeVisualizerParams = new GenomeVisualizerParams();\r\n    private phenotype?: NeuralNetwork = undefined;\r\n    private currentGenome?: Genome = undefined;\r\n    private latexFormula?: string[] = undefined;\r\n    private genomeNames: string[] = [];\r\n    private genomes: Genome[] = [];\r\n\r\n\t// Used for rendering purposes\r\n\tprivate popDrawIndex: number = 0;\r\n\tprivate popDrawData: INetworkDrawData[] = [];\r\n\r\n\tpublic constructor(env: EnvironmentModel) {\r\n\t\tsuper(\"genomeVisualizer\", env);\r\n\r\n\t\tDrawLog.printToConsole = true;\r\n\r\n\t\tthis.addParamsFromObject(this.params);\r\n\r\n\t\tthis.resetState();\r\n\t}\r\n\r\n\tpublic resetState() {\r\n\t\tthis.currentGenome = undefined;\r\n\r\n\t\tthis.populationData();\r\n\t}\r\n\r\n\tpublic prepareForIndividual(individual: Individual) {\r\n\t\tconst genome = individual as Genome;\r\n\t\tthis.currentGenome = genome;\r\n        this.phenotype = genome.createPhenotype();\r\n        this.latexFormula = this.phenotype!.generateFormula(this.env.obsFormulaNames(), 2);\r\n\t\t\r\n\t\tfor (let i = 0; i < genome.outputCount; ++i) {\r\n\t\t\tconsole.log(this.env.actions[i].name, this.latexFormula[i]);\r\n\t\t}\r\n\r\n\t\t++this.popDrawIndex;\r\n\t}\r\n\r\n\tpublic goalReached() {\r\n        console.log(\"[GENOME VISUALIZER] Goal reached!\");\r\n\t}\r\n\r\n\tpublic act() {\r\n\t\tif (!this.phenotype) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet index = 0;\r\n\t\tconst outputs = this.phenotype!.activate(this.env.obsValues());\r\n\t\t\r\n\t\tfor (const s of this.env.actions) {\r\n\t\t\tlet val = 0;\r\n\r\n\t\t\tif (outputs[index] >= 0) {\r\n\t\t\t\tval = 1;\r\n\t\t\t} else {\r\n\t\t\t\tval = 0;\r\n\t\t\t}\r\n\r\n\t\t\ts.value = val;\r\n\t\t\t\t\t\t\r\n\t\t\t++index;\r\n\t\t}\r\n\t} \r\n\r\n\tpublic draw(context: CanvasRenderingContext2D) {\r\n\t\tDraw.context = context;\r\n\t\tDraw.clear();\r\n\r\n\t\tDrawLog.render(context); // Draws logs\r\n\t\t\r\n\t\tDraw.setTranslation(0, 0);\r\n\r\n\t\tDraw.normX = Draw.normY = true;\r\n\t\tDraw.normWidth = Draw.normHeight = true;\r\n\r\n\t\tif (this.popDrawIndex >= 0) {\r\n\t\t\tDraw.normX = Draw.normY = true;\r\n\t\t\tDraw.normWidth = Draw.normHeight = true;\r\n\r\n\t\t\tif (!!this.popDrawData && !!this.popDrawData[this.popDrawIndex] && !!this.popDrawData[this.popDrawIndex].neurons && !!this.phenotype) {\r\n\t\t\t\tDraw.linkShadowBlur = 0;\r\n\t\t\t\tDraw.inputNeuronShadowBlur = 10;\r\n\t\t\t\tDraw.hiddenNeuronShadowBlur = 20;\r\n\t\t\t\tDraw.outputNeuronShadowBlur = 10;\r\n\t\t\t\tDraw.inputNeuronRadius = 0.005;\r\n\t\t\t\tDraw.hiddenNeuronRadius = 0.006;\r\n\t\t\t\tDraw.outputNeuronRadius = 0.0065;\r\n\t\t\t\tDraw.linkLineWidth = 1;\r\n\t\t\t\tDraw.neuralNetwork(0, 0, 0.4, 0.95, this.popDrawData[this.popDrawIndex].neurons, this.popDrawData[this.popDrawIndex].links, this.phenotype);\r\n\t\t\t}\r\n\r\n\t\t\t// Draws genotype\r\n\t\t\t// Draw.normX = Draw.normY = false;\r\n\t\t\t// Draw.text(-Draw.width()/2 + 64, -Draw.height()/3.2, 'Genotype:', '300 21px sans-serif', 'white');\r\n\t\t\t// Draw.genome(-Draw.width()/2 + 64, -Draw.height()/2.9, this.currentGenome!, 'white');\r\n\t\t\tDraw.normX = Draw.normY = true;\r\n\r\n\t\t\t// Draws phenotype label\r\n\t\t\t// Draw.normX = false;\r\n\t\t\t// Draw.text(-Draw.width()/2 + 8, 0.44, 'Phenotype (' + this.genomeNames[this.popDrawIndex].replace(\".genome\", \"\") + '):', '300 21px sans-serif', 'white', 'left');\r\n\t\t\tDraw.normX = true;\r\n\t\t\t\r\n\t\t\t// Draws all latex formulas\r\n            /*let yOffset = 0;\r\n            if (!!this.latexFormula) {\r\n                for (const formula of this.latexFormula) {\r\n                    yOffset += 0.05;\r\n                    Draw.text(0, -0.34 - yOffset, formula, '300 19px sans-serif', 'black');\r\n                }\r\n            }*/\r\n\r\n\t\t\tconst width = 1 / this.popDrawData.length;\r\n\r\n\t\t\tfor (let i = 0; i < this.genomes.length; ++i) {\r\n\t\t\t\tif (i === this.popDrawIndex) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tDraw.neuralNetwork((i*width - 0.5) * 2 + width, -0.7, 0.125, 0.18, this.popDrawData[i].neurons, this.popDrawData[i].links, undefined);\r\n\r\n\t\t\t\tif (i < this.popDrawIndex) {\r\n\t\t\t\t\tDraw.normX = false;\r\n\t\t\t\t\tconst baseX = (i*width - 0.5) * Draw.width();\r\n\t\t\t\t\tDraw.text(baseX + 40, 0.87, String(Math.round(this.genomes[i].fitness * 100) / 100), '12px Arial', 'green');\r\n\t\t\t\t\tDraw.normX = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic loop(delta: number) {\r\n\t\tif (this.params.fileInput.values[0] !== \"__NULL__\" && this.genomes.length <= 0) {\r\n\t\t\tfor (let i = 0; i < Math.min(this.params.fileInput.values.length, this.params.fileInput.fileNames.length); ++i) {\r\n\t\t\t\tthis.genomes.push(Genome.fromJSON(this.params.fileInput.values[i]));\r\n\t\t\t\tthis.genomeNames.push(this.params.fileInput.fileNames[i]);\r\n\t\t\t}\r\n\t\t\tthis.populationData();\r\n\t\t}\r\n\r\n        if (this.genomes.length > 0) {\r\n            super.lifecycle(delta, this.genomes);\r\n        }\r\n\t}\r\n\r\n\tpublic epoch() {\r\n\t\tthis.populationData();\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the data used for drawing the neurons and genomes.\r\n\t */\r\n\tprivate populationData() {\r\n\t\tthis.popDrawIndex = -1;\r\n\t\tthis.popDrawData = [];\r\n\r\n        if (!this.genomes) {\r\n            return;\r\n        }\r\n\r\n\t\tfor (const genome of this.genomes) {\r\n\t\t\tconst linksData = genome.linkGenes.map((link) => {\r\n\t\t\t\treturn { inIndex: genome.getNeuronIndexByID(link.inNeuron.id), outIndex: genome.getNeuronIndexByID(link.outNeuron.id), isEnabled: false };\r\n\t\t\t});\r\n\r\n\t\t\tconst neuronsData = genome.neuronGenes.map((neuron) => {\r\n\t\t\t\treturn { splitX: neuron.splitX, splitY: neuron.splitY, type: neuron.type, id: neuron.id };\r\n\t\t\t});\r\n\r\n\t\t\tconst nnData = { links: linksData, neurons: neuronsData };\r\n\t\t\tthis.popDrawData.push(nnData);\r\n\t\t}\r\n\t}\r\n}\r\n","import { ICardInfo } from '../components/infoCard';\r\nimport AgentModel from '../rl/agents/agentModel';\r\nimport NEATAgent from '../rl/agents/neat';\r\nimport RandomAgent from '../rl/agents/randomAgent';\r\nimport EnvCartPole from '../rl/envs/cartPole';\r\nimport EnvBirdGame from '../rl/envs/birdGame';\r\nimport EnvNES from '../rl/envs/nes';\r\nimport EnvironmentModel from '../rl/envs/environmentModel';\r\nimport NeatSVG from './../svg/neat.svg';\r\nimport PoleBalancingSVG from './../svg/pole-balancing.svg';\r\nimport BirdGamePNG from './../png/birdGame.png';\r\nimport DiceSVG from './../svg/dice.svg';\r\nimport NESPNG from './../png/NES.png';\r\nimport GenomeVisualizerAgent from 'src/rl/agents/genomeVisualizer';\r\n\r\nexport function fetchEnvsInfo(cards: ICardInfo[]) {\r\n\tcards.push({ title: 'Pole Balancing', description: 'Click to select', imgSrc: PoleBalancingSVG, modelName: 'cartPole' });\r\n\tcards.push({ title: 'Bird Game', description: 'Click to select', imgSrc: BirdGamePNG, modelName: 'birdGame' });\r\n\tcards.push({ title: 'NES', description: 'Click to select', imgSrc: NESPNG, modelName: 'nes' });\r\n}\r\n\r\nexport function createEnv(name: string) : EnvironmentModel | undefined {\r\n\tif (name === 'cartPole') {\r\n\t\treturn new EnvCartPole();\r\n\t}\r\n\r\n\tif (name === 'birdGame') {\r\n\t\treturn new EnvBirdGame();\r\n\t}\r\n\r\n\tif (name === 'nes') {\r\n\t\treturn new EnvNES();\r\n\t}\r\n\r\n\treturn undefined;\r\n}\r\n\r\nexport function fetchAgentsInfo(cards: ICardInfo[]) {\r\n\tcards.push({ title: 'NeuroEvolution of Augmenting Topologies', description: 'Click to select', imgSrc: NeatSVG, modelName: 'neat' });\r\n\tcards.push({ title: 'Genome Visualizer Agent', description: 'Click to select', imgSrc: NeatSVG, modelName: 'genomeVisualizer' });\r\n\tcards.push({ title: 'Random Agent', description: 'Click to select', imgSrc: DiceSVG, modelName: 'randomAgent' });\r\n}\r\n\r\nexport function createAgent(name: string, env: EnvironmentModel) : AgentModel | undefined {\r\n\tif (name === 'randomAgent') {\r\n\t\treturn new RandomAgent(env);\r\n\t} else if (name === 'neat') {\r\n\t\treturn new NEATAgent(env);\r\n\t} else if (name === 'genomeVisualizer') {\r\n\t\treturn new GenomeVisualizerAgent(env);\r\n\t}\r\n\r\n\treturn undefined;\r\n}","// Material-UI\r\nimport Button from '@material-ui/core/Button';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActionArea from '@material-ui/core/CardActionArea';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport CardMedia from '@material-ui/core/CardMedia';\r\nimport Typography from '@material-ui/core/Typography';\r\n// React\r\nimport * as React from 'react';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport interface ICardInfo {\r\n\tmodelName: string; // 6-character string\r\n\ttitle: string;\r\n\tdescription: string;\r\n\timgSrc: string;\r\n}\r\n\r\nexport interface IRouteInfo {\r\n\tenvName: string;\r\n\tagentName: string;\r\n}\r\n\r\ninterface IProps {\r\n\tinfo: ICardInfo;\r\n\tenvName?: string;\r\n}\r\n\r\n/**\r\n * Displays basic information of an Agent or an Environment (title, description, image).\r\n */\r\nexport class InfoCard extends React.Component<IProps> {\r\n\tpublic render() {\r\n\t\tconst color = this.props.envName === undefined ? \"secondary\" : \"primary\";\r\n\r\n\t\treturn (\r\n\t\t\t<Card>\r\n\t\t\t\t<CardActionArea component={this.CardLink}>\r\n\t\t\t\t\t<CardMedia\r\n\t\t\t\t\tcomponent=\"img\"\r\n\t\t\t\t\tstyle={{ objectFit: \"contain\" }}\r\n\t\t\t\t\timage={this.props.info.imgSrc}\r\n\t\t\t\t\theight={180}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<CardContent>\r\n\t\t\t\t\t\t<Typography gutterBottom={true} variant=\"h5\"> {this.props.info.title} </Typography>\r\n\t\t\t\t\t\t<Typography variant=\"body1\"> {this.props.info.description} </Typography>\r\n\t\t\t\t\t</CardContent>\r\n\t\t\t\t</CardActionArea>\r\n\t\t\t\t<CardActions>\r\n\t\t\t\t\t<Button size=\"small\" color={color}>Learn more</Button>\r\n\t\t\t\t</CardActions>\r\n\t\t\t</Card>\r\n\t\t);\r\n\t}\r\n\r\n\t// If envName is defined, this card is an agent card. The link route is adjusted accordingly.\r\n\tprivate CardLink = (props: any) => <Link to={\r\n\t\tthis.props.envName === undefined ? '/' + this.props.info.modelName :\r\n\t\t'/' + this.props.envName + '/' + this.props.info.modelName\r\n\t} {...props}/>\r\n}","import Grid from '@material-ui/core/Grid';\r\nimport * as React from 'react';\r\nimport * as ModelFactory from '../routes/modelFactory';\r\nimport { ICardInfo, InfoCard } from './infoCard';\r\n\r\ninterface IProps {\r\n\tserverGetRoute: string;\r\n\tenvName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\n\r\ninterface IState {\r\n\tcards: ICardInfo[]; // List of environments\r\n\tisTransitioning: boolean;\r\n}\r\n\r\n/**\r\n * Displays a grid of InfoCards.\r\n */\r\nexport default class CardBrowser extends React.Component<IProps, IState> {\r\n\tprivate static sReactKey = 0;\r\n\tprivate static envName?: string;\r\n\r\n\t/**\r\n\t * Turns card data into html dom elements\r\n\t * @param card \r\n\t */\r\n\tprivate static mapCards(cardInfo: ICardInfo) {\r\n\t\tCardBrowser.sReactKey++;\r\n\r\n\t\treturn (\r\n\t\t\t<Grid item={true} xs={12} sm={6} md={4} lg={4} key={\"CARD_\" + CardBrowser.sReactKey}>\r\n\t\t\t\t<InfoCard envName={CardBrowser.envName} info={cardInfo}/>\r\n\t\t\t</Grid>\r\n\t\t);\r\n\t}\r\n\r\n\tpublic state: IState = {\r\n\t\tcards: [],\r\n\t\tisTransitioning: false,\r\n\t};\r\n\r\n\tpublic props: IProps;\r\n\r\n\tpublic constructor(props: IProps) {\r\n\t\tsuper(props);\r\n\t\tthis.props = props;\r\n\t\tthis.fetchDBData();\r\n\t}\r\n\r\n\tpublic render() {\r\n\t\tCardBrowser.envName = this.props.envName;\r\n\t\tconst mappedCards = this.state.cards.map(CardBrowser.mapCards);\r\n\r\n\t\treturn (\r\n\t\t\t<div style={this.props.style}>\r\n\t\t\t\t<Grid container={true} spacing={8}>\r\n\t\t\t\t\t{mappedCards}\r\n\t\t\t\t</Grid>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tprivate fetchDBData() {\r\n\t\tif (this.props.serverGetRoute === 'envsCards') {\r\n\t\t\tModelFactory.fetchEnvsInfo(this.state.cards);\r\n\t\t} else {\r\n\t\t\tModelFactory.fetchAgentsInfo(this.state.cards);\r\n\t\t}\r\n\t}\r\n}","import * as React from 'react';\r\nimport CardBrowser from '../components/cardBrowser';\r\n\r\nconst CardBrowserStyle: React.CSSProperties = {\r\n\tmargin: 'auto',\r\n\twidth: '50%',\r\n};\r\n\r\nexport const BrowserRoute: React.StatelessComponent<any> = () => {\r\n\treturn (\r\n\t\t<CardBrowser serverGetRoute=\"envsCards\" style={CardBrowserStyle}/>\r\n\t);\r\n};","import AppBar from \"@material-ui/core/AppBar\";\r\nimport Tab from \"@material-ui/core/Tab\";\r\nimport Tabs from \"@material-ui/core/Tabs\";\r\nimport * as React from \"react\";\r\nimport SwipeableViews from \"react-swipeable-views\";\r\n\r\ninterface IProps {\r\n\ttab1: object;\r\n\ttab2: object;\r\n\ttab1Name: string;\r\n\ttab2Name: string;\r\n\tcolor: \"primary\" | \"secondary\";\r\n}\r\n\r\ninterface IState {\r\n\tvalue: number;\r\n}\r\n\r\n/**\r\n * Component made of an AppBar which controls two SwipeableViews under it.\r\n */\r\nexport default class SwipeableTabs extends React.Component<IProps, IState> {\r\n\tprivate static styleDiv = { height: '100%' };\r\n\r\n\tpublic state: IState = {\r\n\t\tvalue: 0\r\n\t};\r\n\r\n\tpublic handleChange = (event: any, value: number) => {\r\n\t\tthis.setState({ value });\r\n\t}\r\n\r\n\tpublic handleChangeIndex = (index: number) => {\r\n\t\tthis.setState({ value: index });\r\n\t}\r\n\r\n\tpublic render() {\r\n\t\treturn (\r\n\t\t\t<div style={SwipeableTabs.styleDiv}>\r\n\t\t\t\t<AppBar position=\"static\" color=\"default\">\r\n\t\t\t\t\t<Tabs\r\n\t\t\t\t\t\tvalue={this.state.value}\r\n\t\t\t\t\t\tonChange={this.handleChange}\r\n\t\t\t\t\t\tindicatorColor={this.props.color}\r\n\t\t\t\t\t\ttextColor={this.props.color}\r\n\t\t\t\t\t\tvariant=\"fullWidth\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Tab label={this.props.tab1Name}/>\r\n\t\t\t\t\t\t<Tab label={this.props.tab2Name}/>\r\n\t\t\t\t\t</Tabs>\r\n\t\t\t\t</AppBar>\r\n\t\t\t\t<SwipeableViews\r\n\t\t\t\t\tindex={this.state.value}\r\n\t\t\t\t\tonChangeIndex={this.handleChangeIndex}\r\n\t\t\t\t\tstyle={SwipeableTabs.styleDiv} // This view uses the same style as the div\r\n\t\t\t\t>\r\n\t\t\t\t\t{this.props.tab1}\r\n\t\t\t\t\t{this.props.tab2}\r\n\t\t\t\t</SwipeableViews>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n","import Scalar from \"src/rl/scalar\";\r\n\r\n// React\r\nimport * as React from 'react';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport { Typography, Grid, TextField } from '@material-ui/core';\r\n\r\ninterface IProps {\r\n    scalar: Scalar;\r\n    color: \"primary\" | \"secondary\";\r\n    onChangeCommitted: any;\r\n}\r\n\r\ninterface IState {\r\n    value: number;\r\n    input: string;\r\n}\r\n\r\nexport default class ScalarSlider extends React.Component<IProps, IState> {\r\n    private static styleTextField: React.CSSProperties = { fontSize: 12, textAlign: 'center', paddingBottom: 0 };\r\n\r\n    private static stringToFloatInRange(str: string, min: number, max: number) : number | undefined {\r\n        if (str.length <= 0) {\r\n            return undefined;\r\n        }\r\n        \r\n        const value = Number(str);\r\n\r\n        if (!Number.isFinite(value) || value < min || value > max) {\r\n            return undefined;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    /**\r\n     * Returns a 4 digit-rounded string of the given float.\r\n     * Helper function called during render.\r\n     * @param f \r\n     */\r\n    private static floatToString(f: number) {\r\n        return String(Math.round(f * 1000) / 1000.0);\r\n    }\r\n\r\n    constructor(props) {\r\n        super(props);\r\n       this.state = { value: this.props.scalar.value, input: String(this.props.scalar.value) };\r\n    }\r\n\r\n    public render() {\r\n        let min = this.props.scalar.min;\r\n        let max = this.props.scalar.max;\r\n        let step = (max - min) / 10000;\r\n\r\n        if (this.props.scalar.isWhole) {\r\n            min = Math.ceil(min);\r\n            max = Math.floor(max);\r\n            step = 1;\r\n        }\r\n\r\n        return (\r\n            <Grid container={true} spacing={0} color={this.props.color}>\r\n                <Grid item={true} xs={3}>\r\n                    <Typography variant=\"overline\" align=\"left\">{ScalarSlider.floatToString(min)}</Typography>\r\n                </Grid>\r\n\r\n                <Grid item={true} xs={2}/>\r\n\r\n                <Grid item={true} xs={2}>\r\n                    <TextField onBlur={this.handleBlurTextField} onChange={this.handleChangeTextField} inputProps={{ style: ScalarSlider.styleTextField }} multiline={false} color={this.props.color} variant=\"standard\" value={this.state.input}/>\r\n                </Grid>\r\n\r\n                <Grid item={true} xs={2}/>\r\n\r\n                <Grid item={true} xs={3}>\r\n                    <Typography variant=\"overline\" align=\"right\">{ScalarSlider.floatToString(max)}</Typography>\r\n                </Grid>\r\n                \r\n                <Grid item={true} xs={12}>\r\n                    <Slider step={step} min={min} max={max} value={this.state.value}\r\n                        onChange={this.handleChangeSlider}\r\n                        onChangeCommitted={this.handleChangeComittedSlider}\r\n                    />\r\n                </Grid>\r\n            </Grid>\r\n        );\r\n    }\r\n\r\n    private handleChangeComittedSlider = (event: any, value: any) => {\r\n        this.props.onChangeCommitted(value);\r\n    }\r\n\r\n    // Called when the text field loses focus\r\n    private handleBlurTextField = (event: any) => {\r\n        let value = Number(event.target.value);\r\n\r\n        // If the text is a valid number, we clamp it and set it as our new slider value\r\n        if (Number.isFinite(value)) {\r\n            const rounded = Math.round(value * 1000)/1000.0;\r\n            value = Math.min(Math.max(rounded, this.props.scalar.min), this.props.scalar.max);\r\n            this.setState({ value, input: String(value) });\r\n        } else {\r\n            // Otherwise we set the text to our last value\r\n            this.setState({ value: this.state.value, input: String(this.state.value) });\r\n        }\r\n    }\r\n\r\n    // Called when the text field is edited\r\n    private handleChangeTextField = (event: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {\r\n        // Converts the new string value of the text field to a number\r\n        const value = ScalarSlider.stringToFloatInRange(event.target.value, this.props.scalar.min, this.props.scalar.max);\r\n        \r\n        // Updates the state if the text input is a valid number\r\n        if (value !== undefined) {\r\n            this.setState({ value, input: event.target.value });\r\n        } else {\r\n            this.setState({ input: event.target.value });\r\n        }\r\n    }\r\n\r\n    // Called when the slider is changed\r\n    private handleChangeSlider = (event: any, value: number | number[]) => {\r\n        let val: number = 0;\r\n        \r\n        if (Array.isArray(value)) {\r\n            val = value[0];\r\n        } else {\r\n            val = value;\r\n        }\r\n\r\n        // Updates both the text and the slider\r\n        this.setState({ value: val, input: ScalarSlider.floatToString(val) });\r\n    }\r\n}","import Scalar from '../rl/scalar';\r\nimport ScalarSlider from './scalarSlider';\r\n\r\n// React\r\nimport * as React from 'react';\r\nimport { Typography, Checkbox, Grid } from '@material-ui/core';\r\n\r\ninterface IProps {\r\n    scalar: Scalar;\r\n    color: \"primary\" | \"secondary\";\r\n    onScalarChange: any;\r\n}\r\n\r\n/**\r\n * Renders a component representing a Scalar.\r\n */\r\nexport default class ScalarParam extends React.Component<IProps> {\r\n    public render() {\r\n        return (\r\n            <Grid container={true}>\r\n                <Grid item={true} xs={12} sm={5}>\r\n                    <Typography gutterBottom={true} variant=\"overline\"> {this.props.scalar.name} </Typography>\r\n                </Grid>\r\n                <Grid item={true} xs={12} sm={7}>\r\n                    { this.getNumberPicker() }\r\n                </Grid>\r\n            </Grid>\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns the appropriate React Component to serve as a picker for the given scalar.\r\n     */\r\n    private getNumberPicker() {\r\n        const { color, scalar } = this.props;\r\n\r\n        // If is checkbox...\r\n        if (scalar.isWhole && scalar.min === 0 && scalar.max === 1) {\r\n            return (\r\n                // tslint:disable-next-line: jsx-no-lambda\r\n                <Checkbox style={{ margin: 'auto' }} color={color} checked={scalar.value === 1} onChange={event => this.props.onScalarChange(event, scalar)} />\r\n            );\r\n        }\r\n\r\n        // Else if is slider...\r\n        // tslint:disable-next-line: jsx-no-lambda\r\n        return (<ScalarSlider color={color} scalar={scalar} onChangeCommitted={event => this.props.onScalarChange(event, scalar)} />);\r\n    }\r\n}","// React\r\nimport * as React from 'react';\r\nimport { Typography, Grid } from '@material-ui/core';\r\nimport StringParam from 'src/rl/stringParam';\r\n\r\ninterface IProps {\r\n    stringParam: StringParam;\r\n    color: \"primary\" | \"secondary\";\r\n}\r\n\r\n/**\r\n * Renders a component representing a Scalar.\r\n */\r\nexport default class StringParamComponent extends React.Component<IProps> {\r\n    public render() {\r\n        return (\r\n            <Grid container={true}>\r\n                <Grid item={true} xs={12} sm={5}>\r\n                    <Typography gutterBottom={true} variant=\"overline\"> {this.props.stringParam.name} </Typography>\r\n                </Grid>\r\n                <Grid item={true} xs={12} sm={7}>\r\n                    { this.getPicker() }\r\n                </Grid>\r\n            </Grid>\r\n        );\r\n    }\r\n\r\n    private onFilePickerChange = (event) => {\r\n        this.props.stringParam.values = [];\r\n        this.props.stringParam.fileNames = [];\r\n\r\n        for (const file of event.target.files) {\r\n            const reader = new FileReader();\r\n\r\n            reader.onload = e => {\r\n                if (!!reader.result) {\r\n                    this.props.stringParam.values.push(reader.result as string);\r\n                    this.props.stringParam.fileNames.push(file.name);\r\n                }\r\n            };\r\n\r\n            reader.readAsText(file, \"UTF-8\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns the appropriate React Component to serve as a picker for the given scalar.\r\n     */\r\n    private getPicker() {\r\n        const { stringParam } = this.props;\r\n\r\n        if (stringParam.type === 'file') {\r\n            return <input id={\"F\" + stringParam.name} name={\"F\" + stringParam.name} type=\"file\" multiple={true} accept=\".genome,.json\" onChange={this.onFilePickerChange} />;\r\n        }\r\n\r\n        // TODO: Implement this\r\n        return <div />;\r\n    }\r\n}","import Scalar from '../rl/scalar';\r\n\r\n// React\r\nimport * as React from 'react';\r\nimport { Divider, Typography, Paper } from '@material-ui/core';\r\nimport ScalarParam from './scalarParam';\r\nimport Button from '@material-ui/core/Button';\r\nimport update from \"immutability-helper\";\r\nimport AgentModel from '../rl/agents/agentModel';\r\nimport EnvironmentModel from '../rl/envs/environmentModel';\r\nimport StringParam from 'src/rl/stringParam';\r\nimport StringParamComponent from './stringParamComponent';\r\n\r\ninterface IProps {\r\n    scalars: Scalar[];\r\n    stringParams?: StringParam[];\r\n    tint: \"primary\" | \"secondary\";\r\n    agent: AgentModel | undefined;\r\n    env: EnvironmentModel | undefined;\r\n}\r\n\r\ninterface IState {\r\n    families: IScalarFamily[];\r\n    stringFamilies: IStringFamily[];\r\n}\r\n\r\n/**\r\n * Group of scalars which share the same family name.\r\n */\r\ninterface IScalarFamily {\r\n    scalars: Scalar[];\r\n}\r\n\r\n/**\r\n * Group of string params which share the same family name.\r\n */\r\ninterface IStringFamily {\r\n    stringParams: StringParam[];\r\n}\r\n\r\n/**\r\n * Renders a scalar array. Separates scalars in groups named after each scalar family.\r\n */\r\nexport default class ParamsFamily extends React.Component<IProps, IState> {\r\n    private static styleDiv = { paddingTop: 5, marginLeft: 7, marginRight: 7 };\r\n    private static styleTypography = { marginTop: 2, marginBottom: 6 };\r\n    private static styleDivider = { marginTop: 4, marginBottom: 4 };\r\n    private static stylePaper = { marginLeft: \"1.5%\", marginRight: \"1.5%\", marginTop: 5 };\r\n\r\n    private static sReactKey: number = 0;\r\n\r\n    // We use static variables to allow communication between IProps and our static mapping functions\r\n    private static sTint: \"primary\" | \"secondary\";\r\n\r\n    public constructor(props) {\r\n        super(props);\r\n\r\n        const families: IScalarFamily[] = [];\r\n\r\n        // Separates the scalar array from props by families and stores them in the state.\r\n\r\n        for (const scalar of this.props.scalars) {\r\n            let family: (IScalarFamily | undefined); // Inits to undefined\r\n\r\n            // Tries to find family by iterating through the families already added to the state.\r\n\r\n            for (const fam of families) {\r\n                if (fam.scalars[0].familyName === scalar.familyName) {\r\n                    family = fam;\r\n                }\r\n            }\r\n\r\n            // If not found, we create a family for the scalar.\r\n            if (family === undefined) {\r\n                families.push({ scalars: [scalar] });\r\n            } else {\r\n                // Otherwise, we push to an existing family.\r\n                family.scalars.push(scalar);\r\n            }\r\n        }\r\n\r\n        // Does the same thing for string params.\r\n\r\n        const stringFamilies: IStringFamily[] = [];\r\n\r\n        // Separates the scalar array from props by families and stores them in the state.\r\n\r\n        if (!!this.props.stringParams) {\r\n            for (const stringParam of this.props.stringParams) {\r\n                let family: (IStringFamily | undefined); // Inits to undefined\r\n\r\n                // Tries to find family by iterating through the string families already added to the state.\r\n\r\n                for (const fam of stringFamilies) {\r\n                    if (fam.stringParams[0].familyName === stringParam.familyName) {\r\n                        family = fam;\r\n                    }\r\n                }\r\n\r\n                // If not found, we create a family for the scalar.\r\n                if (family === undefined) {\r\n                    stringFamilies.push({ stringParams: [ stringParam ] });\r\n                } else {\r\n                    // Otherwise, we push to an existing family.\r\n                    family.stringParams.push(stringParam);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.state = { families, stringFamilies };\r\n    }\r\n\r\n    public render() {\r\n        ParamsFamily.sTint = this.props.tint;\r\n\r\n        const mappedScalarCards = this.state.families.map(this.mapFamiliesToCards);\r\n        const mappedStringCards = this.state.stringFamilies.map(this.mapStringParamsToCards);\r\n\r\n        return (\r\n            <Paper style={ParamsFamily.stylePaper}>\r\n                <Button onMouseDown={this.onRefreshAction} size=\"small\" color={ParamsFamily.sTint}>Refresh</Button>\r\n                { mappedScalarCards }\r\n                { mappedStringCards }\r\n            </Paper>\r\n        );\r\n    }\r\n\r\n    private onScalarChange = (event: any, scalar: Scalar) => {\r\n        if (!!event.target) {\r\n            const newValue = event.target.checked;\r\n            this.updateStateForScalar(scalar, newValue ? 1 : 0);\r\n        } else {\r\n            const newValue = event;\r\n            this.updateStateForScalar(scalar, newValue);\r\n        }\r\n    }\r\n\r\n    private updateStateForScalar = (scalar: Scalar, newValue: number) => {\r\n        let familyIndex = 0;\r\n        let scalarIndex = 0;\r\n\r\n        for (const family of this.state.families) {\r\n            if (family.scalars[0].familyName === scalar.familyName) {\r\n                break;\r\n            }\r\n\r\n            familyIndex += 1;\r\n        }\r\n\r\n        for (const stateScalar of this.state.families[familyIndex].scalars) {\r\n            if (stateScalar.name === scalar.name) {\r\n                break;\r\n            }\r\n\r\n            scalarIndex += 1;\r\n        }\r\n\r\n        this.setState({ families:\r\n            update(this.state.families, {\r\n                [familyIndex]: { scalars: {\r\n                    [scalarIndex]: { $merge: {\r\n                        value: newValue\r\n                    }}\r\n                }}\r\n            })\r\n        });\r\n    }\r\n\r\n    private mapScalarToComponent = (scalar: Scalar) => {\r\n        ParamsFamily.sReactKey++;\r\n\r\n        return (\r\n            <ScalarParam onScalarChange={this.onScalarChange} key={ParamsFamily.sReactKey} scalar={scalar} color={ParamsFamily.sTint}/>\r\n        );\r\n    }\r\n\r\n    private mapStringParamToComponent = (stringParam: StringParam) => {\r\n        ParamsFamily.sReactKey++;\r\n\r\n        return (\r\n            <StringParamComponent key={ParamsFamily.sReactKey} color={ParamsFamily.sTint} stringParam={stringParam} />\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Creates a Material UI Card to hold this family data.\r\n     */\r\n    private mapFamiliesToCards = (family: IScalarFamily) => {\r\n        ParamsFamily.sReactKey++;\r\n\r\n        const cardParams = family.scalars.map(this.mapScalarToComponent);\r\n\r\n        const tint = ParamsFamily.sTint;\r\n\r\n        return (\r\n            <div key={ParamsFamily.sReactKey} style={ParamsFamily.styleDiv}>\r\n                <Typography color={tint} variant=\"h6\" style={ParamsFamily.styleTypography}>{ family.scalars[0].familyName }</Typography>\r\n                { cardParams }\r\n                <Divider style={ParamsFamily.styleDivider}/>\r\n            </div>\r\n\t\t);\r\n    }\r\n\r\n    /**\r\n     * Creates a Material UI Card to hold this family data.\r\n     */\r\n    private mapStringParamsToCards = (family: IStringFamily) => {\r\n        ParamsFamily.sReactKey++;\r\n\r\n        const cardParams = family.stringParams.map(this.mapStringParamToComponent);\r\n\r\n        const tint = ParamsFamily.sTint;\r\n\r\n        return (\r\n            <div key={ParamsFamily.sReactKey} style={ParamsFamily.styleDiv}>\r\n                <Typography color={tint} variant=\"h6\" style={ParamsFamily.styleTypography}>{ family.stringParams[0].familyName }</Typography>\r\n                { cardParams }\r\n                <Divider style={ParamsFamily.styleDivider}/>\r\n            </div>\r\n\t\t);\r\n    }\r\n\r\n    /**\r\n     * Refreshes the current environment/agent.\r\n     * @param event \r\n     */\r\n    private onRefreshAction = (event: any) => {\r\n\t\tconst newParamsArray = new Array<Scalar>();\r\n\r\n\t\tfor (const family of this.state.families) {\r\n\t\t\tnewParamsArray.push(...family.scalars);\r\n\t\t}\r\n\r\n\t\tif (this.props.agent) {\r\n            this.props.agent.reset(newParamsArray);\r\n            this.props.agent.env.resetState();\r\n\t\t} else if (this.props.env) {\t\t\t\r\n\t\t\tthis.props.env!.reset(newParamsArray);\r\n\t\t}\r\n\t}\r\n}","import * as React from 'react';\r\nimport Draw from '../draw';\r\nimport AgentModel from '../rl/agents/agentModel';\r\nimport EnvironmentModel from '../rl/envs/environmentModel';\r\nimport { ICardInfo } from './infoCard';\r\nimport SwipeableTabs from './swipeableTabs';\r\nimport ParamsFamily from './paramsFamily';\r\n\r\ninterface IProps {\r\n\tmodelName: string;\r\n\tinfo: ICardInfo;\r\n\tenv?: EnvironmentModel;\r\n\tagent?: AgentModel;\r\n}\r\n\r\nconst FRAMES_PER_SEC = 60.0;\r\nconst FRAME_TIME = 1 / FRAMES_PER_SEC;\r\n\r\n/**\r\n * The Core component controls SwipeableTabs component which has a Canvas and a ScalarFamily tab.\r\n * The Canvas renders data from either an Environment or an Agent and the ScalarFamily tabs controls its parameters.\r\n * All of the main loop logic is done here.\r\n */\r\nexport default class Core extends React.Component<IProps, any> {\r\n\tprivate static styleCanvas = { width: '100%', height: '90vh' };\r\n\r\n\tpublic canvasContext?: CanvasRenderingContext2D;\r\n\r\n\tpublic timeScale = 1;\r\n\r\n\tprivate lastTime = 0;\r\n\tprivate unprocessedTime = 0;\r\n\tprivate frameCounter = 0;\r\n\tprivate frames = 0;\r\n\tprivate totalTime = 0;\r\n\r\n\tpublic constructor(props: IProps) {\r\n\t\tsuper(props);\r\n\t\tthis.fetchInfo(props.modelName);\r\n\r\n\t\tthis.start();\r\n\t}\r\n\t\r\n\tpublic componentDidMount() {\r\n\t\twindow.addEventListener(\"resize\", this.resize.bind(this));\r\n\t}\r\n\r\n    public componentWillUnmount() {\r\n        window.removeEventListener(\"resize\", this.resize.bind(this));\r\n    }\r\n\r\n\tpublic render() {\r\n\t\t// As a convention, if the agent is not specified this core component is for an environment\r\n\t\tif (!!this.props.env) {\r\n\t\t\treturn (\r\n\t\t\t\t<SwipeableTabs\r\n\t\t\t\t\ttab1={\r\n\t\t\t\t\t\t<canvas id=\"env-canvas\" style={Core.styleCanvas} ref={this.ref.bind(this)}/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttab2={\r\n\t\t\t\t\t\t<ParamsFamily agent={undefined} env={this.props.env!} tint=\"secondary\" scalars={this.props.env!.paramsArray}/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttab1Name=\"Environment\" tab2Name=\"Parameters\"\r\n\t\t\t\t\tcolor=\"secondary\"\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn (\r\n\t\t\t\t<SwipeableTabs\r\n\t\t\t\t\ttab1={\r\n\t\t\t\t\t\t<canvas id=\"agent-canvas\" style={Core.styleCanvas} ref={this.ref.bind(this)}/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttab2={\r\n\t\t\t\t\t\t<ParamsFamily agent={this.props.agent!} env={undefined} tint=\"primary\" scalars={this.props.agent!.paramsArray} stringParams={this.props.agent!.stringParamsArray}/>\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttab1Name=\"Agent\" tab2Name=\"Parameters\"\r\n\t\t\t\t\tcolor=\"primary\"\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate update(delta: number) {\r\n\t\tif (!!this.props.agent) {\r\n\t\t\tthis.props.agent!.loop(delta);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate draw(timeStamp: number) {\r\n\t\tif (!!this.canvasContext) {\r\n\t\t\tif (this.props.agent) {\r\n\t\t\t\tthis.props.agent!.draw(this.canvasContext!);\r\n\t\t\t} else if (!!this.props.env) {\t\t\t\r\n\t\t\t\tthis.props.env!.draw(this.canvasContext!);\r\n\r\n\t\t\t\t// Draws performance meter\r\n\t\t\t\tDraw.context = this.canvasContext;\r\n\t\t\t\tDraw.normY = false;\r\n\t\t\t\tDraw.setTranslation(0, -12);\r\n\r\n\t\t\t\tDraw.normX = Draw.normY = true;\r\n\t\t\t\tDraw.text(-0.98, 0.98, this.totalTime.toFixed(2) + 'ms', '300 12px sans-serif', 'green', 'left');\r\n\t\t\t\t\r\n\t\t\t\tDraw.setTranslation(0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate start() {\r\n\t\tthis.lastTime = performance.now() / 1000.0;\r\n\t\tsetInterval(this.run.bind(this), 0);\r\n\t}\r\n\r\n\t// See https://gafferongames.com/post/fix_your_timestep/\r\n\tprivate run() {\r\n\t\tlet needToRender = false;\r\n\r\n\t\t// Current time at the start of the frame.\r\n\t\t// timeStamp is divided by 1000 to convert ms to seconds.\r\n\t\tconst currentTime = performance.now() / 1000.0;\r\n\r\n\t\t// Amount of passed time since last frame.\r\n\t\tconst passedTime = currentTime - this.lastTime;\r\n\t\tthis.lastTime = currentTime;\r\n\r\n\t\tthis.unprocessedTime += passedTime;\r\n\t\tthis.frameCounter += passedTime;\r\n\r\n\t\tif (this.frameCounter >= 1.5)\r\n\t\t{\r\n\t\t\tthis.totalTime = (1000.0 * this.frameCounter)/this.frames;\r\n\r\n\t\t\tthis.frames = 0;\r\n\t\t\tthis.frameCounter = 0;\r\n\t\t}\r\n\t\r\n\t\twhile (this.unprocessedTime > FRAME_TIME)\r\n\t\t{\r\n\t\t\tfor (let i = 0; i < this.timeScale; ++i) {\r\n\t\t\t\tthis.update(FRAME_TIME);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Since any updates can put onscreen objects in a new place, the flag\r\n\t\t\t// must be set to rerender the scene.\r\n\t\t\tneedToRender = true;\r\n\t\t\tthis.unprocessedTime -= FRAME_TIME;\r\n\t\t}\r\n\r\n\t\tif (needToRender)\r\n\t\t{\r\n\t\t\twindow.requestAnimationFrame(this.draw.bind(this));\r\n\t\t\tthis.frames++;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate fetchInfo(modelName: string) {\r\n\t\tthis.props.info.modelName = modelName;\r\n\t\tthis.props.info.description = 'Description';\r\n\t\tthis.props.info.title = 'Title';\r\n\t\tthis.props.info.imgSrc = 'Title';\r\n\t}\r\n\r\n\tprivate ref(canvas: HTMLCanvasElement) {\r\n\t\tif (!!canvas) {\r\n\t\t\tconst ctx = canvas.getContext('2d');\r\n\r\n\t\t\tif (!!ctx) {\r\n\t\t\t\tthis.canvasContext = ctx;\r\n\t\t\t}\r\n\r\n\t\t\tthis.resize();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate resize() {\r\n\t\tif (!!this.canvasContext) {\r\n\t\t\tthis.canvasContext.canvas.width = this.canvasContext.canvas.offsetWidth;\r\n\t\t\tthis.canvasContext.canvas.height = this.canvasContext.canvas.offsetHeight;\r\n\t\t}\r\n\t}\r\n}","import Grid from '@material-ui/core/Grid';\r\nimport * as React from 'react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport CardBrowser from '../components/cardBrowser';\r\nimport Core from '../components/core';\r\nimport { ICardInfo, IRouteInfo } from '../components/infoCard';\r\nimport * as ModelFactory from './modelFactory';\r\n\r\nconst emptyCardInfo: ICardInfo = {\r\n\tdescription: '',\r\n\timgSrc: '',\r\n\tmodelName: '',\r\n\ttitle: ''\r\n};\r\n\r\nconst gridStyle = { height: '100%' };\r\n\r\n/**\r\n * Splitscreen of a core on the left (attached to an environment) and a CardBrowser listing agent cards.\r\n * @param routeProps \r\n */\r\nexport const SplitCoreAndBrowserRoute: React.StatelessComponent<RouteComponentProps<IRouteInfo>> = (routeProps: RouteComponentProps<IRouteInfo>) => {\r\n\t// TODO: Handle errors here\r\n\tconst env = ModelFactory.createEnv(routeProps.match.params.envName);\r\n\r\n\treturn (\r\n\t\t<Grid container={true} style={gridStyle}>\r\n\t\t\t<Grid item={true} xs={6} sm={6} md={6} lg={6} style={gridStyle}>\r\n\t\t\t\t<Core modelName={routeProps.match.params.envName} env={env} info={emptyCardInfo}/>\r\n\t\t\t</Grid>\r\n\t\t\t\r\n\t\t\t<Grid item={true} xs={6} sm={6} md={6} lg={6} style={gridStyle}>\r\n\t\t\t\t<CardBrowser envName={routeProps.match.params.envName} serverGetRoute=\"agentsCards\"/>\r\n\t\t\t</Grid>\r\n\t\t</Grid>\r\n\t);\r\n};","import Grid from '@material-ui/core/Grid';\r\nimport * as React from 'react';\r\nimport { RouteComponentProps } from 'react-router-dom';\r\nimport Core from '../components/core';\r\nimport { ICardInfo, IRouteInfo } from '../components/infoCard';\r\nimport * as ModelFactory from './modelFactory';\r\n\r\nconst emptyCardInfo: ICardInfo = {\r\n\tdescription: '',\r\n\timgSrc: '',\r\n\tmodelName: '',\r\n\ttitle: ''\r\n};\r\n\r\nconst gridStyle = { height: '100%' };\r\n\r\n/**\r\n * Splitscreen of two core views (the left one is attached to an environment and the right one is attached to an agent).\r\n */\r\nexport const SplitTwoCoresRoute: React.StatelessComponent<RouteComponentProps<IRouteInfo>> = (routeProps: RouteComponentProps<IRouteInfo>) => {\r\n\t// TODO: Handle errors here\r\n\tconst env = ModelFactory.createEnv(routeProps.match.params.envName);\r\n\tconst agent = ModelFactory.createAgent(routeProps.match.params.agentName, env!);\r\n\r\n\treturn (\r\n\t\t<Grid container={true} style={gridStyle}>\r\n\t\t\t<Grid item={true} xs={12} sm={6} md={6} lg={6} style={gridStyle}>\r\n\t\t\t\t<Core modelName={routeProps.match.params.envName} env={env} info={emptyCardInfo}/>\r\n\t\t\t</Grid>\r\n\t\t\t\r\n\t\t\t<Grid item={true} xs={12} sm={6} md={6} lg={6} style={gridStyle}>\r\n\t\t\t\t<Core modelName={routeProps.match.params.agentName} agent={agent} info={emptyCardInfo}/>\r\n\t\t\t</Grid>\r\n\t\t</Grid>\r\n\t);\r\n};","import * as React from 'react';\r\nimport { Route, Switch } from 'react-router-dom';\r\nimport { BrowserRoute } from './browserRoute';\r\nimport { SplitCoreAndBrowserRoute } from './splitCoreAndBrowserRoute';\r\nimport { SplitTwoCoresRoute } from './splitTwoCoresRoute';\r\n\r\nconst routeStyle = { height: '100%' };\r\n\r\nexport const AppRoutes: React.StatelessComponent<any> = () => {\r\n\treturn (\r\n\t\t<Switch>\r\n\t\t\t<Route path=\"/:envName/:agentName\" component={SplitTwoCoresRoute} style={routeStyle}/>\r\n\t\t\t<Route path=\"/:envName\" component={SplitCoreAndBrowserRoute} style={routeStyle}/>\r\n\t\t\t<Route path=\"/\" component={BrowserRoute} style={routeStyle}/>\r\n\t\t</Switch>\r\n\t);\r\n};","import * as React from 'react';\r\nimport { BrowserRouter as Router } from 'react-router-dom';\r\nimport { AppRoutes } from './routes/appRoutes';\r\n\r\nclass App extends React.Component {\r\n\tprivate static styleAppRoutes = { height: '100%' };\r\n\r\n\tpublic render() {\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t<AppRoutes style={App.styleAppRoutes}/>\r\n\t\t\t</Router>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport './index.css';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n\t<App />,\r\n\tdocument.getElementById('root') as HTMLElement\r\n);\r\n\r\nserviceWorker.register();","module.exports = __webpack_public_path__ + \"static/media/neat.cfd3585d.svg\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAACgCAYAAAASG3zdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF+mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA1LTE1VDE2OjM4OjQwLTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTE1VDE2OjM4OjQwLTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wNS0xNVQxNjozODo0MC0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpmNmI4MGM4My02YWRhLTY1NDctOTAzYS01NThmNTNkN2M4N2MiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDozYThkOTVlNS00ZmQzLTRjNDktODI1NS02ODkzNmI3M2ZmOGMiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpjY2I5NDVjMy1kNjc4LTQ5NDgtYmMwNy02YjA5ZDc1MDIzNTUiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmNjYjk0NWMzLWQ2NzgtNDk0OC1iYzA3LTZiMDlkNzUwMjM1NSIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0xNVQxNjozODo0MC0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpmNmI4MGM4My02YWRhLTY1NDctOTAzYS01NThmNTNkN2M4N2MiIHN0RXZ0OndoZW49IjIwMjAtMDUtMTVUMTY6Mzg6NDAtMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4b6jBCAAAOXklEQVR4AQXBu60oaJqW0fV8e3fNpeeGiAChMRAOHiKCET4iCbIgBGIABxeHiYAYiAJ6qD636vO/rNV/+Lf/sAqzUdkGoNiAyjYAFdgGoIANqDCf8J/+27/yl3/+i7/45Re//MUvfvn8nc+PD7+9n3789psf33745c9+8ePbD1+///Dtxw9//Pbdly/ffPn6zZdv33z5+t0fv3z35et3X79/8+3bD99+/Ob7jz/57X/8C5/FP/+7v/K7P/vFL7/7nV8+Pvz2p5++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\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAACgCAYAAAASG3zdAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF+mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA1LTE1VDE2OjM5OjA4LTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTE1VDE2OjM5OjA4LTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wNS0xNVQxNjozOTowOC0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowMDkyMDFjMS05MzE0LWQwNGMtOWI4Yi1jMTNjMWY2YmQ4ZDQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDo3YzE4ZjIxYi0wMDE3LWM1NGItODIxOC1kMmZiNGNkM2MyYTkiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDplMjI3MzA2Zi1kODMyLTkxNGUtYjYwYS02NmU2YmRmYWNhM2MiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmUyMjczMDZmLWQ4MzItOTE0ZS1iNjBhLTY2ZTZiZGZhY2EzYyIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0xNVQxNjozOTowOC0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDowMDkyMDFjMS05MzE0LWQwNGMtOWI4Yi1jMTNjMWY2YmQ4ZDQiIHN0RXZ0OndoZW49IjIwMjAtMDUtMTVUMTY6Mzk6MDgtMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4Oa93HAAAOc0lEQVR4AQXBva0o+HrW0fW8e9/x9Qe2RYBoAFJCoAJMDkTUgEQDFEQDyBUQExAhUQK6tu/MOXPG+/9jrVX+07/99/2r//rlr//qz/z1X/4Tf/WXf+Gv/vzP/eVf/Jl/8he/99Pn7/z6229++eWbP/z83d//w8/+8Hf/4O/++LM//P0f/eEPf/QPP//i52+/+v79BwDwt//Sf/+f/2MHyo454jaOCTDklb1MDNLjNtsMAAAVODCKsE1Yw8DGzJwuRaUGkkoASADg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\"","module.exports = __webpack_public_path__ + \"static/media/background.dd6aa4cd.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAMCAYAAACEJVa/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF+mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA1LTE1VDE2OjQxOjQ5LTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTE1VDE2OjQxOjQ5LTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wNS0xNVQxNjo0MTo0OS0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpiZmJhNzljNS1mMWQxLWZhNDktYWFiYi0yNDc5MzE0NjUwNmIiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiNjU0NGJkNy0wOTc0LTQwNGUtOGFlNS1lOTQxOTJiZmZhM2YiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyZjFjMzM5My0zMzk5LTBlNDEtODY3NC03MTE3ZDUwOTJlZjEiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjJmMWMzMzkzLTMzOTktMGU0MS04Njc0LTcxMTdkNTA5MmVmMSIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0xNVQxNjo0MTo0OS0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDpiZmJhNzljNS1mMWQxLWZhNDktYWFiYi0yNDc5MzE0NjUwNmIiIHN0RXZ0OndoZW49IjIwMjAtMDUtMTVUMTY6NDE6NDktMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz694SivAAAA4ElEQVQoz3WTsRGDMAxFvU/okjuYAHpYiPRkHpZIDWVoskNwcqdYsmW+ARf/xGH9x7dsDBGZM3VVQ11VU1vWsbLOeg8vtNnOg9OD1mkQiLVWdAY6ANgo5vEmagGQA0F8/3U1r+PVQ5xhfj8TAFfuTyC88AkmrfrMzRNAdGtZCGoFKBswjYc0KQSnz4uYDEG6hhJIPAkc3uxPREFs/lUm6ltuz+w3Oqj99Jd7QUtfCEybt7Q+lW4phbgEAugvQQW9XFVQTBGSRIjOBPcsAE4S0vhEzS7J7nRytxavfe73YP0BS30eVCAqFMwAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAMCAYAAACEJVa/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF+mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA1LTE1VDE2OjQxOjU5LTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTE1VDE2OjQxOjU5LTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wNS0xNVQxNjo0MTo1OS0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5YTg2NjNiMi1mOWFjLTRjNDMtOTU5Yy0xZWRlNjRkYTFlOGQiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpkMGUzYzMzNC02MGRmLTdkNGEtODI4Ni1hNGMxM2IyNDliOWYiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoxMjcwNDMzNy0xMmVjLTlhNDQtYWI5Ni0zZGI1OTE3M2ZhM2UiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjEyNzA0MzM3LTEyZWMtOWE0NC1hYjk2LTNkYjU5MTczZmEzZSIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0xNVQxNjo0MTo1OS0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo5YTg2NjNiMi1mOWFjLTRjNDMtOTU5Yy0xZWRlNjRkYTFlOGQiIHN0RXZ0OndoZW49IjIwMjAtMDUtMTVUMTY6NDE6NTktMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6wqmo+AAAA5klEQVQoz42TQRKCMAxFex/Y4Qw9AezphWCP5+ESupWlbPQMWp2J/ampLRbHxe+k0+TlNxRFRCqnrm5oLaMbyuVmi41uyc57p5HFe2tZOP8J6VwnX7yn+7RjoUgAorWjxIE9jXSbqjegCpD5ekicrEG8wC4KPgAfQzibL39AwvC0DLBNgN7NMblSPBuVu7Mkxa7Q2URNpDFDDA9zTCFujwS5EuKnVqxHrUIM4ezrTXAXB16Gkpa+DABxkeSJk/jrLH0RilmDFwCxA4lluJmH1tAZMAYVQejs59IGV5svNobFhVu/B/QCuhobex4SgFIAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAMCAYAAACEJVa/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF+mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA1LTE1VDE2OjQwOjQ4LTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTE1VDE2OjQwOjQ4LTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wNS0xNVQxNjo0MDo0OC0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozMTJhYzhjOC0yYTY3LTA2NGItOGE5Ni01MmM5OGM5M2ZkOTIiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDoyMTg4NGJmMS1mODZhLTcwNDctOGZiNi0zYmJiODBmYTczZDIiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo0YTAyNDdkOS1hZTlkLTJhNGEtYTIzNy02YTFiNTdjNzFlZTgiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjRhMDI0N2Q5LWFlOWQtMmE0YS1hMjM3LTZhMWI1N2M3MWVlOCIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0xNVQxNjo0MDo0OC0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDozMTJhYzhjOC0yYTY3LTA2NGItOGE5Ni01MmM5OGM5M2ZkOTIiIHN0RXZ0OndoZW49IjIwMjAtMDUtMTVUMTY6NDA6NDgtMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz57GZEPAAAA20lEQVQoz32TTRKCMAyFex/d6QycgO7xQrjH83AJ17Jl5RmkOlP7EkLTH128ybQkX1/TYLz3pqa+6Tx0aSFLEetabrEhRW4eg24UUeycI+H7XwglP7j4NZ38Op0ZuAFEuaPtdEvJfcv2USwQFMzPe+KEo91BRja1sBed5BBbuDE1u5IsjnI3dQgaqCFhLddaA0RA+UsJaH8RbuhIUfcFQuGnNYneDUeAiqdFXIajX65Bw4GSJDm66ZK5SSBceFQQjoDLyVoyM+WUZk4iKDrR/ahOrB55fYVfvwf0BWryIViMtlMNAAAAAElFTkSuQmCC\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKgAAAA4CAIAAADmTySgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF+mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoV2luZG93cykiIHhtcDpDcmVhdGVEYXRlPSIyMDIwLTA1LTE1VDE2OjQzOjAzLTAzOjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDIwLTA1LTE1VDE2OjQzOjAzLTAzOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAyMC0wNS0xNVQxNjo0MzowMy0wMzowMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNWJhZDRmZi1jNDEzLTQ0NDMtOTYxOC03OGQwMDNlYjUyODkiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDphMTZmMjFhNC03Y2Y5LTUxNGMtYWY3Yi1jZTRjNTQ2OTUyMTciIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpmOTNhOTE3Ny01ZjRkLWJlNGEtODdlOC1kNjE2OGRiZGFiMDYiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmY5M2E5MTc3LTVmNGQtYmU0YS04N2U4LWQ2MTY4ZGJkYWIwNiIgc3RFdnQ6d2hlbj0iMjAyMC0wNS0xNVQxNjo0MzowMy0wMzowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKFdpbmRvd3MpIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyNWJhZDRmZi1jNDEzLTQ0NDMtOTYxOC03OGQwMDNlYjUyODkiIHN0RXZ0OndoZW49IjIwMjAtMDUtMTVUMTY6NDM6MDMtMDM6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE5IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4vmmHUAAAO4klEQVR42pWcO3IcSQ6G6yorf+XO3GBoSJ4Uob7G7AFWttbNtHZ86hTcY4BWpTHTvITGWJLVXZ0Avh9FRXR0FIvZqHzg+QOo5dMvv33+9e7zr79tF8/f22e7k27ehTHzsAuR7fry37tAbfrh3faTneZ1DmHYfv9uuoapTjNxY2bi86PnOdPS7gKp62Tu/JTuaJcchc+/xJ3cb070f8ur+0xL2+cw73+gkx535zf/ZdrLX3//5/nz54+X77/m75eb356vX77/vtzZ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\"","module.exports = __webpack_public_path__ + \"static/media/pole-balancing.5027a009.svg\";","module.exports = __webpack_public_path__ + \"static/media/birdGame.215e76f0.png\";","module.exports = __webpack_public_path__ + \"static/media/dice.aff815a0.svg\";","module.exports = __webpack_public_path__ + \"static/media/NES.bf70de11.png\";"],"sourceRoot":""}